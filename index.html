<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meme Coin Countdown</title>
    <!-- 
        ç”Ÿäº§ç¯å¢ƒè­¦å‘Šï¼šè¯·æ›¿æ¢ä¸ºæœ¬åœ°Tailwind CSSæ„å»ºç‰ˆæœ¬
        å®‰è£…æ–¹æ³•ï¼šnpm install tailwindcss && npx tailwindcss build
        æˆ–ä½¿ç”¨CDNçš„å‹ç¼©ç‰ˆæœ¬ç”¨äºå¿«é€ŸåŸå‹å¼€å‘
    -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- é…ç½®Tailwindè‡ªå®šä¹‰é¢œè‰²å’Œå­—ä½“ -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        memeYellow: '#FFDD00',
                        memePink: '#FF2E63',
                        memeBlue: '#08D9D6',
                        memePurple: '#9D4EDD',
                        memeGreen: '#4CAF50',
                    },
                    fontFamily: {
                        meme: ['"Comic Sans MS"', '"Comic Neue"', 'cursive'],
                    },
                    animation: {
                        'float': 'float 3s ease-in-out infinite',
                        'pulse-fast': 'pulse 1s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'spin-slow': 'spin 8s linear infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .text-shadow {
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            }
            .text-shadow-meme {
                text-shadow: 3px 3px 0px #000;
            }
            .border-meme {
                border: 4px solid #000;
                border-radius: 12px;
            }
            .rotate-random {
                transform: rotate(-2deg);
            }
            .rotate-random-reverse {
                transform: rotate(2deg);
            }
            .glow {
                box-shadow: 0 0 15px rgba(255, 221, 0, 0.7);
            }
        }
    </style>
</head>
<body class="bg-gray-900 font-meme min-h-screen overflow-x-hidden relative">
    <!-- èƒŒæ™¯è£…é¥°å…ƒç´  -->
    <div class="absolute top-10 left-10 w-20 h-20 bg-memePink rounded-full opacity-50 animate-spin-slow"></div>
    <div class="absolute bottom-20 right-10 w-32 h-32 bg-memeBlue rounded-full opacity-40 animate-spin-slow"></div>
    <div class="absolute top-1/3 right-1/4 w-16 h-16 bg-memeYellow rounded-full opacity-60 animate-spin-slow"></div>
    
    <!-- æ¼‚æµ®çš„MEMEæ–‡å­— -->
    <div class="absolute top-20 right-20 text-5xl font-bold text-memePurple opacity-20 rotate-12 animate-float">MEME</div>
    <div class="absolute bottom-40 left-20 text-6xl font-bold text-memeGreen opacity-20 -rotate-6 animate-float" style="animation-delay: 1s">TO THE MOON</div>
    <div class="absolute top-1/2 left-10 text-4xl font-bold text-memePink opacity-20 rotate-6 animate-float" style="animation-delay: 0.5s">HODL</div>
    
    <!-- ä¸»å®¹å™¨ -->
    <div class="container mx-auto px-4 py-12 relative z-10">
        <!-- é¡¶éƒ¨æ ‡é¢˜ -->
        <header class="text-center mb-8">
            <h1 class="text-[clamp(2.5rem,8vw,5rem)] font-bold text-memeYellow text-shadow-meme mb-4 transform hover:scale-105 transition-transform duration-300">
                MOON LAUNCH
            </h1>
            <p class="text-[clamp(1.2rem,4vw,2rem)] text-white animate-pulse-fast">
                ğŸš€ Countdown to the next big meme coin! ğŸš€
            </p>
        </header>
        
        <!-- å€’è®¡æ—¶ä¸»ä½“ - ä¸­é—´åä¸Šä½ç½® -->
        <div class="max-w-4xl mx-auto my-12 border-meme bg-gradient-to-br from-gray-800 to-gray-900 p-8 md:p-12 relative">
            <!-- è£…é¥°å…ƒç´  -->
            <div class="absolute -top-6 -left-6 bg-memePink p-3 rotate-random border-meme">
                <i class="fa fa-diamond text-white text-2xl"></i>
            </div>
            <div class="absolute -bottom-6 -right-6 bg-memeBlue p-3 rotate-random-reverse border-meme">
                <i class="fa fa-rocket text-white text-2xl"></i>
            </div>
            
            <h2 class="text-center text-[clamp(1.5rem,5vw,2.5rem)] text-memePink mb-8">
                Time Until Launch
            </h2>
            
            <div id="countdown" class="grid grid-cols-2 gap-4 md:gap-8">
                <!-- åˆ† -->
                <div class="bg-memePurple border-meme p-4 text-center transform hover:scale-105 transition-all duration-300 glow">
                    <div id="minutes" class="text-[clamp(2rem,6vw,4rem)] font-bold text-white">00</div>
                    <div class="text-white font-bold">MINUTES</div>
                </div>
                
                <!-- ç§’ -->
                <div class="bg-memeGreen border-meme p-4 text-center transform hover:scale-105 transition-all duration-300 glow">
                    <div id="seconds" class="text-[clamp(2rem,6vw,4rem)] font-bold text-black">00</div>
                    <div class="text-black font-bold">SECONDS</div>
                </div>
            </div>
        </div>
        
        <!-- ä»£å¸äº¤æ˜“æ£€æµ‹åŒºåŸŸ -->
        <div class="max-w-4xl mx-auto my-12 border-meme bg-gradient-to-br from-gray-800 to-gray-900 p-8 md:p-12 relative">
            <!-- è£…é¥°å…ƒç´  -->
            <div class="absolute -top-6 -left-6 bg-memeGreen p-3 rotate-random border-meme">
                <i class="fa fa-bitcoin text-white text-2xl"></i>
            </div>
            <div class="absolute -bottom-6 -right-6 bg-memeYellow p-3 rotate-random-reverse border-meme">
                <i class="fa fa-exchange text-black text-2xl"></i>
            </div>
            
            <h2 class="text-center text-[clamp(1.5rem,5vw,2.5rem)] text-memeGreen mb-8">
                ğŸš€ Solanaå®æ—¶äº¤æ˜“æ£€æµ‹å™¨ ğŸš€
            </h2>
            
            <!-- ä»£å¸åœ°å€æ˜¾ç¤º -->
            <div class="mb-8">
                <div class="bg-gray-700 border-meme p-6">
                    <label class="block text-memeYellow font-bold mb-3">å½“å‰æ£€æµ‹ä»£å¸</label>
                    <div class="flex gap-4 flex-wrap items-center">
                        <input 
                            type="text" 
                            id="tokenAddress" 
                            placeholder="ç­‰å¾…ç®¡ç†é¢æ¿è®¾ç½®ä»£å¸åœ°å€..."
                            class="flex-1 min-w-64 p-3 bg-gray-600 border-2 border-gray-500 rounded-lg text-white placeholder-gray-400 focus:border-memeYellow focus:outline-none"
                            readonly
                        >

                    </div>
                </div>
            </div>
            
            <!-- äº¤æ˜“æ£€æµ‹çŠ¶æ€ -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <!-- æ£€æµ‹çŠ¶æ€ -->
                <div class="bg-memeBlue border-meme p-6 text-center transform hover:scale-105 transition-all duration-300 glow">
                    <div class="text-3xl mb-2">ğŸ“¡</div>
                    <div class="text-xl font-bold text-black mb-2">æ£€æµ‹çŠ¶æ€</div>
                    <div id="detectionStatus" class="text-lg font-bold text-black">ğŸ”´ ç­‰å¾…ç®¡ç†é¢æ¿å¼€å¯</div>
                </div>
                
                <!-- äº¤æ˜“æ¬¡æ•° -->
                <div class="bg-memePurple border-meme p-6 text-center transform hover:scale-105 transition-all duration-300 glow">
                    <div class="text-3xl mb-2">ğŸ“Š</div>
                    <div class="text-xl font-bold text-white mb-2">äº¤æ˜“æ¬¡æ•°</div>
                    <div id="transactionCount" class="text-2xl font-bold text-white">0</div>
                </div>
                
                <!-- å€’è®¡æ—¶è°ƒæ•´ -->
                <div class="bg-memePink border-meme p-6 text-center transform hover:scale-105 transition-all duration-300 glow">
                    <div class="text-3xl mb-2">â°</div>
                    <div class="text-xl font-bold text-black mb-2">å€’è®¡æ—¶è°ƒæ•´</div>
                    <div id="timeAdjustment" class="text-lg font-bold text-black">+0 ç§’</div>
                </div>
                
                <!-- RPCçŠ¶æ€ -->
                <div class="bg-memeYellow border-meme p-6 text-center transform hover:scale-105 transition-all duration-300 glow">
                    <div class="text-3xl mb-2">ğŸŒ</div>
                    <div class="text-xl font-bold text-black mb-2">RPCçŠ¶æ€</div>
                    <div id="rpcStatus" class="text-lg font-bold text-black">æœªé€‰æ‹©</div>
                </div>
            </div>
            

            
            <!-- äº¤æ˜“æ—¥å¿— -->
            <div class="bg-gray-700 border-meme p-4 max-h-60 overflow-y-auto">
                <h3 class="text-memeYellow font-bold mb-3">ğŸ“ äº¤æ˜“æ—¥å¿—</h3>
                <div id="transactionLog" class="text-sm text-gray-300 space-y-2">
                    <div class="text-gray-500 italic">ç­‰å¾…äº¤æ˜“æ£€æµ‹...</div>
                </div>
            </div>
            
            <!-- è¯¦ç»†äº¤æ˜“è®°å½•è¡¨æ ¼ -->
            <div class="bg-gray-700 border-meme p-4 mt-4 max-h-80 overflow-y-auto">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="text-memeYellow font-bold">ğŸ“Š è¯¦ç»†äº¤æ˜“è®°å½•</h3>
                    <div class="flex items-center gap-2">
                        <span id="detailedCount" class="text-xs text-memeYellow font-bold">0 æ¡è®°å½•</span>
                        <div id="syncIndicator" class="w-2 h-2 bg-gray-500 rounded-full"></div>
                        <span id="syncStatus" class="text-xs text-gray-400">ç­‰å¾…åŒæ­¥...</span>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-xs">
                        <thead>
                            <tr class="text-memeBlue border-b border-gray-600">
                                <th class="text-left p-2">æ—¶é—´</th>
                                <th class="text-left p-2">ç±»å‹</th>
                                <th class="text-left p-2">æ•°é‡</th>
                                <th class="text-left p-2">äº¤æ˜“è€…</th>
                                <th class="text-left p-2">äº¤æ˜“å“ˆå¸Œ</th>
                            </tr>
                        </thead>
                        <tbody id="detailedTransactionTable">
                            <tr>
                                <td colspan="6" class="text-center text-gray-500 italic p-4">æš‚æ— äº¤æ˜“è®°å½•</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- å·¦ä¾§æˆåŠŸå¢åŠ å€’è®¡æ—¶åœ°å€åŒºåŸŸ -->
        <div id="successAddressesPanel" class="fixed top-32 left-4 w-80 bg-gray-800 border-meme p-4 rounded-xl shadow-lg z-50 max-h-[70vh] overflow-y-auto">
            <h3 class="text-memeYellow font-bold text-lg mb-3">ğŸ’° æˆåŠŸå¢åŠ å€’è®¡æ—¶åœ°å€</h3>
            <ul id="successAddressesList" class="space-y-2">
                <li class="text-gray-400 text-sm italic">ç­‰å¾…å¤§é¢ä¹°å…¥...</li>
                <li class="text-gray-400 text-sm italic">ç­‰å¾…å¤§é¢ä¹°å…¥...</li>
                <li class="text-gray-400 text-sm italic">ç­‰å¾…å¤§é¢ä¹°å…¥...</li>
                <li class="text-gray-400 text-sm italic">ç­‰å¾…å¤§é¢ä¹°å…¥...</li>
                <li class="text-gray-400 text-sm italic">ç­‰å¾…å¤§é¢ä¹°å…¥...</li>
            </ul>
        </div>
        
        <!-- å³ä¸Šè§’æ–°å¢åŒºåŸŸ -->
        <div id="topRightPanel" class="fixed top-4 right-4 w-80 bg-gray-800 border-meme p-4 rounded-xl shadow-lg z-50 max-h-[40vh] overflow-y-auto">
            <h3 class="text-memeYellow font-bold text-lg mb-3">ğŸ”— é’±åŒ…è¿æ¥</h3>
            
            <!-- é’±åŒ…è¿æ¥æŒ‰é’® -->
            <button id="walletConnectBtn" class="w-full bg-memeBlue hover:bg-blue-600 text-white font-bold py-2 px-4 rounded border-meme transition-all duration-300 mb-3">
                <span class="text-white">ğŸ”— è¿æ¥é’±åŒ…</span>
            </button>
            
            <!-- é’±åŒ…çŠ¶æ€æ˜¾ç¤º -->
            <div id="walletStatus" class="text-gray-400 text-sm mb-3">
                <span class="font-bold">æœªè¿æ¥</span>
            </div>
            
            <!-- æŒä»“å¥–åŠ±å€’è®¡æ—¶æ˜¾ç¤º -->
            <div class="bg-gray-700 border-meme p-3 rounded-lg mb-3">
                <div class="text-center">
                    <div class="text-memeYellow font-bold text-sm mb-1">ğŸ† æŒä»“å¥–åŠ±å€’è®¡æ—¶</div>
                    <div id="holderRewardCountdown" class="text-xl font-bold text-memePink">20:00</div>
                    <div class="text-gray-300 text-xs">æ¯3åˆ†é’Ÿå¿«ç…§ä¸€æ¬¡ï¼ˆæµ‹è¯•ï¼‰</div>
                </div>
            </div>
            
            <!-- åŠŸèƒ½æŒ‰é’®åŒºåŸŸ -->
            <div class="space-y-3">
                <!-- ç™½çš®ä¹¦æŒ‰é’® -->
                <button id="whitepaperBtn" class="w-full bg-memeGreen hover:bg-green-600 text-white font-bold py-2 px-4 rounded border-meme transition-all duration-300">
                    <span class="text-white">ğŸ“„ ç™½çš®ä¹¦</span>
                </button>
                
                <!-- é¢†å–å¥–åŠ±æŒ‰é’® -->
                <button id="claimRewardBtn" class="w-full bg-memePink hover:bg-pink-600 text-white font-bold py-2 px-4 rounded border-meme transition-all duration-300">
                    <span class="text-white">ğŸ é¢†å–å¥–åŠ±</span>
                </button>
            </div>
        </div>
        
        <!-- é¢†å–å¥–åŠ±é¡µé¢ -->
        <div id="rewardPage" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] hidden">
            <div class="bg-gray-800 border-meme p-6 rounded-xl shadow-lg w-[90vw] max-w-4xl max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-memeYellow font-bold text-2xl">ğŸ é¢†å–å¥–åŠ±</h3>
                    <button onclick="hideRewardPage()" class="text-gray-400 hover:text-white text-3xl">&times;</button>
                </div>
                
                <!-- å¥–åŠ±ä¿¡æ¯å±•ç¤ºåŒºåŸŸ -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <!-- æŒä»“å‰20æŒæœ‰è€…å¥–åŠ± -->
                    <div class="bg-gray-700 border-meme p-4 rounded-lg">
                        <div class="flex items-center mb-3">
                            <span class="text-2xl mr-2">ğŸ†</span>
                            <h4 class="text-memeYellow font-bold text-lg">æŒä»“å‰20æŒæœ‰è€…å¥–åŠ±</h4>
                        </div>
                        <div class="text-gray-300 text-sm mb-3">
                            <p>æŒæœ‰ä»£å¸æ•°é‡æ’åå‰20çš„åœ°å€ï¼Œæ¯äººå¯è·å¾—ç‰¹æ®Šå¥–åŠ±ï¼ˆæ¯3åˆ†é’Ÿå¿«ç…§ä¸€æ¬¡ï¼Œå¯éšæ—¶é¢†å–ï¼‰</p>
                        </div>
                        <div class="bg-gray-600 p-3 rounded mb-3">
                            <div class="text-memePink font-bold mb-2">å½“å‰çŠ¶æ€ï¼š</div>
                            <div id="top20Status" class="text-gray-300 text-sm">
                                <span class="text-yellow-400">â³ ç­‰å¾…æŒä»“æ•°æ®...</span>
                            </div>
                        </div>
                        <button id="claimTop20Btn" class="w-full bg-memeGreen hover:bg-green-600 text-white font-bold py-3 px-4 rounded border-meme transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
                            <span class="text-white">ğŸ† é¢†å–å‰20åå¥–åŠ±</span>
                        </button>
                    </div>
                    
                    <!-- æœ€åæˆåŠŸå¢åŠ å€’è®¡æ—¶åœ°å€å¥–åŠ± -->
                    <div class="bg-gray-700 border-meme p-4 rounded-lg">
                        <div class="flex items-center mb-3">
                            <span class="text-2xl mr-2">ğŸ’°</span>
                            <h4 class="text-memeYellow font-bold text-lg">æœ€åå€’è®¡æ—¶å¥–åŠ±</h4>
                        </div>
                        <div class="text-gray-300 text-sm mb-3">
                            <p>æœ€åä¸€ä¸ªæˆåŠŸå¢åŠ å€’è®¡æ—¶æ—¶é—´çš„åœ°å€å¯è·å¾—é¢å¤–å¥–åŠ±ï¼ˆå¯éšæ—¶é¢†å–ï¼‰</p>
                        </div>
                        <div class="bg-gray-600 p-3 rounded mb-3">
                            <div class="text-memePink font-bold mb-2">å½“å‰çŠ¶æ€ï¼š</div>
                            <div id="lastSuccessStatus" class="text-gray-300 text-sm">
                                <span class="text-yellow-400">â³ ç­‰å¾…å¤§é¢ä¹°å…¥æ•°æ®...</span>
                            </div>
                        </div>
                        <button id="claimLastSuccessBtn" class="w-full bg-memePink hover:bg-pink-600 text-white font-bold py-3 px-4 rounded border-meme transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
                            <span class="text-white">ğŸ’° é¢†å–æœ€åå€’è®¡æ—¶å¥–åŠ±</span>
                        </button>
                    </div>
                </div>
                
                <!-- åœ°å€éªŒè¯åŒºåŸŸ -->
                <div class="bg-gray-700 border-meme p-4 rounded-lg mb-6">
                    <div class="flex items-center mb-3">
                        <span class="text-2xl mr-2">ğŸ”</span>
                        <h4 class="text-memeYellow font-bold text-lg">åœ°å€éªŒè¯</h4>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-gray-300 text-sm mb-2">è¾“å…¥é’±åŒ…åœ°å€</label>
                            <input type="text" id="verifyAddressInput" placeholder="è¾“å…¥è¦éªŒè¯çš„é’±åŒ…åœ°å€" class="w-full p-3 bg-gray-600 border-2 border-gray-500 rounded-lg text-white placeholder-gray-400 focus:border-memeYellow focus:outline-none">
                        </div>
                        <div class="flex items-end">
                            <button id="verifyAddressBtn" class="w-full bg-memeBlue hover:bg-blue-600 text-white font-bold py-3 px-4 rounded border-meme transition-all duration-300">
                                <span class="text-white">ğŸ” éªŒè¯åœ°å€</span>
                            </button>
                        </div>
                        <div class="flex items-end">
                            <div id="verifyResult" class="w-full p-3 bg-gray-600 rounded-lg text-sm">
                                <span class="text-gray-400">ç­‰å¾…éªŒè¯...</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ç§¯åˆ†å…‘æ¢åŒºåŸŸ -->
                <div class="bg-gray-700 border-meme p-4 rounded-lg mb-6">
                    <div class="flex items-center mb-3">
                        <span class="text-2xl mr-2">ğŸª™</span>
                        <h4 class="text-memeYellow font-bold text-lg">ç§¯åˆ†å…‘æ¢ä»£å¸</h4>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <h5 class="text-memePink font-bold mb-2">å½“å‰ç§¯åˆ†çŠ¶æ€</h5>
                            <div id="scoreDetails" class="text-gray-300 text-sm space-y-1">
                                <div>â€¢ å½“å‰ç§¯åˆ†ï¼š<span id="currentScore">0</span></div>
                                <div>â€¢ å¯å…‘æ¢ä»£å¸ï¼š<span id="exchangeableTokens">0</span></div>
                                <div>â€¢ å…‘æ¢æ¯”ä¾‹ï¼š1ç§¯åˆ† = 1ä»£å¸</div>
                            </div>
                        </div>
                        <div class="flex items-center justify-center">
                            <button id="claimTokenBtn" class="w-full bg-memeGreen hover:bg-green-600 text-white font-bold py-3 px-4 rounded border-meme transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
                                <span class="text-white">ğŸª™ å…‘æ¢ä»£å¸</span>
                            </button>
                        </div>
                    </div>
                    <div class="text-gray-400 text-xs">
                        ğŸ’¡ æç¤ºï¼šé¢†å–æ¸¸æˆå¥–åŠ±åï¼Œæ‚¨å°†è·å¾—ç§¯åˆ†ã€‚ä½¿ç”¨ç§¯åˆ†å¯ä»¥å…‘æ¢çœŸå®çš„ä»£å¸åˆ°æ‚¨çš„é’±åŒ…ï¼
                    </div>
                    
                    <!-- è°ƒè¯•æŒ‰é’® -->
                    <div class="mt-4 p-3 bg-gray-600 rounded border border-yellow-500">
                        <div class="text-yellow-400 text-sm font-bold mb-2">ğŸ”§ è°ƒè¯•å·¥å…·</div>
                        <button id="debugBtn" class="bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded text-sm">
                            ğŸ” è°ƒè¯•éªŒè¯é€»è¾‘
                        </button>
                        <div id="debugResult" class="mt-2 text-xs text-gray-300"></div>
                    </div>
                </div>
                
                <!-- å¥–åŠ±è¯¦æƒ…å±•ç¤º -->
                <div class="bg-gray-700 border-meme p-4 rounded-lg mb-6">
                    <div class="flex items-center mb-3">
                        <span class="text-2xl mr-2">ğŸ“Š</span>
                        <h4 class="text-memeYellow font-bold text-lg">å¥–åŠ±è¯¦æƒ…</h4>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <h5 class="text-memePink font-bold mb-2">æŒä»“å‰20æŒæœ‰è€…</h5>
                            <div id="top20Details" class="text-gray-300 text-sm space-y-1">
                                <div>â€¢ æ€»æŒæœ‰è€…æ•°é‡ï¼š<span id="totalHolders">-</span></div>
                                <div>â€¢ å‰20åæ•°é‡ï¼š<span id="top20Count">20</span></div>
                                <div>â€¢ æ¯äººå¥–åŠ±ç§¯åˆ†ï¼š<span id="top20Reward">3000</span></div>
                            </div>
                        </div>
                        <div>
                            <h5 class="text-memePink font-bold mb-2">æœ€åå€’è®¡æ—¶åœ°å€</h5>
                            <div id="lastSuccessDetails" class="text-gray-300 text-sm space-y-1">
                                <div>â€¢ åœ°å€ï¼š<span id="lastSuccessAddress">-</span></div>
                                <div>â€¢ ä¹°å…¥æ•°é‡ï¼š<span id="lastSuccessAmount">-</span></div>
                                <div>â€¢ å¥–åŠ±ç§¯åˆ†ï¼š<span id="lastSuccessReward">10000</span></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- å†å²è·å¥–è½®æ¬¡åˆ—è¡¨ -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- æŒä»“å¥–åŠ±å†å²è½®æ¬¡ -->
                    <div class="bg-gray-700 border-meme p-4 rounded-lg">
                        <div class="flex items-center mb-3">
                            <span class="text-2xl mr-2">ğŸ†</span>
                            <h4 class="text-memeYellow font-bold text-lg">æŒä»“å¥–åŠ±å†å²</h4>
                        </div>
                        <div class="bg-gray-600 p-4 rounded max-h-60 overflow-y-auto">
                            <div id="holderRewardRoundsList" class="text-sm text-gray-300">
                                <div class="text-center text-gray-400">åŠ è½½æŒä»“å¥–åŠ±å†å²...</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- å€’è®¡æ—¶å¥–åŠ±å†å²è½®æ¬¡ -->
                    <div class="bg-gray-700 border-meme p-4 rounded-lg">
                        <div class="flex items-center mb-3">
                            <span class="text-2xl mr-2">âš¡</span>
                            <h4 class="text-memeYellow font-bold text-lg">å€’è®¡æ—¶å¥–åŠ±å†å²</h4>
                        </div>
                        <div class="bg-gray-600 p-4 rounded max-h-60 overflow-y-auto">
                            <div id="countdownRewardRoundsList" class="text-sm text-gray-300">
                                <div class="text-center text-gray-400">åŠ è½½å€’è®¡æ—¶å¥–åŠ±å†å²...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- é’±åŒ…é€‰æ‹©æ¨¡æ€æ¡† -->
        <div id="walletModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] hidden">
            <div class="bg-gray-800 border-meme p-6 rounded-xl shadow-lg w-96 max-w-[90vw]">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-memeYellow font-bold text-xl">é€‰æ‹©é’±åŒ…</h3>
                    <button onclick="window.walletManager.hideWalletModal()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
                </div>
                
                <div class="space-y-3">
                    <!-- OKXé’±åŒ… -->
                    <button onclick="window.walletManager.connectWallet('okx')" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded border-meme transition-all duration-300 flex items-center justify-between">
                        <div class="flex items-center">
                            <span class="text-2xl mr-3">ğŸ”µ</span>
                            <div class="text-left">
                                <div class="font-bold">OKX Wallet</div>
                                <div class="text-sm opacity-75">OKXäº¤æ˜“æ‰€é’±åŒ…</div>
                            </div>
                        </div>
                        <span class="text-lg">â†’</span>
                    </button>
                    
                    <!-- Phantomé’±åŒ… -->
                    <button onclick="window.walletManager.connectWallet('phantom')" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded border-meme transition-all duration-300 flex items-center justify-between">
                        <div class="flex items-center">
                            <span class="text-2xl mr-3">ğŸ‘»</span>
                            <div class="text-left">
                                <div class="font-bold">Phantom Wallet</div>
                                <div class="text-sm opacity-75">å¹½çµé’±åŒ…</div>
                            </div>
                        </div>
                        <span class="text-lg">â†’</span>
                    </button>
                    
                    <!-- Coinbaseé’±åŒ… -->
                    <button onclick="window.walletManager.connectWallet('coinbase')" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-3 px-4 rounded border-meme transition-all duration-300 flex items-center justify-between">
                        <div class="flex items-center">
                            <span class="text-2xl mr-3">ğŸŸ¡</span>
                            <div class="text-left">
                                <div class="font-bold">Coinbase Wallet</div>
                                <div class="text-sm opacity-75">Coinbaseé’±åŒ…</div>
                            </div>
                        </div>
                        <span class="text-lg">â†’</span>
                    </button>
                </div>
                
                <div class="mt-4 text-center">
                    <p class="text-gray-400 text-sm">
                        è¯·ç¡®ä¿å·²å®‰è£…ç›¸åº”çš„é’±åŒ…æ‰©å±•
                    </p>
                </div>
            </div>
        </div>
        
        <!-- å³ä¾§æŒä»“å‰20æŒæœ‰è€…åŒºåŸŸ -->
        <div id="topHoldersPanel" class="fixed bottom-4 right-4 w-80 bg-gray-800 border-meme p-3 rounded-xl shadow-lg z-50 max-h-[45vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-2">
                <h3 class="text-memeYellow font-bold text-base">ğŸ† æŒä»“å‰20æŒæœ‰è€…</h3>
                <div class="flex items-center gap-1">
                    <div id="holdersRefreshCountdown" class="text-memePink font-bold text-xs">10</div>
                    <span class="text-gray-400 text-xs">ç§’ååˆ·æ–°</span>
                </div>
            </div>
            <ul id="topHoldersList" class="space-y-1 text-xs">
                <li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>
                <li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>
                <li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>
                <li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>
                <li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>
                <li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>
                <li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>
                <li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>
                <li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>
                <li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>
                <li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>
                <li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>
                <li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>
                <li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>
                <li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>
                <li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>
                <li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>
                <li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>
            </ul>
        </div>
        
        <!-- ä¿¡æ¯åŒºåŸŸ -->
        <div class="max-w-3xl mx-auto text-center mt-12">
            <div class="bg-gray-800 border-meme p-6 rotate-random">
                <h3 class="text-2xl md:text-3xl text-memeYellow mb-4">Why This Meme Coin?</h3>
                <p class="text-white text-lg mb-4">Because why not? It's a meme coin, just like all the others, but <span class="text-memePink font-bold">this one is going to the moon!</span></p>
                <button class="bg-memePink hover:bg-pink-600 text-white font-bold py-3 px-8 border-meme transform hover:rotate-1 transition-all duration-300 mt-2">
                    BUY NOW BEFORE IT'S TOO LATE!
                </button>
            </div>
            
            <!-- ç¤¾äº¤åª’ä½“åˆ†äº« -->
            <div class="mt-10">
                <p class="text-white text-xl mb-4">SHARE THE HYPE!</p>
                <div class="flex justify-center gap-4">
                    <a href="#" class="bg-blue-500 hover:bg-blue-600 text-white w-12 h-12 rounded-full flex items-center justify-center border-meme transform hover:scale-110 transition-all">
                        <i class="fa fa-twitter text-2xl"></i>
                    </a>
                    <a href="#" class="bg-blue-700 hover:bg-blue-800 text-white w-12 h-12 rounded-full flex items-center justify-center border-meme transform hover:scale-110 transition-all">
                        <i class="fa fa-facebook text-2xl"></i>
                    </a>
                    <a href="#" class="bg-pink-600 hover:bg-pink-700 text-white w-12 h-12 rounded-full flex items-center justify-center border-meme transform hover:scale-110 transition-all">
                        <i class="fa fa-instagram text-2xl"></i>
                    </a>
                    <a href="#" class="bg-gray-800 hover:bg-gray-700 text-white w-12 h-12 rounded-full flex items-center justify-center border-meme transform hover:scale-110 transition-all">
                        <i class="fa fa-telegram text-2xl"></i>
                    </a>
                </div>
            </div>
        </div>
        
        <!-- é¡µè„š -->
        <footer class="mt-20 text-center text-gray-500 text-sm">
            <p>Disclaimer: This is a meme website. Not financial advice. Don't actually invest your life savings.</p>
            <p class="mt-2">ğŸš€ To the moon and beyond! ğŸš€</p>
        </footer>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-functions-compat.js"></script>
    
    <!-- é’±åŒ…è¿æ¥ç®¡ç†å™¨ -->
    <script src="wallet-connect.js"></script>
    <script>
        // Firebaseé…ç½®
        const firebaseConfig = {
            apiKey: "AIzaSyA5Z5ieEbAcfQX0kxGSn9ldGXhzvAwx_8M",
            authDomain: "chat-294cc.firebaseapp.com",
            databaseURL: "https://chat-294cc-default-rtdb.firebaseio.com",
            projectId: "chat-294cc",
            storageBucket: "chat-294cc.firebasestorage.app",
            messagingSenderId: "913615304269",
            appId: "1:913615304269:web:0274ffaccb8e6b678e4e04",
            measurementId: "G-SJR9NDW86B"
        };

        // åˆå§‹åŒ–Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const functions = firebase.app().functions('us-central1'); // æŒ‡å®šregion
        
        // Solanaå®æ—¶äº¤æ˜“æ£€æµ‹å™¨ç±»
        class SolanaTransactionTracker {
            constructor() {
                // å€’è®¡æ—¶ç›¸å…³å˜é‡
                this.countdownDate = new Date();
                this.countdownDate.setMinutes(this.countdownDate.getMinutes() + 5);
                this.originalCountdownDate = new Date(this.countdownDate);
                this.totalTimeAdjustment = 0;
                this.transactionCount = 0;
                this.countdownInterval = null;
                
                // è½®æ¬¡IDç›¸å…³å˜é‡
                this.currentRoundId = null;
                this.currentHolderRewardRoundId = null;
                
                // æŒä»“å¥–åŠ±å€’è®¡æ—¶ç›¸å…³å˜é‡
                this.holderRewardDate = new Date();
                this.holderRewardDate.setMinutes(this.holderRewardDate.getMinutes() + 3); // æ”¹ä¸º3åˆ†é’Ÿæµ‹è¯•
                this.holderRewardInterval = null;
                
                // äº¤æ˜“æ£€æµ‹ç›¸å…³å˜é‡
                this.isMonitoring = false;
                this.monitoringInterval = null;
                this.lastSignature = null;
                this.transactions = [];
                this.currentEndpointIndex = 0;
                
                // RPCé…ç½®
                this.rpcEndpoints = [
                    'https://small-holy-forest.solana-mainnet.quiknode.pro/b59315ea187b3de1b3542c5c25d7f2d5b5410ff4/',
                    'https://api.mainnet-beta.solana.com',
                    'https://solana-api.projectserum.com'
                ];
                
                // åˆå§‹åŒ–
                this.init();
            }
            
            init() {
                // åˆå§‹æ›´æ–°å€’è®¡æ—¶
                this.updateCountdown();
                this.updateHolderRewardCountdown();
                
                // å¯åŠ¨å€’è®¡æ—¶æ›´æ–°
                this.startCountdownUpdate();
                this.startHolderRewardCountdownUpdate();
                
                // ç»‘å®šäº‹ä»¶
                this.bindEvents();
                
                // ä»FirebaseåŠ è½½æ¸¸æˆæ•°æ®
                this.loadGameDataFromFirebase();
            }
            
            // å¯åŠ¨å€’è®¡æ—¶æ›´æ–°
            startCountdownUpdate() {
                // æ¸…é™¤å¯èƒ½å­˜åœ¨çš„æ—§å®šæ—¶å™¨
                if (this.countdownInterval) {
                    clearInterval(this.countdownInterval);
                }
                
                // å¯åŠ¨æ–°çš„å€’è®¡æ—¶æ›´æ–°
                this.countdownInterval = setInterval(() => {
                    this.updateCountdown();
                }, 1000);
            }
            
            // å¯åŠ¨æŒä»“å¥–åŠ±å€’è®¡æ—¶æ›´æ–°
            startHolderRewardCountdownUpdate() {
                // æ¸…é™¤å¯èƒ½å­˜åœ¨çš„æ—§å®šæ—¶å™¨
                if (this.holderRewardInterval) {
                    clearInterval(this.holderRewardInterval);
                }
                
                // å¯åŠ¨æ–°çš„æŒä»“å¥–åŠ±å€’è®¡æ—¶æ›´æ–°
                this.holderRewardInterval = setInterval(() => {
                    this.updateHolderRewardCountdown();
                }, 1000);
            }
            
            bindEvents() {
                // ç›‘æ§åŠŸèƒ½å·²ç§»è‡³ç®¡ç†é¢æ¿
            }
            
            // æ›´æ–°å€’è®¡æ—¶
            updateCountdown() {
            const now = new Date();
                const timeLeft = this.countdownDate - now;
                
                // è°ƒè¯•ä¿¡æ¯
                console.log('å€’è®¡æ—¶è°ƒè¯•:', {
                    countdownDate: this.countdownDate,
                    now: now,
                    timeLeft: timeLeft,
                    minutes: Math.floor(timeLeft / (1000 * 60)),
                    seconds: Math.floor((timeLeft % (1000 * 60)) / 1000)
                });
                
                // è®¡ç®—å‰©ä½™çš„åˆ†ã€ç§’ï¼Œå¤„ç†è´Ÿæ•°æƒ…å†µ
                const minutes = Math.max(0, Math.floor(timeLeft / (1000 * 60)));
                const seconds = Math.max(0, Math.floor((timeLeft % (1000 * 60)) / 1000));
            
            // æ˜¾ç¤ºå€’è®¡æ—¶ï¼Œç¡®ä¿ä¸¤ä½æ•°æ ¼å¼
            document.getElementById("minutes").innerText = minutes.toString().padStart(2, '0');
            document.getElementById("seconds").innerText = seconds.toString().padStart(2, '0');
            
            // å€’è®¡æ—¶ç»“æŸæ—¶çš„å¤„ç†
            if (timeLeft < 0) {
                console.log('å€’è®¡æ—¶ç»“æŸæ£€æµ‹ï¼štimeLeft =', timeLeft, 'countdownEnded =', gameData.countdownEnded);
                
                // åªåœ¨ç¬¬ä¸€æ¬¡å€’è®¡æ—¶ç»“æŸæ—¶æ˜¾ç¤ºLAUNCHED
                if (!gameData.countdownEnded) {
                    console.log('æ˜¾ç¤ºLAUNCHEDç•Œé¢ï¼Œè°ƒç”¨onCountdownEndedå’ŒpauseGame');
                    
                document.getElementById("countdown").innerHTML = `
                        <div class="col-span-2 text-center">
                        <div class="text-[clamp(2rem,8vw,5rem)] font-bold text-memePink">LAUNCHED!</div>
                        <div class="text-2xl text-white mt-4">TO THE MOON!!! ğŸš€</div>
                    </div>
                `;
                    
                    // å€’è®¡æ—¶ç»“æŸæ—¶è‡ªåŠ¨æ•æ‰æ•°æ®
                    gameData.countdownEnded = true;
                    this.onCountdownEnded();
                    
                    // æ¸¸æˆæš‚åœé€»è¾‘
                    this.pauseGame();
                } else {
                    console.log('å€’è®¡æ—¶å·²ç»“æŸï¼Œä½†countdownEndedä¸ºtrueï¼Œè·³è¿‡å¤„ç†');
                }
            } else {
                // å€’è®¡æ—¶æœªç»“æŸæ—¶ï¼Œç¡®ä¿æ˜¾ç¤ºæ­£å¸¸çš„å€’è®¡æ—¶ç»“æ„
                const countdownElement = document.getElementById("countdown");
                if (countdownElement.innerHTML.includes("LAUNCHED")) {
                    // å¦‚æœå½“å‰æ˜¾ç¤ºçš„æ˜¯LAUNCHEDï¼Œæ¢å¤å€’è®¡æ—¶æ˜¾ç¤ºç»“æ„
                    countdownElement.innerHTML = `
                        <!-- åˆ† -->
                        <div class="bg-memePurple border-meme p-4 text-center transform hover:scale-105 transition-all duration-300 glow">
                            <div id="minutes" class="text-[clamp(2rem,6vw,4rem)] font-bold text-white">00</div>
                            <div class="text-white font-bold">MINUTES</div>
                        </div>
                        
                        <!-- ç§’ -->
                        <div class="bg-memeGreen border-meme p-4 text-center transform hover:scale-105 transition-all duration-300 glow">
                            <div id="seconds" class="text-[clamp(2rem,6vw,4rem)] font-bold text-black">00</div>
                            <div class="text-black font-bold">SECONDS</div>
                        </div>
                    `;
                }
            }
        }
        
        // æ›´æ–°æŒä»“å¥–åŠ±å€’è®¡æ—¶
        updateHolderRewardCountdown() {
            const now = new Date();
            const timeLeft = this.holderRewardDate - now;
            
            // è®¡ç®—å‰©ä½™çš„åˆ†ã€ç§’ï¼Œå¤„ç†è´Ÿæ•°æƒ…å†µ
            const minutes = Math.max(0, Math.floor(timeLeft / (1000 * 60)));
            const seconds = Math.max(0, Math.floor((timeLeft % (1000 * 60)) / 1000));
            
            // æ˜¾ç¤ºæŒä»“å¥–åŠ±å€’è®¡æ—¶
            const holderRewardElement = document.getElementById('holderRewardCountdown');
            if (holderRewardElement) {
                holderRewardElement.innerText = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
            
            // æŒä»“å¥–åŠ±å€’è®¡æ—¶ç»“æŸæ—¶çš„å¤„ç†
            if (timeLeft < 0) {
                if (!gameData.holderRewardEnded) {
                    console.log('æŒä»“å¥–åŠ±å€’è®¡æ—¶ç»“æŸï¼Œå¼€å§‹å¿«ç…§...');
                    gameData.holderRewardEnded = true;
                    this.onHolderRewardEnded();
                    
                    // é‡ç½®æŒä»“å¥–åŠ±å€’è®¡æ—¶ä¸º3åˆ†é’Ÿï¼ˆæµ‹è¯•ç”¨ï¼‰
                    this.holderRewardDate = new Date(Date.now() + 3 * 60 * 1000);
                    gameData.holderRewardEnded = false;
                    console.log('æŒä»“å¥–åŠ±å€’è®¡æ—¶å·²é‡ç½®ä¸º3åˆ†é’Ÿ');
                }
            }
        }
        
            // å¼€å§‹ç›‘æ§
            async startMonitoring() {
                const tokenAddress = document.getElementById('tokenAddress').value.trim();
                
                if (!tokenAddress) {
                    alert('è¯·è¾“å…¥ä»£å¸åœ°å€');
                    return;
                }
                
                if (this.isMonitoring) return;
                
                this.isMonitoring = true;
                document.getElementById('detectionStatus').innerHTML = 'ğŸŸ¢ ç›‘æ§ä¸­...';
                
                this.addLogEntry('ğŸš€ Solanaäº¤æ˜“ç›‘æ§å·²å¯åŠ¨', 'info');
                this.updateSyncStatus('syncing', 'å¯åŠ¨ç›‘æ§...');
                
                // å¯åŠ¨æŒä»“è€…è‡ªåŠ¨åˆ·æ–°
                startTopHoldersAutoRefresh(tokenAddress);
                
                // ç«‹å³è·å–ä¸€æ¬¡äº¤æ˜“è®°å½•
                await this.fetchLatestTransactions(tokenAddress);
                
                // å¼€å§‹å®šæ—¶ç›‘æ§
                this.monitoringInterval = setInterval(async () => {
                    if (this.isMonitoring) {
                        await this.fetchLatestTransactions(tokenAddress);
                    }
                }, 3000); // æ¯3ç§’æ£€æŸ¥ä¸€æ¬¡
            }
            
            // åœæ­¢ç›‘æ§
            stopMonitoring() {
                if (!this.isMonitoring) return;
                
                this.isMonitoring = false;
                document.getElementById('detectionStatus').innerHTML = 'ğŸ”´ å·²åœæ­¢';
                
                if (this.monitoringInterval) {
                    clearInterval(this.monitoringInterval);
                    this.monitoringInterval = null;
                }
                
                // åœæ­¢æŒä»“è€…è‡ªåŠ¨åˆ·æ–°
                stopTopHoldersAutoRefresh();
                
                this.addLogEntry('â¹ï¸ Solanaäº¤æ˜“ç›‘æ§å·²åœæ­¢', 'warning');
                this.updateSyncStatus('default', 'ç›‘æ§å·²åœæ­¢');
            }
            
            // æ¢å¤æ¸¸æˆ
            resumeGame() {
                gameData.isPaused = false;
                gameData.isMonitoring = true;
                this.isMonitoring = true;
                this.startMonitoring();
                this.addLogEntry('â–¶ï¸ æ¸¸æˆå·²æ¢å¤', 'success');
                console.log('æ¸¸æˆå·²æ¢å¤');
            }
            
            // è·å–æœ€æ–°äº¤æ˜“
            async fetchLatestTransactions(tokenAddress) {
                try {
                    this.updateSyncStatus('syncing', 'æ£€æŸ¥æ–°äº¤æ˜“...');
                    
                    const signatures = await this.makeRpcCall('getSignaturesForAddress', [
                        tokenAddress,
                        { limit: 10 }
                    ]);
                    
                    if (!signatures || signatures.length === 0) {
                        this.updateSyncStatus('success', 'æ— æ–°äº¤æ˜“');
                        return;
                    }
                    
                    // æ£€æŸ¥æ˜¯å¦æœ‰æ–°äº¤æ˜“
                    const latestSignature = signatures[0].signature;
                    if (this.lastSignature && this.lastSignature === latestSignature) {
                        this.updateSyncStatus('success', 'æ— æ–°äº¤æ˜“');
                        return; // æ²¡æœ‰æ–°äº¤æ˜“
                    }
                    
                    // è·å–æ–°äº¤æ˜“
                    const newTransactions = [];
                    for (let i = 0; i < signatures.length; i++) {
                        const sig = signatures[i];
                        if (this.lastSignature && sig.signature === this.lastSignature) {
                            break; // å·²ç»å¤„ç†è¿‡çš„äº¤æ˜“
                        }
                        newTransactions.push(sig);
                    }
                    
                    if (newTransactions.length > 0) {
                        console.log(`æ£€æµ‹åˆ° ${newTransactions.length} ç¬”æ–°äº¤æ˜“`);
                        this.addLogEntry(`ğŸ” æ£€æµ‹åˆ° ${newTransactions.length} ç¬”æ–°äº¤æ˜“`, 'info');
                        this.updateSyncStatus('syncing', `å¤„ç† ${newTransactions.length} ç¬”äº¤æ˜“...`);
                        
                        // è·å–æ–°äº¤æ˜“çš„è¯¦ç»†ä¿¡æ¯
                        const transactionDetails = await this.getTransactionDetails(newTransactions, tokenAddress);
                        
                        // æ·»åŠ åˆ°äº¤æ˜“åˆ—è¡¨
                        this.transactions.unshift(...transactionDetails);
                        
                        // ä¿æŒæœ€å¤š100æ¡è®°å½•
                        if (this.transactions.length > 100) {
                            this.transactions = this.transactions.slice(0, 100);
                        }
                        
                        // å¤„ç†æ¯ä¸ªæ–°äº¤æ˜“
                        for (const tx of transactionDetails) {
                            if (tx) {
                                console.log('å¤„ç†äº¤æ˜“:', tx);
                                this.processTransaction(tx);
                            }
                        }
                        
                        this.lastSignature = latestSignature;
                        this.updateTransactionsDisplay();
                        this.updateSyncStatus('success', `å·²åŒæ­¥ ${newTransactions.length} ç¬”äº¤æ˜“`);
                    } else {
                        this.updateSyncStatus('success', 'æ— æ–°äº¤æ˜“');
                    }
                    
                } catch (error) {
                    console.error('è·å–äº¤æ˜“å¤±è´¥:', error);
                    document.getElementById('detectionStatus').innerHTML = 'ğŸ”´ è¿æ¥é”™è¯¯';
                    this.addLogEntry(`âŒ è·å–äº¤æ˜“å¤±è´¥: ${error.message}`, 'error');
                    this.updateSyncStatus('error', 'åŒæ­¥å¤±è´¥');
                }
            }
            
            // è·å–äº¤æ˜“è¯¦æƒ…
            async getTransactionDetails(signatures, tokenAddress) {
                const details = [];
                
                for (const sig of signatures) {
                    try {
                        const txData = await this.makeRpcCall('getTransaction', [
                            sig.signature,
                            {
                                encoding: 'jsonParsed',
                                maxSupportedTransactionVersion: 0
                            }
                        ]);
                        
                        const transaction = this.parseTransaction(txData, sig, tokenAddress);
                        if (transaction) {
                            details.push(transaction);
                        }
                    } catch (error) {
                        console.warn('è·å–äº¤æ˜“è¯¦æƒ…å¤±è´¥:', error);
                    }
                }
                
                return details;
            }
            
            // è§£æäº¤æ˜“
            parseTransaction(tx, sig, tokenAddress) {
                if (!tx || !tx.meta) {
                    return null;
                }
                
                const tokenInstructions = tx.meta.postTokenBalances || [];
                const preTokenBalances = tx.meta.preTokenBalances || [];
                
                const relevantBalances = tokenInstructions.filter(balance => 
                    balance.mint === tokenAddress
                );
                
                if (relevantBalances.length === 0) {
                    return null;
                }
                
                const balanceChanges = relevantBalances.map(balance => {
                    const preBalance = preTokenBalances.find(pre => 
                        pre.accountIndex === balance.accountIndex && pre.mint === tokenAddress
                    );
                    
                    const preAmount = preBalance ? parseInt(preBalance.uiTokenAmount.amount) : 0;
                    const postAmount = parseInt(balance.uiTokenAmount.amount);
                    const change = postAmount - preAmount;
                    
                    return {
                        account: balance.owner,
                        change: change,
                        amount: Math.abs(change)
                    };
                });
                
                // è·å–æ‰€æœ‰ä»£å¸ä½™é¢å˜åŒ–ï¼Œç”¨äºåˆ†æä¹°å…¥/å–å‡º
                const allBalanceChanges = tokenInstructions.map(balance => {
                    const preBalance = preTokenBalances.find(pre => 
                        pre.accountIndex === balance.accountIndex && pre.mint === balance.mint
                    );
                    
                    const preAmount = preBalance ? parseInt(preBalance.uiTokenAmount.amount) : 0;
                    const postAmount = parseInt(balance.uiTokenAmount.amount);
                    const change = postAmount - preAmount;
                    
                    return {
                        account: balance.owner,
                        mint: balance.mint,
                        change: change,
                        amount: Math.abs(change)
                    };
                });
                
                return {
                    signature: sig.signature,
                    blockTime: sig.blockTime,
                    amount: balanceChanges[0]?.amount || 0,
                    type: this.determineTransactionType(balanceChanges),
                    src: balanceChanges.find(b => b.change < 0)?.account || 'N/A',
                    dst: balanceChanges.find(b => b.change > 0)?.account || 'N/A',
                    allBalanceChanges: allBalanceChanges // æ·»åŠ æ‰€æœ‰ä½™é¢å˜åŒ–ä¿¡æ¯
                };
            }
            
            // ç¡®å®šäº¤æ˜“ç±»å‹
            determineTransactionType(balanceChanges) {
                if (balanceChanges.length === 0) return 'è½¬ç§»';
                
                const hasMint = balanceChanges.some(b => b.change > 0 && b.account === '11111111111111111111111111111111');
                const hasBurn = balanceChanges.some(b => b.change < 0 && b.account === '11111111111111111111111111111111');
                
                if (hasMint) return 'é“¸é€ ';
                if (hasBurn) return 'é”€æ¯';
                return 'è½¬ç§»';
            }
            
            // å¤„ç†äº¤æ˜“
            processTransaction(tx) {
                const tradeType = this.determineTradeType(tx);
                const timeToAdd = 60; // æ¯æ¬¡ä¹°å…¥äº¤æ˜“å¢åŠ 60ç§’
                const amount = this.formatNumber(tx.amount, 9);
                this.transactionCount++;

                        // æ¸¸æˆé€»è¾‘ï¼šæ£€æŸ¥æ˜¯å¦è¾¾åˆ°100000æ•°é‡é˜ˆå€¼å¹¶å¢åŠ å€’è®¡æ—¶
        if (tradeType === 'ä¹°å…¥') {
            // æ£€æŸ¥æ˜¯å¦è¾¾åˆ°100000æ•°é‡é˜ˆå€¼
            if (tx.amount >= 100000) {
                // æ£€æŸ¥æ˜¯å¦è¶…è¿‡10åˆ†é’Ÿä¸Šé™
                const currentAdjustment = this.totalTimeAdjustment + gameData.countdownIncrement;
                if (currentAdjustment <= gameData.maxCountdown) {
                    this.totalTimeAdjustment = currentAdjustment;
                    this.countdownDate.setTime(this.countdownDate.getTime() + (gameData.countdownIncrement * 1000));
                    
                    // æ›´æ–°æ˜¾ç¤º
                    document.getElementById('transactionCount').innerText = this.transactionCount;
                    document.getElementById('timeAdjustment').innerText = `+${this.totalTimeAdjustment} ç§’`;
                    this.addLogEntry(`ğŸ’° æ£€æµ‹åˆ°å¤§é¢ä¹°å…¥äº¤æ˜“ #${this.transactionCount}ï¼æ•°é‡: ${amount}ï¼Œå€’è®¡æ—¶ +${gameData.countdownIncrement}ç§’`, 'success');
                    
                    // è®°å½•æˆåŠŸå¢åŠ å€’è®¡æ—¶çš„åœ°å€
                    addSuccessAddress(tx.dst, amount, tx.blockTime);
                    
                    // æ›´æ–°æ¸¸æˆæ•°æ®ä¸­çš„æœ€åå¤§é¢ä¹°å…¥åœ°å€
                    gameData.lastBigBuyAddress = tx.dst;
                    gameData.lastBigBuyAmount = tx.amount;
                    
                    // ä¿å­˜äº¤æ˜“è®°å½•åˆ°Firebase
                    this.saveTransactionToFirebase(tx);
                    
                    // æ·»åŠ è§†è§‰åé¦ˆ
                    document.getElementById('timeAdjustment').classList.add('animate-pulse');
                    setTimeout(() => {
                        document.getElementById('timeAdjustment').classList.remove('animate-pulse');
                    }, 1000);
                } else {
                    this.addLogEntry(`âš ï¸ å¤§é¢ä¹°å…¥äº¤æ˜“ #${this.transactionCount} æ£€æµ‹åˆ°ï¼Œä½†å·²è¾¾åˆ°10åˆ†é’Ÿä¸Šé™ï¼`, 'warning');
                }
            } else {
                // ä¹°å…¥æ•°é‡ä¸è¶³100000ï¼Œåªè®°å½•æ—¥å¿—
                this.addLogEntry(`æ£€æµ‹åˆ°å°é¢ä¹°å…¥äº¤æ˜“ #${this.transactionCount}ï¼Œæ•°é‡: ${amount}ï¼Œæœªè¾¾åˆ°100000é˜ˆå€¼`, 'info');
            }
        } else {
            // éä¹°å…¥äº¤æ˜“åªè®°å½•æ—¥å¿—
            this.addLogEntry(`æ£€æµ‹åˆ°${tradeType}äº¤æ˜“ #${this.transactionCount}ï¼Œæ•°é‡: ${amount}ï¼Œä¸å¢åŠ å€’è®¡æ—¶`, 'info');
        }
            }
            
            // åˆ¤æ–­æ˜¯å¦ä¸ºLPæ± åœ°å€
            isLpAddress(address) {
                if (!address) return false;
                // è¿™é‡Œå¯ä»¥ç»´æŠ¤å¤šä¸ªæ± å­åœ°å€
                const lpAddresses = [
                    'WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh',
                    // æœªæ¥å¯æ‰©å±•æ›´å¤šæ± å­
                ];
                return lpAddresses.includes(address);
            }

            // åªæ ¹æ®LPæ± åˆ¤æ–­ä¹°å…¥/å–å‡º
            determineTradeType(tx) {
                // åªåˆ¤æ–­LPæ± 
                if (tx.type === 'é“¸é€ ') {
                    return 'ä¹°å…¥';
                } else if (tx.type === 'é”€æ¯') {
                    return 'å–å‡º';
                } else if (tx.type === 'è½¬ç§»') {
                    const isSrcLp = this.isLpAddress(tx.src);
                    const isDstLp = this.isLpAddress(tx.dst);
                    if (isSrcLp && !isDstLp) {
                        return 'ä¹°å…¥';
                    } else if (isDstLp && !isSrcLp) {
                        return 'å–å‡º';
                    } else {
                        return 'è½¬ç§»';
                    }
                }
                return 'è½¬ç§»';
            }
            
            // æ›´æ–°äº¤æ˜“æ˜¾ç¤º
            updateTransactionsDisplay() {
                const tbody = document.getElementById('detailedTransactionTable');
                
                if (!tbody) {
                    console.error('æ‰¾ä¸åˆ°è¯¦ç»†äº¤æ˜“è¡¨æ ¼å…ƒç´ ');
                    return;
                }
                
                console.log('æ›´æ–°è¯¦ç»†äº¤æ˜“è¡¨æ ¼ï¼Œè®°å½•æ•°é‡:', this.transactions.length);
                
                // æ›´æ–°è®¡æ•°å™¨
                const detailedCount = document.getElementById('detailedCount');
                if (detailedCount) {
                    detailedCount.textContent = `${this.transactions.length} æ¡è®°å½•`;
                }
                
                if (this.transactions.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" class="text-center text-gray-500 italic p-4">æš‚æ— äº¤æ˜“è®°å½•</td></tr>';
                    return;
                }
                
                tbody.innerHTML = '';
                
                this.transactions.forEach((tx, index) => {
                    const row = document.createElement('tr');
                    // æ–°äº¤æ˜“é«˜äº®æ•ˆæœ
                    if (index < 5) {
                        row.classList.add('bg-green-900', 'bg-opacity-20');
                    }
                    // æ ¹æ®äº¤æ˜“ç±»å‹è®¾ç½®é¢œè‰²
                    let typeClass = 'text-gray-300';
                    const tradeType = this.determineTradeType(tx);
                    if (tradeType === 'ä¹°å…¥') {
                        typeClass = 'text-green-400 font-bold';
                    } else if (tradeType === 'å–å‡º') {
                        typeClass = 'text-red-400 font-bold';
                    } else if (tradeType === 'è½¬ç§»') {
                        typeClass = 'text-blue-400 font-bold';
                    }
                    const timestamp = new Date(tx.blockTime * 1000).toLocaleString('zh-CN');
                    const amount = this.formatNumber(tx.amount, 9);
                    // äº¤æ˜“è€…é€»è¾‘
                    let trader = '';
                    if (tradeType === 'ä¹°å…¥') {
                        trader = tx.dst;
                    } else if (tradeType === 'å–å‡º') {
                        trader = tx.src;
                    } else {
                        trader = tx.src + ' â†’ ' + tx.dst;
                    }
                    row.innerHTML = `
                        <td class="p-2 text-gray-400">${timestamp}</td>
                        <td class="p-2">
                            <span class="${typeClass}">${tradeType}</span>
                        </td>
                        <td class="p-2 text-white font-bold">${amount}</td>
                        <td class="p-2">
                            <span class="text-blue-400 cursor-pointer hover:text-blue-300" onclick="window.open('https://solscan.io/account/${trader}', '_blank')" title="${trader}">
                                ${trader ? trader.substring(0, 6) + '...' + trader.substring(trader.length - 4) : 'N/A'}
                            </span>
                        </td>
                        <td class="p-2">
                            <span class="text-memeYellow cursor-pointer hover:text-yellow-300" onclick="window.open('https://solscan.io/tx/${tx.signature}', '_blank')" title="${tx.signature}">
                                ${tx.signature.substring(0, 6)}...${tx.signature.substring(tx.signature.length - 4)}
                            </span>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
                
                console.log('è¯¦ç»†äº¤æ˜“è¡¨æ ¼æ›´æ–°å®Œæˆ');
            }
            
            // æ ¼å¼åŒ–æ•°å­—
            formatNumber(amount, decimals) {
                if (!amount) return '0';
                const num = parseFloat(amount) / Math.pow(10, decimals || 9);
                return num.toLocaleString('zh-CN', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 6
                });
            }
            
            // RPCè°ƒç”¨
            async makeRpcCall(method, params, endpointIndex = 0) {
                const endpoint = this.rpcEndpoints[endpointIndex];
                
                // æ›´æ–°å½“å‰RPCæ˜¾ç¤º
                this.updateCurrentRpc(endpoint, endpointIndex);
                
                try {
                    const response = await fetch(endpoint, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            jsonrpc: '2.0',
                            id: Math.floor(Math.random() * 1000),
                            method: method,
                            params: params
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const data = await response.json();
                    
                    if (data.error) {
                        throw new Error(`RPC Error: ${data.error.message}`);
                    }
                    
                    // æˆåŠŸä½¿ç”¨å½“å‰RPC
                    this.updateCurrentRpc(endpoint, endpointIndex, true);
                    return data.result;
                } catch (error) {
                    console.warn(`RPCè°ƒç”¨å¤±è´¥ (${endpoint}):`, error);
                    
                    // æ ‡è®°å½“å‰RPCå¤±è´¥
                    this.updateCurrentRpc(endpoint, endpointIndex, false);
                    
                    if (endpointIndex < this.rpcEndpoints.length - 1) {
                        return await this.makeRpcCall(method, params, endpointIndex + 1);
                    }
                    
                    throw error;
                }
            }
            
            // æ›´æ–°RPCçŠ¶æ€
            updateCurrentRpc(endpoint, index, success = null) {
                const rpcNames = ['QuickNode', 'Solanaå®˜æ–¹', 'Project Serum'];
                const rpcName = rpcNames[index] || `RPC ${index + 1}`;
                
                let status = '';
                if (success === true) {
                    status = 'âœ…';
                } else if (success === false) {
                    status = 'âŒ';
                } else {
                    status = 'ğŸ”„';
                }
                
                document.getElementById('rpcStatus').textContent = `${status} ${rpcName}`;
            }
            
            // æ›´æ–°åŒæ­¥çŠ¶æ€
            updateSyncStatus(status, message) {
                const indicator = document.getElementById('syncIndicator');
                const statusText = document.getElementById('syncStatus');
                
                if (!indicator || !statusText) return;
                
                switch (status) {
                    case 'syncing':
                        indicator.className = 'w-2 h-2 bg-yellow-500 rounded-full animate-pulse';
                        statusText.textContent = 'åŒæ­¥ä¸­...';
                        statusText.className = 'text-xs text-yellow-400';
                        break;
                    case 'success':
                        indicator.className = 'w-2 h-2 bg-green-500 rounded-full';
                        statusText.textContent = message || 'åŒæ­¥å®Œæˆ';
                        statusText.className = 'text-xs text-green-400';
                        break;
                    case 'error':
                        indicator.className = 'w-2 h-2 bg-red-500 rounded-full';
                        statusText.textContent = message || 'åŒæ­¥é”™è¯¯';
                        statusText.className = 'text-xs text-red-400';
                        break;
                    default:
                        indicator.className = 'w-2 h-2 bg-gray-500 rounded-full';
                        statusText.textContent = message || 'ç­‰å¾…åŒæ­¥...';
                        statusText.className = 'text-xs text-gray-400';
                }
            }
            
            // æ·»åŠ æ—¥å¿—
            addLogEntry(message, type = 'info') {
                const logContainer = document.getElementById('transactionLog');
                const timestamp = new Date().toLocaleTimeString();
                
                let colorClass = 'text-gray-300';
                if (type === 'success') colorClass = 'text-green-400';
                else if (type === 'warning') colorClass = 'text-yellow-400';
                else if (type === 'error') colorClass = 'text-red-400';
                
                const logEntry = document.createElement('div');
                logEntry.className = colorClass;
                logEntry.innerHTML = `[${timestamp}] ${message}`;
                
                // ç§»é™¤ç­‰å¾…æ¶ˆæ¯
                const waitingMsg = logContainer.querySelector('.text-gray-500');
                if (waitingMsg) {
                    waitingMsg.remove();
                }
                
                logContainer.insertBefore(logEntry, logContainer.firstChild);
                
                // é™åˆ¶æ—¥å¿—æ¡ç›®æ•°é‡ä¸º100æ¡
                while (logContainer.children.length > 100) {
                    logContainer.removeChild(logContainer.lastChild);
                }
            }
            
            // æ¨¡æ‹Ÿäº¤æ˜“åŠŸèƒ½å·²ç§»è‡³ç®¡ç†é¢æ¿
            
            // é‡ç½®å€’è®¡æ—¶åŠŸèƒ½å·²ç§»è‡³ç®¡ç†é¢æ¿
            
            // å€’è®¡æ—¶ç»“æŸæ—¶çš„å¤„ç†
            async onCountdownEnded() {
                this.addLogEntry('ğŸ‰ å€’è®¡æ—¶ç»“æŸï¼å¼€å§‹è‡ªåŠ¨æ•æ‰æ•°æ®...', 'success');
                
                try {
                    // 1. è‡ªåŠ¨è·å–æŒä»“å‰20çš„åœ°å€
                    await this.captureTop20Holders();
                    
                    // 2. è®°å½•æœ€åå¤§é¢ä¹°å…¥åœ°å€
                    this.captureLastBigBuyAddress();
                    
                    // 3. è§¦å‘å¥–åŠ±å‘æ”¾
                    this.triggerRewards();
                    
                    // 4. æ›´æ–°å¥–åŠ±é¡µé¢æ•°æ®
                    this.updateRewardData();
                    
                } catch (error) {
                    this.addLogEntry(`âŒ è‡ªåŠ¨æ•æ‰æ•°æ®å¤±è´¥: ${error.message}`, 'error');
                }
            }
            
            // æŒä»“å¥–åŠ±å€’è®¡æ—¶ç»“æŸæ—¶çš„å¤„ç†
            async onHolderRewardEnded() {
                this.addLogEntry('ğŸ† æŒä»“å¥–åŠ±å¿«ç…§å¼€å§‹ï¼å¼€å§‹æ•æ‰å‰20æŒæœ‰è€…...', 'success');
                
                try {
                    // 1. æ•æ‰å½“å‰æŒä»“å‰20æŒæœ‰è€…
                    await this.captureTop20Holders();
                    
                    // 2. ä¿å­˜æŒä»“å¥–åŠ±è½®æ¬¡
                    this.saveHolderRewardRound();
                    
                    // 3. æ›´æ–°æŒä»“å¥–åŠ±é¡µé¢æ•°æ®
                    this.updateHolderRewardData();
                    
                    // 4. è®°å½•æ—¥å¿—
                    this.addLogEntry('ğŸ† æŒä»“å¥–åŠ±å¿«ç…§å®Œæˆï¼Œå‰20æŒæœ‰è€…å·²è®°å½•ï¼Œå€’è®¡æ—¶å·²é‡ç½®ä¸º3åˆ†é’Ÿ', 'success');
                    
                } catch (error) {
                    this.addLogEntry(`âŒ æŒä»“å¥–åŠ±å¿«ç…§å¤±è´¥: ${error.message}`, 'error');
                }
            }
            
            // è‡ªåŠ¨æ•æ‰æŒä»“å‰20æŒæœ‰è€…
            async captureTop20Holders() {
                const tokenAddress = document.getElementById('tokenAddress').value.trim();
                if (!tokenAddress) {
                    throw new Error('ä»£å¸åœ°å€æœªè®¾ç½®');
                }
                
                try {
                    // ä½¿ç”¨ç°æœ‰çš„fetchTopHoldersé€»è¾‘è·å–å‰20å
                    const data = await this.makeRpcCall('getProgramAccounts', [
                        'TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA',
                        {
                            encoding: 'jsonParsed',
                            filters: [
                                { dataSize: 165 },
                                { memcmp: { offset: 0, bytes: tokenAddress } }
                            ]
                        }
                    ]);
                    
                    if (data && Array.isArray(data) && data.length > 0) {
                        // ç»Ÿè®¡æ‰€æœ‰ownerå’Œä½™é¢ï¼Œæ’é™¤LPæ± å­
                        const holders = {};
                        const lpAddresses = ['WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh'];
                        
                        data.forEach(acc => {
                            const owner = acc.account.data.parsed.info.owner;
                            const amount = parseInt(acc.account.data.parsed.info.tokenAmount.amount);
                            if (lpAddresses.includes(owner)) return;
                            if (!holders[owner]) holders[owner] = 0;
                            holders[owner] += amount;
                        });
                        
                        // æ’åºå–å‰20
                        const sorted = Object.entries(holders)
                            .sort((a, b) => b[1] - a[1])
                            .slice(0, 20);
                        
                        gameData.top20Holders = sorted.map(([address, amount], index) => ({
                            rank: index + 1,
                            address: address,
                            amount: amount
                        }));
                        
                        this.addLogEntry(`ğŸ“Š æˆåŠŸæ•æ‰æŒä»“å‰20æŒæœ‰è€…æ•°æ®ï¼Œå…±${gameData.top20Holders.length}ä¸ªåœ°å€`, 'success');
                        
                        // ä¿å­˜æŒä»“æ•°æ®åˆ°Firebase
                        this.saveHoldersDataToFirebase(gameData.top20Holders);
                    }
                } catch (error) {
                    throw new Error(`è·å–æŒä»“æ•°æ®å¤±è´¥: ${error.message}`);
                }
            }
            
            // æ•æ‰æœ€åå¤§é¢ä¹°å…¥åœ°å€
            captureLastBigBuyAddress() {
                if (gameData.lastBigBuyAddress) {
                    this.addLogEntry(`ğŸ’° æœ€åå¤§é¢ä¹°å…¥åœ°å€: ${gameData.lastBigBuyAddress.substring(0, 6)}...${gameData.lastBigBuyAddress.substring(gameData.lastBigBuyAddress.length - 4)}`, 'success');
                } else {
                    this.addLogEntry('âš ï¸ æœªæ‰¾åˆ°æœ€åå¤§é¢ä¹°å…¥åœ°å€', 'warning');
                }
            }
            
            // è§¦å‘å¥–åŠ±å‘æ”¾
            triggerRewards() {
                const currentTime = Date.now();
                
                // æ£€æŸ¥æ˜¯å¦åˆ°äº†20åˆ†é’Ÿå¥–åŠ±æ—¶é—´
                if (currentTime - gameData.lastRewardTime >= gameData.top20RewardInterval * 1000) {
                    this.distributeTop20Reward();
                    gameData.lastRewardTime = currentTime;
                }
                
                // å‘æ”¾æœ€åå¤§é¢ä¹°å…¥å¥–åŠ±
                this.distributeLastBigBuyReward();
            }
            
            // åˆ†å‘å‰20åå¥–åŠ±
            distributeTop20Reward() {
                if (gameData.top20Holders.length > 0) {
                    const rewardPerHolder = gameData.top20Reward / gameData.top20Holders.length;
                    this.addLogEntry(`ğŸ† å‰20åå¥–åŠ±åˆ†å‘: æ¯äºº${rewardPerHolder.toFixed(3)}%ä»£å¸`, 'success');
                }
            }
            
            // åˆ†å‘æœ€åå¤§é¢ä¹°å…¥å¥–åŠ±
            distributeLastBigBuyReward() {
                if (gameData.lastBigBuyAddress) {
                    this.addLogEntry(`ğŸ’° æœ€åå¤§é¢ä¹°å…¥å¥–åŠ±: ${gameData.lastBigBuyReward}%ä»£å¸å‘æ”¾ç»™${gameData.lastBigBuyAddress.substring(0, 6)}...${gameData.lastBigBuyAddress.substring(gameData.lastBigBuyAddress.length - 4)}`, 'success');
                }
            }
            
            // æ›´æ–°å¥–åŠ±æ•°æ®
            updateRewardData() {
                rewardData.countdownEnded = true;
                rewardData.top20Holders = gameData.top20Holders;
                rewardData.lastSuccessAddress = gameData.lastBigBuyAddress;
                rewardData.lastSuccessAmount = gameData.lastBigBuyAmount;
                
                // ä¿å­˜åˆ°Firebase
                this.saveGameDataToFirebase();
            }
            
            // ä¿å­˜æŒä»“å¥–åŠ±è½®æ¬¡
            saveHolderRewardRound() {
                try {
                    const roundId = `holder_round_${Date.now()}`;
                    const holderRewardData = {
                        roundId: roundId,
                        timestamp: Date.now(),
                        type: 'holder_reward',
                        top20Holders: gameData.top20Holders,
                        tokenAddress: document.getElementById('tokenAddress').value.trim(),
                        isClaimed: false
                    };
                    
                    // ä¿å­˜åˆ°Firebase
                    database.ref('holderRewardRounds').child(roundId).set(holderRewardData)
                        .then(() => {
                            console.log('æŒä»“å¥–åŠ±è½®æ¬¡å·²ä¿å­˜åˆ°Firebaseï¼Œè½®æ¬¡ID:', roundId);
                            this.addLogEntry('ğŸ“Š æŒä»“å¥–åŠ±è½®æ¬¡å·²åŒæ­¥åˆ°äº‘ç«¯', 'success');
                            
                            // ä¿å­˜å½“å‰æŒä»“å¥–åŠ±è½®æ¬¡IDåˆ°æœ¬åœ°
                            this.currentHolderRewardRoundId = roundId;
                        })
                        .catch((error) => {
                            console.error('ä¿å­˜æŒä»“å¥–åŠ±è½®æ¬¡å¤±è´¥:', error);
                            this.addLogEntry('âŒ æŒä»“å¥–åŠ±è½®æ¬¡åŒæ­¥å¤±è´¥', 'error');
                        });
                } catch (error) {
                    console.error('FirebaseæŒä»“å¥–åŠ±è½®æ¬¡ä¿å­˜é”™è¯¯:', error);
                }
            }
            
            // æ›´æ–°æŒä»“å¥–åŠ±é¡µé¢æ•°æ®
            updateHolderRewardData() {
                // æ›´æ–°æŒä»“å¥–åŠ±ç›¸å…³çš„é¡µé¢æ•°æ®
                if (gameData.top20Holders.length > 0) {
                    // è¿™é‡Œå¯ä»¥æ›´æ–°æŒä»“å¥–åŠ±ç›¸å…³çš„UIå…ƒç´ 
                    console.log('æŒä»“å¥–åŠ±æ•°æ®å·²æ›´æ–°');
                }
            }
            
            // Firebaseæ•°æ®ç®¡ç†
            saveGameDataToFirebase() {
                try {
                    const roundId = `round_${Date.now()}`;
                    const gameDataToSave = {
                        roundId: roundId,
                        timestamp: Date.now(),
                        countdownEnded: gameData.countdownEnded,
                        top20Holders: gameData.top20Holders,
                        lastBigBuyAddress: gameData.lastBigBuyAddress,
                        lastBigBuyAmount: gameData.lastBigBuyAmount,
                        transactionCount: this.transactionCount,
                        totalTimeAdjustment: this.totalTimeAdjustment,
                        successAddresses: successAddresses,
                        tokenAddress: document.getElementById('tokenAddress').value.trim(),
                        isClaimed: false // æ ‡è®°æ˜¯å¦å·²é¢†å–å¥–åŠ±
                    };
                    
                    // ä¿å­˜åˆ°Firebase Realtime Database
                    database.ref('gameRounds').child(roundId).set(gameDataToSave)
                        .then(() => {
                            console.log('æ¸¸æˆæ•°æ®å·²ä¿å­˜åˆ°Firebaseï¼Œè½®æ¬¡ID:', roundId);
                            this.addLogEntry('ğŸ“Š æ¸¸æˆæ•°æ®å·²åŒæ­¥åˆ°äº‘ç«¯', 'success');
                            
                            // ä¿å­˜å½“å‰è½®æ¬¡IDåˆ°æœ¬åœ°
                            this.currentRoundId = roundId;
                        })
                        .catch((error) => {
                            console.error('ä¿å­˜åˆ°Firebaseå¤±è´¥:', error);
                            this.addLogEntry('âŒ äº‘ç«¯åŒæ­¥å¤±è´¥', 'error');
                        });
                } catch (error) {
                    console.error('Firebaseä¿å­˜é”™è¯¯:', error);
                }
            }
            
            // ä»FirebaseåŠ è½½æ¸¸æˆæ•°æ®
            loadGameDataFromFirebase() {
                try {
                    database.ref('gameRounds').orderByChild('timestamp').limitToLast(1).once('value')
                        .then((snapshot) => {
                            if (snapshot.exists()) {
                                const data = Object.values(snapshot.val())[0];
                                this.restoreGameData(data);
                                this.addLogEntry('ğŸ“Š å·²ä»äº‘ç«¯åŠ è½½æ¸¸æˆæ•°æ®', 'success');
                            }
                        })
                        .catch((error) => {
                            console.error('ä»FirebaseåŠ è½½å¤±è´¥:', error);
                            this.addLogEntry('âŒ äº‘ç«¯æ•°æ®åŠ è½½å¤±è´¥', 'error');
                        });
                        
                    // åŒæ—¶åŠ è½½æœ€æ–°çš„æŒä»“å¥–åŠ±è½®æ¬¡ID
                    this.loadLatestHolderRewardRoundId();
                } catch (error) {
                    console.error('FirebaseåŠ è½½é”™è¯¯:', error);
                }
            }
            
            // åŠ è½½æœ€æ–°çš„æŒä»“å¥–åŠ±è½®æ¬¡ID
            loadLatestHolderRewardRoundId() {
                try {
                    database.ref('holderRewardRounds').orderByChild('timestamp').limitToLast(1).once('value')
                        .then((snapshot) => {
                            if (snapshot.exists()) {
                                const data = Object.values(snapshot.val())[0];
                                this.currentHolderRewardRoundId = data.roundId;
                                console.log('å·²åŠ è½½æœ€æ–°æŒä»“å¥–åŠ±è½®æ¬¡ID:', this.currentHolderRewardRoundId);
                            }
                        })
                        .catch((error) => {
                            console.error('åŠ è½½æŒä»“å¥–åŠ±è½®æ¬¡IDå¤±è´¥:', error);
                        });
                } catch (error) {
                    console.error('åŠ è½½æŒä»“å¥–åŠ±è½®æ¬¡IDé”™è¯¯:', error);
                }
            }
            
            // è·å–æ‰€æœ‰è·å¥–è½®æ¬¡æ•°æ®
            getAllWinnerRounds() {
                return new Promise((resolve, reject) => {
                    try {
                        database.ref('gameRounds').orderByChild('timestamp').once('value')
                            .then((snapshot) => {
                                if (snapshot.exists()) {
                                    const rounds = [];
                                    snapshot.forEach((childSnapshot) => {
                                        const roundData = childSnapshot.val();
                                        if (roundData.countdownEnded) {
                                            rounds.push(roundData);
                                        }
                                    });
                                    resolve(rounds.reverse()); // æœ€æ–°çš„åœ¨å‰é¢
                                } else {
                                    resolve([]);
                                }
                            })
                            .catch((error) => {
                                console.error('è·å–è·å¥–è½®æ¬¡å¤±è´¥:', error);
                                reject(error);
                            });
                    } catch (error) {
                        console.error('è·å–è·å¥–è½®æ¬¡é”™è¯¯:', error);
                        reject(error);
                    }
                });
            }
            
            // è·å–æ‰€æœ‰æŒä»“å¥–åŠ±è½®æ¬¡æ•°æ®
            getAllHolderRewardRounds() {
                return new Promise((resolve, reject) => {
                    try {
                        database.ref('holderRewardRounds').orderByChild('timestamp').once('value')
                            .then((snapshot) => {
                                if (snapshot.exists()) {
                                    const rounds = [];
                                    snapshot.forEach((childSnapshot) => {
                                        const roundData = childSnapshot.val();
                                        rounds.push(roundData);
                                    });
                                    resolve(rounds.reverse()); // æœ€æ–°çš„åœ¨å‰é¢
                                } else {
                                    resolve([]);
                                }
                            })
                            .catch((error) => {
                                console.error('è·å–æŒä»“å¥–åŠ±è½®æ¬¡å¤±è´¥:', error);
                                reject(error);
                            });
                    } catch (error) {
                        console.error('è·å–æŒä»“å¥–åŠ±è½®æ¬¡é”™è¯¯:', error);
                        reject(error);
                    }
                });
            }
            
            // æ ‡è®°è½®æ¬¡ä¸ºå·²é¢†å–
            markRoundAsClaimed(roundId) {
                try {
                    database.ref('gameRounds').child(roundId).update({
                        isClaimed: true,
                        claimedAt: Date.now()
                    }).then(() => {
                        console.log('è½®æ¬¡å·²æ ‡è®°ä¸ºå·²é¢†å–:', roundId);
                    }).catch((error) => {
                        console.error('æ ‡è®°è½®æ¬¡å¤±è´¥:', error);
                    });
                } catch (error) {
                    console.error('æ ‡è®°è½®æ¬¡é”™è¯¯:', error);
                }
            }
            
            // æ¢å¤æ¸¸æˆæ•°æ®
            restoreGameData(data) {
                if (data) {
                    gameData.countdownEnded = data.countdownEnded || false;
                    gameData.top20Holders = data.top20Holders || [];
                    gameData.lastBigBuyAddress = data.lastBigBuyAddress || null;
                    gameData.lastBigBuyAmount = data.lastBigBuyAmount || 0;
                    
                    this.transactionCount = data.transactionCount || 0;
                    this.totalTimeAdjustment = data.totalTimeAdjustment || 0;
                    
                    // æ¢å¤è½®æ¬¡ID
                    if (data.roundId) {
                        this.currentRoundId = data.roundId;
                    }
                    
                    if (data.successAddresses) {
                        successAddresses = data.successAddresses;
                        updateSuccessAddressesDisplay();
                    }
                    
                    // æ›´æ–°æ˜¾ç¤º
                    document.getElementById('transactionCount').innerText = this.transactionCount;
                    document.getElementById('timeAdjustment').innerText = `+${this.totalTimeAdjustment} ç§’`;
                }
            }
            
            // ä¿å­˜äº¤æ˜“è®°å½•åˆ°Firebase
            saveTransactionToFirebase(transaction) {
                try {
                    const transactionData = {
                        timestamp: Date.now(),
                        signature: transaction.signature,
                        type: transaction.type,
                        amount: transaction.amount,
                        blockTime: transaction.blockTime,
                        src: transaction.src,
                        dst: transaction.dst,
                        tradeType: this.determineTradeType(transaction)
                    };
                    
                    database.ref('transactions').push(transactionData)
                        .then(() => {
                            console.log('äº¤æ˜“è®°å½•å·²ä¿å­˜åˆ°Firebase');
                        })
                        .catch((error) => {
                            console.error('ä¿å­˜äº¤æ˜“è®°å½•å¤±è´¥:', error);
                        });
                } catch (error) {
                    console.error('Firebaseäº¤æ˜“ä¿å­˜é”™è¯¯:', error);
                }
            }
            
            // ä¿å­˜æŒä»“æ•°æ®åˆ°Firebase
            saveHoldersDataToFirebase(holders) {
                try {
                    const holdersData = {
                        timestamp: Date.now(),
                        tokenAddress: document.getElementById('tokenAddress').value.trim(),
                        holders: holders
                    };
                    
                    database.ref('holdersData').push(holdersData)
                        .then(() => {
                            console.log('æŒä»“æ•°æ®å·²ä¿å­˜åˆ°Firebase');
                        })
                        .catch((error) => {
                            console.error('ä¿å­˜æŒä»“æ•°æ®å¤±è´¥:', error);
                        });
                } catch (error) {
                    console.error('FirebaseæŒä»“æ•°æ®ä¿å­˜é”™è¯¯:', error);
                }
            }
            
            // æ¸¸æˆæš‚åœ
            pauseGame() {
                // åœæ­¢ç›‘æ§
                this.stopMonitoring();
                
                // æ˜¾ç¤ºæ¸¸æˆæš‚åœç•Œé¢
                this.showGamePauseScreen();
                
                // 10ç§’åè‡ªåŠ¨å¼€å§‹ä¸‹ä¸€è½®
                setTimeout(() => {
                    this.startNextRound();
                }, 10000);
            }
            
            // æ˜¾ç¤ºæ¸¸æˆæš‚åœç•Œé¢
            showGamePauseScreen() {
                // åˆ›å»ºæ¸¸æˆæš‚åœé®ç½©
                let pauseOverlay = document.getElementById('gamePauseOverlay');
                if (!pauseOverlay) {
                    pauseOverlay = document.createElement('div');
                    pauseOverlay.id = 'gamePauseOverlay';
                    pauseOverlay.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[70]';
                    document.body.appendChild(pauseOverlay);
                }
                
                pauseOverlay.innerHTML = `
                    <div class="bg-gray-800 border-meme p-8 rounded-xl shadow-lg text-center max-w-md mx-4">
                        <div class="text-6xl mb-4">ğŸ‰</div>
                        <h2 class="text-memeYellow font-bold text-2xl mb-4">æ¸¸æˆç»“æŸï¼</h2>
                        <p class="text-white text-lg mb-6">æœ¬è½®æ¸¸æˆå·²ç»“æŸï¼Œè¯·ç©å®¶é¢†å–å¥–åŠ±</p>
                        
                        <div class="bg-gray-700 border-meme p-4 rounded-lg mb-6">
                            <div class="text-memePink font-bold mb-2">æœ¬è½®æ•°æ®ï¼š</div>
                            <div class="text-gray-300 text-sm space-y-1">
                                <div>â€¢ æ€»äº¤æ˜“æ¬¡æ•°ï¼š${this.transactionCount}</div>
                                <div>â€¢ å€’è®¡æ—¶è°ƒæ•´ï¼š+${this.totalTimeAdjustment} ç§’</div>
                                <div>â€¢ æœ€åå¤§é¢ä¹°å…¥ï¼š${gameData.lastBigBuyAddress ? gameData.lastBigBuyAddress.substring(0, 6) + '...' + gameData.lastBigBuyAddress.substring(gameData.lastBigBuyAddress.length - 4) : 'æ— '}</div>
                            </div>
                        </div>
                        
                        <div class="flex gap-4 mb-6">
                            <button onclick="window.solanaTracker.showRewardPage()" class="flex-1 bg-memeGreen hover:bg-green-600 text-white font-bold py-3 px-4 rounded border-meme transition-all duration-300">
                                ğŸ é¢†å–å¥–åŠ±
                            </button>
                            <button onclick="window.solanaTracker.moveToBottomLeft()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-4 rounded border-meme transition-all duration-300">
                                ğŸ“ ç§»è‡³å·¦ä¸‹è§’
                            </button>
                        </div>
                        
                        <div class="text-memeYellow font-bold text-lg">
                            <span id="nextRoundCountdown">10</span> ç§’åè‡ªåŠ¨å¼€å§‹ä¸‹ä¸€è½®
                        </div>
                    </div>
                `;
                
                pauseOverlay.classList.remove('hidden');
                
                // å¼€å§‹å€’è®¡æ—¶
                this.startNextRoundCountdown();
            }
            
            // éšè—æ¸¸æˆæš‚åœç•Œé¢
            hideGamePauseScreen() {
                const pauseOverlay = document.getElementById('gamePauseOverlay');
                if (pauseOverlay) {
                    pauseOverlay.classList.add('hidden');
                }
            }
            
            // ç§»åŠ¨åˆ°å·¦ä¸‹è§’
            moveToBottomLeft() {
                const pauseOverlay = document.getElementById('gamePauseOverlay');
                if (pauseOverlay) {
                    // ç§»é™¤å…¨å±é®ç½©æ ·å¼
                    pauseOverlay.className = 'fixed bottom-4 left-4 w-80 bg-gray-800 border-meme p-4 rounded-xl shadow-lg z-50';
                    
                    // æ›´æ–°å†…å®¹ä¸ºç´§å‡‘ç‰ˆæœ¬
                    pauseOverlay.innerHTML = `
                        <div class="text-center">
                            <div class="text-2xl mb-2">ğŸ‰</div>
                            <h3 class="text-memeYellow font-bold text-lg mb-2">æ¸¸æˆç»“æŸ</h3>
                            <p class="text-gray-300 text-sm mb-3">è¯·é¢†å–å¥–åŠ±</p>
                            
                            <div class="bg-gray-700 border-meme p-2 rounded mb-3">
                                <div class="text-memePink font-bold text-xs mb-1">æœ¬è½®æ•°æ®ï¼š</div>
                                <div class="text-gray-300 text-xs space-y-1">
                                    <div>äº¤æ˜“ï¼š${this.transactionCount}</div>
                                    <div>è°ƒæ•´ï¼š+${this.totalTimeAdjustment}s</div>
                                    <div>æœ€åï¼š${gameData.lastBigBuyAddress ? gameData.lastBigBuyAddress.substring(0, 4) + '...' + gameData.lastBigBuyAddress.substring(gameData.lastBigBuyAddress.length - 4) : 'æ— '}</div>
                                </div>
                            </div>
                            
                            <div class="flex gap-2 mb-3">
                                <button onclick="window.solanaTracker.showRewardPage()" class="flex-1 bg-memeGreen hover:bg-green-600 text-white font-bold py-2 px-3 rounded border-meme transition-all duration-300 text-xs">
                                    ğŸ é¢†å–
                                </button>
                            </div>
                            
                            <div class="text-memeYellow font-bold text-sm">
                                <span id="nextRoundCountdown">10</span>s åé‡å¯
                            </div>
                        </div>
                    `;
                    
                    // é‡æ–°å¼€å§‹å€’è®¡æ—¶
                    this.startNextRoundCountdown();
                }
            }
            
            // ä¸‹ä¸€è½®å€’è®¡æ—¶
            startNextRoundCountdown() {
                let countdown = 10;
                const countdownElement = document.getElementById('nextRoundCountdown');
                
                const timer = setInterval(() => {
                    countdown--;
                    if (countdownElement) {
                        countdownElement.textContent = countdown;
                    }
                    
                    if (countdown <= 0) {
                        clearInterval(timer);
                        // å€’è®¡æ—¶ç»“æŸåè‡ªåŠ¨å¼€å§‹ä¸‹ä¸€è½®
                        this.startNextRound();
                    }
                }, 1000);
            }
            
            // å¼€å§‹ä¸‹ä¸€è½®æ¸¸æˆ
            startNextRound() {
                // éšè—æš‚åœç•Œé¢
                this.hideGamePauseScreen();
                
                // é‡ç½®å€’è®¡æ—¶åˆ°åˆå§‹çŠ¶æ€ï¼ˆ5åˆ†é’Ÿï¼‰
                this.countdownDate = new Date();
                this.countdownDate.setMinutes(this.countdownDate.getMinutes() + 5);
                this.originalCountdownDate = new Date(this.countdownDate);
                this.totalTimeAdjustment = 0;
                this.transactionCount = 0;
                
                // æ¢å¤å€’è®¡æ—¶æ˜¾ç¤ºç»“æ„
                const countdownElement = document.getElementById("countdown");
                countdownElement.innerHTML = `
                    <!-- åˆ† -->
                    <div class="bg-memePurple border-meme p-4 text-center transform hover:scale-105 transition-all duration-300 glow">
                        <div id="minutes" class="text-[clamp(2rem,6vw,4rem)] font-bold text-white">05</div>
                        <div class="text-white font-bold">MINUTES</div>
                    </div>
                    
                    <!-- ç§’ -->
                    <div class="bg-memeGreen border-meme p-4 text-center transform hover:scale-105 transition-all duration-300 glow">
                        <div id="seconds" class="text-[clamp(2rem,6vw,4rem)] font-bold text-black">00</div>
                        <div class="text-black font-bold">SECONDS</div>
                    </div>
                `;
                
                // æ›´æ–°æ˜¾ç¤º
                document.getElementById('transactionCount').innerText = '0';
                document.getElementById('timeAdjustment').innerText = '+0 ç§’';
                
                // æ¸…ç©ºè¯¦ç»†äº¤æ˜“è¡¨æ ¼
                this.updateTransactionsDisplay();
                
                // æ›´æ–°è®¡æ•°å™¨
                const detailedCount = document.getElementById('detailedCount');
                if (detailedCount) {
                    detailedCount.textContent = '0 æ¡è®°å½•';
                }
                
                // é‡ç½®æ¸¸æˆçŠ¶æ€ï¼ˆä¿ç•™æ•°æ®ï¼‰
                this.resetGameState();
                
                // é‡æ–°å¯åŠ¨å€’è®¡æ—¶æ›´æ–°
                this.startCountdownUpdate();
                
                // æ·»åŠ æ—¥å¿—
                this.addLogEntry('ğŸ”„ æ–°ä¸€è½®æ¸¸æˆå¼€å§‹ï¼å€’è®¡æ—¶å·²é‡ç½®ä¸º5åˆ†é’Ÿ', 'success');
                
                // ä¸è‡ªåŠ¨å¼€å§‹ç›‘æ§ï¼Œç­‰å¾…ç®¡ç†é¢æ¿æŒ‡ä»¤
            }
            

            
            // é‡ç½®æ¸¸æˆçŠ¶æ€ï¼ˆä¿ç•™æ•°æ®ï¼‰
            resetGameState() {
                // åªé‡ç½®æ¸¸æˆçŠ¶æ€ï¼Œä¿ç•™æ•°æ®
                gameData.countdownEnded = false;
                gameData.lastRewardTime = 0;
                
                rewardData.countdownEnded = false;
                
                // ä¿ç•™ä»¥ä¸‹æ•°æ®ï¼š
                // - gameData.top20Holders (æŒä»“å‰20æ•°æ®)
                // - gameData.lastBigBuyAddress (æœ€åå¤§é¢ä¹°å…¥åœ°å€)
                // - gameData.lastBigBuyAmount (æœ€åå¤§é¢ä¹°å…¥æ•°é‡)
                // - rewardData.top20Holders (å¥–åŠ±é¡µé¢æ•°æ®)
                // - rewardData.lastSuccessAddress (å¥–åŠ±é¡µé¢æœ€ååœ°å€)
                // - rewardData.lastSuccessAmount (å¥–åŠ±é¡µé¢æœ€åæ•°é‡)
                // - successAddresses (æˆåŠŸåœ°å€åˆ—è¡¨)
            }
            
            // æ˜¾ç¤ºå¥–åŠ±é¡µé¢
            showRewardPage() {
                const rewardPage = document.getElementById('rewardPage');
                if (rewardPage) {
                    rewardPage.classList.remove('hidden');
                    updateRewardPageData();
                }
            }
        }
        
        // åˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', async () => {
            // ä»FirebaseåŠ è½½ä»£å¸åœ°å€
            await loadTokenAddressFromFirebase();
            
            // å¯åŠ¨ç›‘å¬å™¨ç›‘å¬åœ°å€å˜åŒ–
            listenToTokenAddressChanges();
            
            // å¯åŠ¨ç›‘å¬å™¨ç›‘å¬ç®¡ç†é¢æ¿æ§åˆ¶æŒ‡ä»¤
            listenToAdminControl();
            
            // åˆå§‹åŒ–Solanaäº¤æ˜“è¿½è¸ªå™¨
            window.solanaTracker = new SolanaTransactionTracker();
            
            // åˆå§‹åŒ–é’±åŒ…ç®¡ç†å™¨
            window.walletManager = new WalletManager();
            window.walletManager.init();
            
            // ä¸è‡ªåŠ¨å¯åŠ¨æŒä»“è€…åˆ·æ–°ï¼Œç­‰å¾…ç®¡ç†é¢æ¿æŒ‡ä»¤
        });
        
        // æ·»åŠ ä¸€äº›äº’åŠ¨æ•ˆæœ
        document.querySelectorAll('button, a').forEach(el => {
            el.addEventListener('click', function(e) {
                // é˜²æ­¢é“¾æ¥é»˜è®¤è¡Œä¸º
                if (el.tagName === 'A') e.preventDefault();
                
                // æ·»åŠ ç‚¹å‡»åŠ¨ç”»
                this.classList.add('scale-90');
                setTimeout(() => {
                    this.classList.remove('scale-90');
                }, 150);
            });
        });

        // é“¾ä¸Šå®æ—¶è·å–æŒä»“å‰20æŒæœ‰è€…
        async function fetchTopHolders(tokenMint) {
            const holdersList = document.getElementById('topHoldersList');
            holdersList.innerHTML = '<li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>';
            try {
                console.log('å¼€å§‹æŸ¥è¯¢æŒä»“æ¦œï¼Œä»£å¸åœ°å€:', tokenMint);
                if (!window.solanaTracker) {
                    throw new Error('ç›‘æ§å™¨æœªåˆå§‹åŒ–');
                }
                // LPæ± å­åœ°å€åˆ—è¡¨
                const lpAddresses = [
                    'WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh',
                    // æœªæ¥å¯æ‰©å±•æ›´å¤šæ± å­
                ];
                // 1. æŸ¥æ‰¾æ‰€æœ‰Token Account
                const data = await window.solanaTracker.makeRpcCall('getProgramAccounts', [
                    'TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA',
                    {
                        encoding: 'jsonParsed',
                        filters: [
                            { dataSize: 165 },
                            { memcmp: { offset: 0, bytes: tokenMint } }
                        ]
                    }
                ]);
                console.log('RPCå“åº”æ•°æ®:', data);
                if (!data || !Array.isArray(data) || data.length === 0) {
                    holdersList.innerHTML = '<li class="text-yellow-400 text-xs">é“¾ä¸Šæš‚æ— æŒä»“æ•°æ®</li>';
                    return;
                }
                // 2. ç»Ÿè®¡æ‰€æœ‰ownerå’Œä½™é¢ï¼Œæ’é™¤LPæ± å­
                const holders = {};
                data.forEach(acc => {
                    const owner = acc.account.data.parsed.info.owner;
                    const amount = parseInt(acc.account.data.parsed.info.tokenAmount.amount);
                    if (lpAddresses.includes(owner)) return; // è·³è¿‡æ± å­
                    if (!holders[owner]) holders[owner] = 0;
                    holders[owner] += amount;
                });
                console.log('ç»Ÿè®¡åˆ°çš„æŒæœ‰äºº:', holders);
                // 3. æ’åºå–å‰20
                const sorted = Object.entries(holders)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 20);
                console.log('æ’åºåçš„å‰20:', sorted);
                holdersList.innerHTML = '';
                sorted.forEach(([owner, amount], idx) => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <span class="text-memePink font-bold text-xs">#${idx + 1}</span>
                        <a href="https://solscan.io/account/${owner}" target="_blank" class="text-blue-400 hover:underline mx-1">
                            ${owner.substring(0, 6)}...${owner.substring(owner.length - 4)}
                        </a>
                        <span class="text-gray-400 text-xs">(${amount})</span>
                    `;
                    holdersList.appendChild(li);
                });
            } catch (e) {
                console.error('é“¾ä¸ŠæŸ¥è¯¢å¤±è´¥ï¼Œè¯¦ç»†é”™è¯¯:', e);
                holdersList.innerHTML = `<li class="text-red-400 text-xs">é“¾ä¸ŠæŸ¥è¯¢å¤±è´¥: ${e.message}</li>`;
            }
        }

        // æˆåŠŸå¢åŠ å€’è®¡æ—¶çš„åœ°å€åˆ—è¡¨
        let successAddresses = [];
        const maxSuccessAddresses = 5; // æœ€å¤šæ˜¾ç¤º5ä¸ªåœ°å€

        // æ·»åŠ æˆåŠŸå¢åŠ å€’è®¡æ—¶çš„åœ°å€
        function addSuccessAddress(address, amount, timestamp) {
            const addressInfo = {
                address: address,
                amount: amount,
                timestamp: timestamp,
                time: new Date().toLocaleTimeString()
            };
            
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨è¯¥åœ°å€
            const existingIndex = successAddresses.findIndex(item => item.address === address);
            if (existingIndex !== -1) {
                // å¦‚æœå·²å­˜åœ¨ï¼Œæ›´æ–°ä¿¡æ¯
                successAddresses[existingIndex] = addressInfo;
            } else {
                // å¦‚æœä¸å­˜åœ¨ï¼Œæ·»åŠ åˆ°å¼€å¤´
                successAddresses.unshift(addressInfo);
                // ä¿æŒæœ€å¤š20ä¸ª
                if (successAddresses.length > maxSuccessAddresses) {
                    successAddresses = successAddresses.slice(0, maxSuccessAddresses);
                }
            }
            
            updateSuccessAddressesDisplay();
        }

        // æ›´æ–°æˆåŠŸåœ°å€æ˜¾ç¤º
        function updateSuccessAddressesDisplay() {
            const addressesList = document.getElementById('successAddressesList');
            if (successAddresses.length === 0) {
                addressesList.innerHTML = '<li class="text-gray-400 text-sm italic">ç­‰å¾…å¤§é¢ä¹°å…¥...</li>';
                return;
            }
            
            addressesList.innerHTML = '';
            successAddresses.forEach((item, idx) => {
                const li = document.createElement('li');
                li.className = 'text-sm border-b border-gray-700 pb-2';
                li.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <span class="text-memePink font-bold">#${idx + 1}</span>
                            <a href="https://solscan.io/account/${item.address}" target="_blank" class="text-blue-400 hover:underline mx-2">
                                ${item.address.substring(0, 6)}...${item.address.substring(item.address.length - 4)}
                            </a>
                        </div>
                        <div class="text-right text-xs text-gray-400">
                            <div>${item.amount}</div>
                            <div>${item.time}</div>
                        </div>
                    </div>
                `;
                addressesList.appendChild(li);
            });
        }

        // è‡ªåŠ¨åˆ·æ–°æŒä»“å‰20æŒæœ‰è€…
        let topHoldersInterval = null;
        let topHoldersCountdown = 10;
        let topHoldersCurrentMint = '';

        // åˆ·æ–°å€’è®¡æ—¶æ˜¾ç¤º
        function updateTopHoldersCountdown() {
            const timer = document.getElementById('holdersRefreshCountdown');
            if (timer) {
                timer.textContent = topHoldersCountdown;
            }
        }

        async function startTopHoldersAutoRefresh(tokenMint) {
            console.log('å¯åŠ¨æŒä»“è€…è‡ªåŠ¨åˆ·æ–°ï¼Œä»£å¸åœ°å€:', tokenMint);
            topHoldersCurrentMint = tokenMint;
            topHoldersCountdown = 10;
            updateTopHoldersCountdown();
            if (topHoldersInterval) clearInterval(topHoldersInterval);
            // ç«‹å³æ‹‰å–ä¸€æ¬¡
            fetchTopHolders(tokenMint);
            topHoldersInterval = setInterval(() => {
                topHoldersCountdown--;
                updateTopHoldersCountdown();
                if (topHoldersCountdown <= 0) {
                    fetchTopHolders(topHoldersCurrentMint);
                    topHoldersCountdown = 10;
                }
            }, 1000);
        }

        function stopTopHoldersAutoRefresh() {
            console.log('åœæ­¢æŒä»“è€…è‡ªåŠ¨åˆ·æ–°');
            if (topHoldersInterval) clearInterval(topHoldersInterval);
            topHoldersInterval = null;
        }

        // ç›‘æ§åŠŸèƒ½å·²ç§»è‡³ç®¡ç†é¢æ¿
        // æ¸¸æˆé€»è¾‘ç›¸å…³å˜é‡
        let gameData = {
            devHoldings: 3, // DEVæŒæœ‰3%ç­¹ç 
            triggerThreshold: 100000, // è§¦å‘é˜ˆå€¼100000æ•°é‡
            countdownIncrement: 60, // æ¯æ¬¡å¢åŠ 60ç§’
            maxCountdown: 600, // æœ€å¤§10åˆ†é’Ÿ
            lastBigBuyReward: 0.2, // æœ€åå¤§é¢ä¹°å…¥å¥–åŠ±0.2%
            top20Reward: 0.5, // å‰20åå¹³åˆ†å¥–åŠ±0.5%
            top20RewardInterval: 1200, // 20åˆ†é’Ÿ = 1200ç§’
            
            // è‡ªåŠ¨æ•æ‰æ•°æ®
            top20Holders: [],
            lastBigBuyAddress: null,
            lastBigBuyAmount: 0,
            countdownEnded: false,
            lastRewardTime: 0,
            
            // æŒä»“å¥–åŠ±ç‹¬ç«‹å€’è®¡æ—¶
            holderRewardCountdown: 180, // æŒä»“å¥–åŠ±å€’è®¡æ—¶ï¼š3åˆ†é’Ÿï¼ˆæµ‹è¯•ç”¨ï¼‰
            holderRewardEnded: false, // æŒä»“å¥–åŠ±å€’è®¡æ—¶æ˜¯å¦ç»“æŸ
            holderRewardRounds: [] // æŒä»“å¥–åŠ±è½®æ¬¡å†å²
        };
        
        // å¥–åŠ±é¡µé¢ç›¸å…³å˜é‡
        let rewardData = {
            top20Holders: [],
            lastSuccessAddress: null,
            lastSuccessAmount: 0,
            countdownEnded: false
        };
        
        // ä»FirebaseåŠ è½½å½“å‰ä»£å¸åœ°å€
        async function loadTokenAddressFromFirebase() {
            try {
                const snapshot = await database.ref('currentTokenAddress').once('value');
                if (snapshot.exists()) {
                    const address = snapshot.val();
                    // æ›´æ–°ä»£å¸åœ°å€è¾“å…¥æ¡†
                    const tokenAddressInput = document.getElementById('tokenAddress');
                    if (tokenAddressInput) {
                        tokenAddressInput.value = address;
                        // å¦‚æœæ¸¸æˆå·²ç»åˆå§‹åŒ–ï¼Œåªæ›´æ–°ä»£å¸åœ°å€ï¼Œä¸è‡ªåŠ¨å¯åŠ¨ç›‘æ§
                        if (window.solanaTracker) {
                            window.solanaTracker.tokenAddress = address;
                        }
                        // ä¸è‡ªåŠ¨å¯åŠ¨æŒä»“è€…åˆ·æ–°ï¼Œç­‰å¾…ç®¡ç†é¢æ¿æŒ‡ä»¤
                    }
                    console.log('ä»FirebaseåŠ è½½ä»£å¸åœ°å€:', address);
                }
            } catch (error) {
                console.error('åŠ è½½ä»£å¸åœ°å€å¤±è´¥:', error);
            }
        }
        
        // ç›‘å¬Firebaseä¸­ä»£å¸åœ°å€çš„å˜åŒ–
        function listenToTokenAddressChanges() {
            database.ref('currentTokenAddress').on('value', (snapshot) => {
                if (snapshot.exists()) {
                    const address = snapshot.val();
                    // æ›´æ–°ä»£å¸åœ°å€è¾“å…¥æ¡†
                    const tokenAddressInput = document.getElementById('tokenAddress');
                    if (tokenAddressInput) {
                        tokenAddressInput.value = address;
                        // å¦‚æœæ¸¸æˆå·²ç»åˆå§‹åŒ–ï¼Œåªæ›´æ–°ä»£å¸åœ°å€ï¼Œä¸è‡ªåŠ¨å¯åŠ¨ç›‘æ§
                        if (window.solanaTracker) {
                            window.solanaTracker.tokenAddress = address;
                        }
                        // ä¸è‡ªåŠ¨å¯åŠ¨æŒä»“è€…åˆ·æ–°ï¼Œç­‰å¾…ç®¡ç†é¢æ¿æŒ‡ä»¤
                    }
                    console.log('Firebaseä»£å¸åœ°å€å·²æ›´æ–°:', address);
                }
            });
        }
        
        // ç›‘å¬ç®¡ç†é¢æ¿çš„æ§åˆ¶æŒ‡ä»¤
        function listenToAdminControl() {
            // ç›‘å¬ç›‘æ§æ§åˆ¶
            database.ref('gameControl/monitoring').on('value', (snapshot) => {
                if (snapshot.exists()) {
                    const shouldMonitor = snapshot.val();
                    if (window.solanaTracker) {
                        if (shouldMonitor) {
                            window.solanaTracker.startMonitoring();
                            // è·å–å½“å‰ä»£å¸åœ°å€å¹¶å¯åŠ¨æŒä»“è€…åˆ·æ–°
                            const currentAddress = document.getElementById('tokenAddress').value.trim();
                            if (currentAddress) {
                                startTopHoldersAutoRefresh(currentAddress);
                            }
                            console.log('ç®¡ç†é¢æ¿æŒ‡ä»¤ï¼šå¼€å§‹ç›‘æ§');
                        } else {
                            window.solanaTracker.stopMonitoring();
                            // åœæ­¢æŒä»“è€…åˆ·æ–°
                            stopTopHoldersAutoRefresh();
                            console.log('ç®¡ç†é¢æ¿æŒ‡ä»¤ï¼šåœæ­¢ç›‘æ§');
                        }
                    }
                }
            });
            
            // ç›‘å¬æ¸¸æˆæš‚åœæ§åˆ¶
            database.ref('gameControl/paused').on('value', (snapshot) => {
                if (snapshot.exists()) {
                    const isPaused = snapshot.val();
                    if (window.solanaTracker) {
                        if (isPaused) {
                            window.solanaTracker.pauseGame();
                            console.log('ç®¡ç†é¢æ¿æŒ‡ä»¤ï¼šæš‚åœæ¸¸æˆ');
                        } else {
                            window.solanaTracker.resumeGame();
                            console.log('ç®¡ç†é¢æ¿æŒ‡ä»¤ï¼šæ¢å¤æ¸¸æˆ');
                        }
                    }
                }
            });
            
            // ç›‘å¬å€’è®¡æ—¶é‡ç½®
            database.ref('gameControl/resetCountdown').on('value', (snapshot) => {
                if (snapshot.exists()) {
                    const timestamp = snapshot.val();
                    if (window.solanaTracker) {
                        // é‡ç½®å€’è®¡æ—¶åˆ°5åˆ†é’Ÿ
                        window.solanaTracker.countdownDate = new Date();
                        window.solanaTracker.countdownDate.setMinutes(window.solanaTracker.countdownDate.getMinutes() + 5);
                        window.solanaTracker.originalCountdownDate = new Date(window.solanaTracker.countdownDate);
                        window.solanaTracker.totalTimeAdjustment = 0;
                        window.solanaTracker.transactionCount = 0;
                        window.solanaTracker.updateCountdown();
                        console.log('ç®¡ç†é¢æ¿æŒ‡ä»¤ï¼šé‡ç½®å€’è®¡æ—¶');
                    }
                }
            });
            
            // ç›‘å¬å¼ºåˆ¶å¿«ç…§
            database.ref('gameControl/forceSnapshot').on('value', (snapshot) => {
                if (snapshot.exists()) {
                    const timestamp = snapshot.val();
                    if (window.solanaTracker) {
                        // å¼ºåˆ¶æ‰§è¡ŒæŒä»“å¿«ç…§
                        window.solanaTracker.onHolderRewardEnded();
                        console.log('ç®¡ç†é¢æ¿æŒ‡ä»¤ï¼šå¼ºåˆ¶å¿«ç…§');
                    }
                }
            });
            
            // ç›‘å¬æ¨¡æ‹Ÿäº¤æ˜“
            database.ref('gameControl/simulateTransaction').on('value', (snapshot) => {
                if (snapshot.exists()) {
                    const mockTx = snapshot.val();
                    if (window.solanaTracker) {
                        // å¤„ç†æ¨¡æ‹Ÿäº¤æ˜“
                        window.solanaTracker.processTransaction(mockTx);
                        console.log('ç®¡ç†é¢æ¿æŒ‡ä»¤ï¼šæ¨¡æ‹Ÿäº¤æ˜“', mockTx);
                    }
                }
            });
            
            // ç›‘å¬å€’è®¡æ—¶å½’é›¶
            database.ref('gameControl/endCountdown').on('value', (snapshot) => {
                if (snapshot.exists()) {
                    const timestamp = snapshot.val();
                    if (window.solanaTracker) {
                        // ç«‹å³å°†å€’è®¡æ—¶è®¾ç½®ä¸º0ï¼ˆç”¨äºæµ‹è¯•ï¼‰
                        window.solanaTracker.countdownDate = new Date();
                        gameData.countdownEnded = false;
                        window.solanaTracker.updateCountdown();
                        console.log('ç®¡ç†é¢æ¿æŒ‡ä»¤ï¼šå€’è®¡æ—¶å½’é›¶');
                    }
                }
            });
        }

        // æ˜¾ç¤ºå¥–åŠ±é¡µé¢
        async function showRewardPage() {
            const rewardPage = document.getElementById('rewardPage');
            if (rewardPage) {
                rewardPage.classList.remove('hidden');
                
                // æµ‹è¯•Firebase Functionsè¿æ¥
                await testFirebaseFunctions();
                
                await updateRewardPageData(); // æ›´æ–°å¥–åŠ±æ•°æ®
                loadHolderRewardRoundsList(); // åŠ è½½æŒä»“å¥–åŠ±å†å²
                loadCountdownRewardRoundsList(); // åŠ è½½å€’è®¡æ—¶å¥–åŠ±å†å²
                
                // æ›´æ–°ç§¯åˆ†æ˜¾ç¤º
                await updateScoreDisplay();
            }
        }
        
        // æµ‹è¯•Firebase Functionsè¿æ¥
        async function testFirebaseFunctions() {
            try {
                console.log('Firebase Functionså¯¹è±¡:', functions);
                
                // å°è¯•è·å–å‡½æ•°åˆ—è¡¨ï¼ˆå¦‚æœå¯ç”¨ï¼‰
                if (functions && typeof functions.httpsCallable === 'function') {
                    console.log('âœ… Firebase Functionså¯ç”¨');
                    
                    // æµ‹è¯•ä¸€ä¸ªç®€å•çš„å‡½æ•°è°ƒç”¨
                    try {
                        const testFunction = firebase.functions().httpsCallable('getRoundDetails');
                        const testResult = await testFunction({
                            roundId: 'test',
                            rewardType: 'top20'
                        });
                        console.log('âœ… æµ‹è¯•å‡½æ•°è°ƒç”¨æˆåŠŸ');
                    } catch (testError) {
                        console.log('âš ï¸ æµ‹è¯•å‡½æ•°è°ƒç”¨å¤±è´¥ï¼ˆé¢„æœŸè¡Œä¸ºï¼‰:', testError.message);
                    }
                } else {
                    console.error('âŒ Firebase Functionsä¸å¯ç”¨');
                }
            } catch (error) {
                console.error('Firebase Functionsæµ‹è¯•å¤±è´¥:', error);
            }
        }

        // éšè—å¥–åŠ±é¡µé¢
        function hideRewardPage() {
            const rewardPage = document.getElementById('rewardPage');
            if (rewardPage) {
                rewardPage.classList.add('hidden');
            }
        }

        // æ›´æ–°å¥–åŠ±é¡µé¢æ•°æ®
        async function updateRewardPageData() {
            // æ·»åŠ è°ƒè¯•ä¿¡æ¯
            console.log('=== å¥–åŠ±é¡µé¢æ•°æ®æ›´æ–°è°ƒè¯• ===');
            console.log('window.solanaTracker:', !!window.solanaTracker);
            if (window.solanaTracker) {
                console.log('currentHolderRewardRoundId:', window.solanaTracker.currentHolderRewardRoundId);
                console.log('currentRoundId:', window.solanaTracker.currentRoundId);
            }
            
            // æ£€æŸ¥é’±åŒ…è¿æ¥çŠ¶æ€
            if (!window.walletManager || !window.walletManager.isConnected) {
                document.getElementById('top20Status').innerHTML = '<span class="text-red-400">âŒ è¯·å…ˆè¿æ¥é’±åŒ…</span>';
                document.getElementById('lastSuccessStatus').innerHTML = '<span class="text-red-400">âŒ è¯·å…ˆè¿æ¥é’±åŒ…</span>';
                document.getElementById('claimTop20Btn').disabled = true;
                document.getElementById('claimLastSuccessBtn').disabled = true;
                return;
            }
            
            // è·å–é’±åŒ…åœ°å€
            const walletAddress = window.walletManager.currentWallet?.address || 
                                window.walletManager.currentWallet?.publicKey || 
                                String(window.walletManager.currentWallet || '');
            
            if (!walletAddress || walletAddress === 'undefined') {
                document.getElementById('top20Status').innerHTML = '<span class="text-red-400">âŒ é’±åŒ…åœ°å€æ— æ•ˆ</span>';
                document.getElementById('lastSuccessStatus').innerHTML = '<span class="text-red-400">âŒ é’±åŒ…åœ°å€æ— æ•ˆ</span>';
                document.getElementById('claimTop20Btn').disabled = true;
                document.getElementById('claimLastSuccessBtn').disabled = true;
                return;
            }
            
            try {
                // éªŒè¯å‰20æŒæœ‰è€…èµ„æ ¼
                let top20Eligibility = await validateTop20Eligibility(walletAddress);
                let top20Claimed = await checkTop20Claimed(walletAddress);
                
                // å¦‚æœè½®æ¬¡IDä¸ºç©ºï¼Œå°è¯•ä½¿ç”¨æœ€æ–°çš„è½®æ¬¡ID
                if (!window.solanaTracker?.currentHolderRewardRoundId) {
                    console.log('å‰ç«¯è½®æ¬¡IDä¸ºç©ºï¼Œå°è¯•è·å–æœ€æ–°è½®æ¬¡...');
                    try {
                        const holderRoundsRef = firebase.database().ref('holderRewardRounds');
                        const holderRoundsSnap = await holderRoundsRef.once('value');
                        const holderRounds = holderRoundsSnap.val();
                        
                        if (holderRounds) {
                            const latestRoundId = Object.keys(holderRounds).sort().pop();
                            console.log('æ‰¾åˆ°æœ€æ–°è½®æ¬¡ID:', latestRoundId);
                            
                            if (latestRoundId) {
                                // ä¸´æ—¶è®¾ç½®è½®æ¬¡ID
                                if (!window.solanaTracker) window.solanaTracker = {};
                                window.solanaTracker.currentHolderRewardRoundId = latestRoundId;
                                
                                // é‡æ–°éªŒè¯
                                const retryEligibility = await validateTop20Eligibility(walletAddress);
                                const retryClaimed = await checkTop20Claimed(walletAddress);
                                
                                if (retryEligibility.eligible) {
                                    console.log('ä½¿ç”¨æœ€æ–°è½®æ¬¡éªŒè¯æˆåŠŸ');
                                    top20Eligibility = retryEligibility;
                                    top20Claimed = retryClaimed;
                                }
                            }
                        }
                    } catch (error) {
                        console.error('è·å–æœ€æ–°è½®æ¬¡å¤±è´¥:', error);
                    }
                }
                
                if (top20Claimed) {
                    document.getElementById('top20Status').innerHTML = '<span class="text-green-400">âœ… å·²é¢†å–å‰20æŒæœ‰è€…å¥–åŠ±</span>';
                    document.getElementById('claimTop20Btn').disabled = true;
                    document.getElementById('claimTop20Btn').innerHTML = '<span class="text-white">âœ… å·²é¢†å–</span>';
                } else if (top20Eligibility.eligible) {
                    document.getElementById('top20Status').innerHTML = '<span class="text-green-400">ğŸ‰ æ‚¨æœ‰èµ„æ ¼é¢†å–å‰20æŒæœ‰è€…å¥–åŠ±ï¼</span>';
                    document.getElementById('claimTop20Btn').disabled = false;
                    document.getElementById('claimTop20Btn').innerHTML = '<span class="text-white">ğŸ† é¢†å–å‰20åå¥–åŠ±</span>';
                } else {
                    document.getElementById('top20Status').innerHTML = `<span class="text-red-400">âŒ ${top20Eligibility.reason}</span>`;
                    document.getElementById('claimTop20Btn').disabled = true;
                    document.getElementById('claimTop20Btn').innerHTML = '<span class="text-white">âŒ æ— èµ„æ ¼</span>';
                }
                
                // éªŒè¯æœ€åå¤§é¢ä¹°å…¥è€…èµ„æ ¼
                const lastBuyerEligibility = await validateLastBuyerEligibility(walletAddress);
                const lastBuyerClaimed = await checkLastBuyerClaimed(walletAddress);
                
                if (lastBuyerClaimed) {
                    document.getElementById('lastSuccessStatus').innerHTML = '<span class="text-green-400">âœ… å·²é¢†å–æœ€åå€’è®¡æ—¶å¥–åŠ±</span>';
                    document.getElementById('claimLastSuccessBtn').disabled = true;
                    document.getElementById('claimLastSuccessBtn').innerHTML = '<span class="text-white">âœ… å·²é¢†å–</span>';
                } else if (lastBuyerEligibility.eligible) {
                    document.getElementById('lastSuccessStatus').innerHTML = '<span class="text-green-400">ğŸ‰ æ‚¨æœ‰èµ„æ ¼é¢†å–æœ€åå€’è®¡æ—¶å¥–åŠ±ï¼</span>';
                    document.getElementById('claimLastSuccessBtn').disabled = false;
                    document.getElementById('claimLastSuccessBtn').innerHTML = '<span class="text-white">ğŸ’° é¢†å–æœ€åå€’è®¡æ—¶å¥–åŠ±</span>';
                } else {
                    document.getElementById('lastSuccessStatus').innerHTML = `<span class="text-red-400">âŒ ${lastBuyerEligibility.reason}</span>`;
                    document.getElementById('claimLastSuccessBtn').disabled = true;
                    document.getElementById('claimLastSuccessBtn').innerHTML = '<span class="text-white">âŒ æ— èµ„æ ¼</span>';
                }
                
            } catch (error) {
                console.error('æ›´æ–°å¥–åŠ±é¡µé¢æ•°æ®å¤±è´¥:', error);
                document.getElementById('top20Status').innerHTML = '<span class="text-red-400">âŒ éªŒè¯å¤±è´¥ï¼Œè¯·é‡è¯•</span>';
                document.getElementById('lastSuccessStatus').innerHTML = '<span class="text-red-400">âŒ éªŒè¯å¤±è´¥ï¼Œè¯·é‡è¯•</span>';
                document.getElementById('claimTop20Btn').disabled = true;
                document.getElementById('claimLastSuccessBtn').disabled = true;
            }
            
            // è®¾ç½®å¥–åŠ±æ•°é‡æ˜¾ç¤º
            document.getElementById('top20Reward').textContent = '3000 ç§¯åˆ†';
            document.getElementById('lastSuccessReward').textContent = '10000 ç§¯åˆ†';
        }

        // éªŒè¯åœ°å€åŠŸèƒ½ï¼ˆåŸºäºæ•°æ®åº“æ•°æ®ï¼‰
        async function verifyAddress(address) {
            if (!address || address.trim() === '') {
                return { valid: false, message: 'è¯·è¾“å…¥æœ‰æ•ˆçš„é’±åŒ…åœ°å€' };
            }
            
            // ç®€å•çš„Solanaåœ°å€æ ¼å¼éªŒè¯
            const solanaAddressRegex = /^[1-9A-HJ-NP-Za-km-z]{32,44}$/;
            if (!solanaAddressRegex.test(address.trim())) {
                return { valid: false, message: 'åœ°å€æ ¼å¼ä¸æ­£ç¡®' };
            }
            
            console.log('éªŒè¯åœ°å€:', address.trim());
            
            try {
                const trimmedAddress = address.trim();
                
                // 1. æ£€æŸ¥æ˜¯å¦åœ¨æŒä»“å‰20æŒæœ‰è€…ä¸­
                if (window.solanaTracker && window.solanaTracker.currentHolderRewardRoundId) {
                    const roundId = window.solanaTracker.currentHolderRewardRoundId;
                    const roundRef = firebase.database().ref(`holderRewardRounds/${roundId}`);
                    const roundSnap = await roundRef.once('value');
                    const roundData = roundSnap.val();
                    
                    if (roundData && roundData.top20Holders) {
                        const isTop20 = roundData.top20Holders.some(holder => 
                            holder.address === trimmedAddress
                        );
                        
                        if (isTop20) {
                            // æ£€æŸ¥æ˜¯å¦å·²ç»é¢†å–è¿‡
                            const claimedRef = firebase.database().ref(`claimedRewards/top20/${roundId}/${trimmedAddress}`);
                            const claimedSnap = await claimedRef.once('value');
                            const hasClaimed = claimedSnap.exists();
                            
                            if (hasClaimed) {
                                return { 
                                    valid: true, 
                                    message: 'âœ… è¯¥åœ°å€åœ¨æŒä»“å‰20æŒæœ‰è€…ä¸­ï¼Œä½†å·²é¢†å–è¿‡å¥–åŠ±', 
                                    type: 'top20',
                                    claimed: true
                                };
                            } else {
                                return { 
                                    valid: true, 
                                    message: 'âœ… è¯¥åœ°å€åœ¨æŒä»“å‰20æŒæœ‰è€…ä¸­ï¼Œå¯é¢†å–å¥–åŠ±ï¼', 
                                    type: 'top20',
                                    claimed: false
                                };
                            }
                        }
                    }
                }
                
                // 2. æ£€æŸ¥æ˜¯å¦æ˜¯æœ€åå¤§é¢ä¹°å…¥åœ°å€
                if (window.solanaTracker && window.solanaTracker.currentRoundId) {
                    const roundId = window.solanaTracker.currentRoundId;
                    const roundRef = firebase.database().ref(`gameRounds/${roundId}`);
                    const roundSnap = await roundRef.once('value');
                    const roundData = roundSnap.val();
                    
                    if (roundData && roundData.lastBigBuyAddress) {
                        if (roundData.lastBigBuyAddress === trimmedAddress) {
                            // æ£€æŸ¥æ˜¯å¦å·²ç»é¢†å–è¿‡
                            const claimedRef = firebase.database().ref(`claimedRewards/countdown/${roundId}/${trimmedAddress}`);
                            const claimedSnap = await claimedRef.once('value');
                            const hasClaimed = claimedSnap.exists();
                            
                            if (hasClaimed) {
                                return { 
                                    valid: true, 
                                    message: 'âœ… è¯¥åœ°å€æ˜¯æœ€åå€’è®¡æ—¶åœ°å€ï¼Œä½†å·²é¢†å–è¿‡å¥–åŠ±', 
                                    type: 'lastSuccess',
                                    claimed: true
                                };
                            } else {
                                return { 
                                    valid: true, 
                                    message: 'âœ… è¯¥åœ°å€æ˜¯æœ€åå€’è®¡æ—¶åœ°å€ï¼Œå¯é¢†å–å¥–åŠ±ï¼', 
                                    type: 'lastSuccess',
                                    claimed: false
                                };
                            }
                        }
                    }
                }
                
                // 3. å¦‚æœéƒ½æ²¡æœ‰æ‰¾åˆ°ï¼Œè¿”å›ä¸ç¬¦åˆæ¡ä»¶
                return { 
                    valid: false, 
                    message: 'âŒ è¯¥åœ°å€ä¸ç¬¦åˆé¢†å–æ¡ä»¶\n\nå¯èƒ½çš„åŸå› ï¼š\nâ€¢ ä¸åœ¨å½“å‰è½®æ¬¡çš„æŒä»“å‰20ä¸­\nâ€¢ ä¸æ˜¯å½“å‰è½®æ¬¡çš„æœ€åå¤§é¢ä¹°å…¥åœ°å€\nâ€¢ å½“å‰è½®æ¬¡æ•°æ®å°šæœªç”Ÿæˆ' 
                };
                
            } catch (error) {
                console.error('åœ°å€éªŒè¯å¤±è´¥:', error);
                return { 
                    valid: false, 
                    message: 'âŒ éªŒè¯è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•' 
                };
            }
        }

        // é¢†å–å‰20åå¥–åŠ±ï¼ˆç§¯åˆ†ç‰ˆï¼‰
        async function claimTop20Reward() {
            console.log('=== å¼€å§‹é¢†å–æŒä»“å‰20æŒæœ‰è€…å¥–åŠ±ï¼ˆç§¯åˆ†ç‰ˆï¼‰ ===');
            
            // æ£€æŸ¥é’±åŒ…è¿æ¥çŠ¶æ€
            if (!window.walletManager || !window.walletManager.isConnected) {
                alert('è¯·å…ˆè¿æ¥é’±åŒ…ï¼');
                return;
            }
            
            // æ­£ç¡®æå–é’±åŒ…åœ°å€
            let walletAddress = '';
            const walletObj = window.walletManager.currentWallet;
            
            if (walletObj && typeof walletObj === 'object') {
                walletAddress = walletObj.address || 
                               walletObj.publicKey || 
                               walletObj.toString() || 
                               (walletObj.toBase58 && walletObj.toBase58()) ||
                               '';
            } else {
                walletAddress = String(walletObj || '');
            }
            
            walletAddress = String(walletAddress).trim();
            console.log('æå–åˆ°çš„é’±åŒ…åœ°å€:', walletAddress);
            
            if (!walletAddress || walletAddress === 'undefined' || walletAddress === 'null' || walletAddress === '[object Object]') {
                alert('é’±åŒ…åœ°å€æå–å¤±è´¥ï¼Œè¯·é‡æ–°è¿æ¥é’±åŒ…ï¼');
                return;
            }
            
            try {
                // éªŒè¯ç”¨æˆ·æ˜¯å¦æœ‰èµ„æ ¼é¢†å–å‰20æŒæœ‰è€…å¥–åŠ±
                console.log('éªŒè¯ç”¨æˆ·èµ„æ ¼...');
                
                // æ£€æŸ¥æ˜¯å¦åœ¨æŒä»“å‰20ä¸­
                const isTop20 = await validateTop20Eligibility(walletAddress);
                if (!isTop20.eligible) {
                    alert(`âŒ æ‚¨æ²¡æœ‰èµ„æ ¼é¢†å–å‰20æŒæœ‰è€…å¥–åŠ±ï¼š\n${isTop20.reason}`);
                    return;
                }
                
                // æ£€æŸ¥æ˜¯å¦å·²ç»é¢†å–è¿‡
                const hasClaimed = await checkTop20Claimed(walletAddress);
                if (hasClaimed) {
                    alert('âŒ æ‚¨å·²ç»é¢†å–è¿‡å‰20æŒæœ‰è€…å¥–åŠ±ï¼Œæ— æ³•é‡å¤é¢†å–ï¼');
                    return;
                }
                
                console.log('éªŒè¯é€šè¿‡ï¼Œå¼€å§‹æ·»åŠ ç§¯åˆ†...');
                
                // ä½¿ç”¨Firebase Realtime Databaseç›´æ¥æ·»åŠ ç§¯åˆ†
                const userRef = firebase.database().ref(`users/${walletAddress}`);
                const userSnap = await userRef.once('value');
                const userData = userSnap.val() || {};
                const currentScore = parseInt(userData.score || 0);
                const newScore = currentScore + 3000;
                
                // æ›´æ–°ç”¨æˆ·ç§¯åˆ†
                await userRef.update({
                    score: newScore,
                    lastUpdated: Date.now()
                });
                
                // è®°å½•é¢†å–è®°å½•
                await recordTop20Claim(walletAddress);
                
                console.log(`ç§¯åˆ†æ›´æ–°æˆåŠŸ: ${currentScore} -> ${newScore}`);
                
                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                alert(`ğŸ† æŒä»“å‰20æŒæœ‰è€…å¥–åŠ±é¢†å–æˆåŠŸï¼\nè·å¾— 3000 ç§¯åˆ†\nå½“å‰æ€»ç§¯åˆ†: ${newScore}\n\næ‚¨å¯ä»¥ä½¿ç”¨ç§¯åˆ†å…‘æ¢ä»£å¸ï¼`);
                
                // ç¦ç”¨æŒ‰é’®å¹¶æ›´æ–°çŠ¶æ€
                document.getElementById('claimTop20Btn').disabled = true;
                document.getElementById('claimTop20Btn').innerHTML = '<span class="text-white">âœ… å·²é¢†å–</span>';
                
                // åˆ·æ–°å†å²è·å¥–è½®æ¬¡åˆ—è¡¨
                loadHolderRewardRoundsList();
                
            } catch (error) {
                console.error('é¢†å–å¥–åŠ±å¤±è´¥:', error);
                alert('âŒ å¥–åŠ±é¢†å–å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'));
            }
        }

        // é¢†å–æœ€åå€’è®¡æ—¶å¥–åŠ±ï¼ˆç§¯åˆ†ç‰ˆï¼‰
        async function claimLastSuccessReward() {
            console.log('=== å¼€å§‹é¢†å–æœ€åå€’è®¡æ—¶å¥–åŠ±ï¼ˆç§¯åˆ†ç‰ˆï¼‰ ===');
            
            // æ£€æŸ¥é’±åŒ…è¿æ¥çŠ¶æ€
            if (!window.walletManager || !window.walletManager.isConnected) {
                alert('è¯·å…ˆè¿æ¥é’±åŒ…ï¼');
                return;
            }
            
            // æ­£ç¡®æå–é’±åŒ…åœ°å€
            let walletAddress = '';
            const walletObj = window.walletManager.currentWallet;
            
            if (walletObj && typeof walletObj === 'object') {
                walletAddress = walletObj.address || 
                               walletObj.publicKey || 
                               walletObj.toString() || 
                               (walletObj.toBase58 && walletObj.toBase58()) ||
                               '';
            } else {
                walletAddress = String(walletObj || '');
            }
            
            walletAddress = String(walletAddress).trim();
            console.log('æå–åˆ°çš„é’±åŒ…åœ°å€:', walletAddress);
            
            if (!walletAddress || walletAddress === 'undefined' || walletAddress === 'null' || walletAddress === '[object Object]') {
                alert('é’±åŒ…åœ°å€æå–å¤±è´¥ï¼Œè¯·é‡æ–°è¿æ¥é’±åŒ…ï¼');
                return;
            }
            
            try {
                // éªŒè¯ç”¨æˆ·æ˜¯å¦æœ‰èµ„æ ¼é¢†å–æœ€åå€’è®¡æ—¶å¥–åŠ±
                console.log('éªŒè¯ç”¨æˆ·èµ„æ ¼...');
                
                // æ£€æŸ¥æ˜¯å¦æ˜¯æœ€åå¤§é¢ä¹°å…¥åœ°å€
                const isLastBuyer = await validateLastBuyerEligibility(walletAddress);
                if (!isLastBuyer.eligible) {
                    alert(`âŒ æ‚¨æ²¡æœ‰èµ„æ ¼é¢†å–æœ€åå€’è®¡æ—¶å¥–åŠ±ï¼š\n${isLastBuyer.reason}`);
                    return;
                }
                
                // æ£€æŸ¥æ˜¯å¦å·²ç»é¢†å–è¿‡
                const hasClaimed = await checkLastBuyerClaimed(walletAddress);
                if (hasClaimed) {
                    alert('âŒ æ‚¨å·²ç»é¢†å–è¿‡æœ€åå€’è®¡æ—¶å¥–åŠ±ï¼Œæ— æ³•é‡å¤é¢†å–ï¼');
                    return;
                }
                
                console.log('éªŒè¯é€šè¿‡ï¼Œå¼€å§‹æ·»åŠ ç§¯åˆ†...');
                
                // ä½¿ç”¨Firebase Realtime Databaseç›´æ¥æ·»åŠ ç§¯åˆ†
                const userRef = firebase.database().ref(`users/${walletAddress}`);
                const userSnap = await userRef.once('value');
                const userData = userSnap.val() || {};
                const currentScore = parseInt(userData.score || 0);
                const newScore = currentScore + 10000;
                
                // æ›´æ–°ç”¨æˆ·ç§¯åˆ†
                await userRef.update({
                    score: newScore,
                    lastUpdated: Date.now()
                });
                
                // è®°å½•é¢†å–è®°å½•
                await recordLastBuyerClaim(walletAddress);
                
                console.log(`ç§¯åˆ†æ›´æ–°æˆåŠŸ: ${currentScore} -> ${newScore}`);
                
                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                alert(`ğŸ’° æœ€åå€’è®¡æ—¶å¥–åŠ±é¢†å–æˆåŠŸï¼\nè·å¾— 10000 ç§¯åˆ†\nå½“å‰æ€»ç§¯åˆ†: ${newScore}\n\næ‚¨å¯ä»¥ä½¿ç”¨ç§¯åˆ†å…‘æ¢ä»£å¸ï¼`);
                
                // ç¦ç”¨æŒ‰é’®å¹¶æ›´æ–°çŠ¶æ€
                document.getElementById('claimLastSuccessBtn').disabled = true;
                document.getElementById('claimLastSuccessBtn').innerHTML = '<span class="text-white">âœ… å·²é¢†å–</span>';
                
                // åˆ·æ–°å†å²è·å¥–è½®æ¬¡åˆ—è¡¨
                loadCountdownRewardRoundsList();
                
            } catch (error) {
                console.error('é¢†å–å¥–åŠ±å¤±è´¥:', error);
                alert('âŒ å¥–åŠ±é¢†å–å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'));
            }
        }
        
        // åŠ è½½æŒä»“å¥–åŠ±å†å²è½®æ¬¡åˆ—è¡¨
        function loadHolderRewardRoundsList() {
            const holderRewardRoundsList = document.getElementById('holderRewardRoundsList');
            if (!holderRewardRoundsList) return;
            
            holderRewardRoundsList.innerHTML = '<div class="text-center text-gray-400">åŠ è½½ä¸­...</div>';
            
            if (window.solanaTracker) {
                window.solanaTracker.getAllHolderRewardRounds()
                    .then((rounds) => {
                        if (rounds.length === 0) {
                            holderRewardRoundsList.innerHTML = '<div class="text-center text-gray-400">æš‚æ— æŒä»“å¥–åŠ±å†å²</div>';
                            return;
                        }
                        
                        let html = '';
                        rounds.forEach((round, index) => {
                            const roundDate = new Date(round.timestamp).toLocaleString('zh-CN');
                            const isClaimed = round.isClaimed ? 'âœ… å·²é¢†å–' : 'â³ å¾…é¢†å–';
                            const claimedDate = round.claimedAt ? new Date(round.claimedAt).toLocaleString('zh-CN') : '';
                            
                            html += `
                                <div class="border-b border-gray-500 pb-3 mb-3 ${index === 0 ? 'border-t border-gray-500 pt-3' : ''}">
                                    <div class="flex justify-between items-start mb-2">
                                        <div class="font-bold text-memeYellow">æŒä»“è½®æ¬¡ ${round.roundId}</div>
                                        <div class="text-xs text-gray-400">${roundDate}</div>
                                    </div>
                                    
                                    <div class="text-xs text-gray-300 space-y-1 mb-2">
                                        <div>â€¢ å‰20æŒæœ‰è€…æ•°é‡ï¼š${round.top20Holders ? round.top20Holders.length : 0} ä¸ªåœ°å€</div>
                                        <div>â€¢ é¢†å–çŠ¶æ€ï¼š${isClaimed}</div>
                                        ${claimedDate ? `<div>â€¢ é¢†å–æ—¶é—´ï¼š${claimedDate}</div>` : ''}
                                    </div>
                                    
                                    <div class="text-xs text-gray-400">
                                        <div>â€¢ ä»£å¸åœ°å€ï¼š${round.tokenAddress ? round.tokenAddress.substring(0, 6) + '...' + round.tokenAddress.substring(round.tokenAddress.length - 4) : 'æœªçŸ¥'}</div>
                                        <div>â€¢ å¥–åŠ±ç±»å‹ï¼šæŒä»“å‰20æŒæœ‰è€…å¥–åŠ±</div>
                                    </div>
                                </div>
                            `;
                        });
                        
                        holderRewardRoundsList.innerHTML = html;
                    })
                    .catch((error) => {
                        console.error('åŠ è½½æŒä»“å¥–åŠ±å†å²å¤±è´¥:', error);
                        holderRewardRoundsList.innerHTML = '<div class="text-center text-red-400">åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•</div>';
                    });
            } else {
                holderRewardRoundsList.innerHTML = '<div class="text-center text-red-400">ç³»ç»Ÿæœªåˆå§‹åŒ–</div>';
            }
        }
        
        // åŠ è½½å€’è®¡æ—¶å¥–åŠ±å†å²è½®æ¬¡åˆ—è¡¨
        function loadCountdownRewardRoundsList() {
            const countdownRewardRoundsList = document.getElementById('countdownRewardRoundsList');
            if (!countdownRewardRoundsList) return;
            
            countdownRewardRoundsList.innerHTML = '<div class="text-center text-gray-400">åŠ è½½ä¸­...</div>';
            
            if (window.solanaTracker) {
                window.solanaTracker.getAllWinnerRounds()
                    .then((rounds) => {
                        if (rounds.length === 0) {
                            countdownRewardRoundsList.innerHTML = '<div class="text-center text-gray-400">æš‚æ— å€’è®¡æ—¶å¥–åŠ±å†å²</div>';
                            return;
                        }
                        
                        let html = '';
                        rounds.forEach((round, index) => {
                            const roundDate = new Date(round.timestamp).toLocaleString('zh-CN');
                            const isClaimed = round.isClaimed ? 'âœ… å·²é¢†å–' : 'â³ å¾…é¢†å–';
                            const claimedDate = round.claimedAt ? new Date(round.claimedAt).toLocaleString('zh-CN') : '';
                            
                            html += `
                                <div class="border-b border-gray-500 pb-3 mb-3 ${index === 0 ? 'border-t border-gray-500 pt-3' : ''}">
                                    <div class="flex justify-between items-start mb-2">
                                        <div class="font-bold text-memeYellow">å€’è®¡æ—¶è½®æ¬¡ ${round.roundId}</div>
                                        <div class="text-xs text-gray-400">${roundDate}</div>
                                    </div>
                                    
                                    <div class="text-xs text-gray-300 space-y-1 mb-2">
                                        <div>â€¢ æœ€åå¤§é¢ä¹°å…¥åœ°å€ï¼š${round.lastBigBuyAddress ? round.lastBigBuyAddress.substring(0, 6) + '...' + round.lastBigBuyAddress.substring(round.lastBigBuyAddress.length - 4) : 'æ— '}</div>
                                        <div>â€¢ ä¹°å…¥æ•°é‡ï¼š${round.lastBigBuyAmount ? round.lastBigBuyAmount.toLocaleString() : '0'}</div>
                                        <div>â€¢ é¢†å–çŠ¶æ€ï¼š${isClaimed}</div>
                                        ${claimedDate ? `<div>â€¢ é¢†å–æ—¶é—´ï¼š${claimedDate}</div>` : ''}
                                    </div>
                                    
                                    <div class="text-xs text-gray-400">
                                        <div>â€¢ ä»£å¸åœ°å€ï¼š${round.tokenAddress ? round.tokenAddress.substring(0, 6) + '...' + round.tokenAddress.substring(round.tokenAddress.length - 4) : 'æœªçŸ¥'}</div>
                                        <div>â€¢ æ€»äº¤æ˜“æ¬¡æ•°ï¼š${round.transactionCount || 0}</div>
                                        <div>â€¢ å€’è®¡æ—¶è°ƒæ•´ï¼š+${round.totalTimeAdjustment || 0} ç§’</div>
                                        <div>â€¢ å¥–åŠ±ç±»å‹ï¼šæœ€åå€’è®¡æ—¶å¥–åŠ±</div>
                                    </div>
                                </div>
                            `;
                        });
                        
                        countdownRewardRoundsList.innerHTML = html;
                    })
                    .catch((error) => {
                        console.error('åŠ è½½å€’è®¡æ—¶å¥–åŠ±å†å²å¤±è´¥:', error);
                        countdownRewardRoundsList.innerHTML = '<div class="text-center text-red-400">åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•</div>';
                    });
            } else {
                countdownRewardRoundsList.innerHTML = '<div class="text-center text-red-400">ç³»ç»Ÿæœªåˆå§‹åŒ–</div>';
            }
        }

        // ç›‘æ§åŠŸèƒ½å·²ç§»è‡³ç®¡ç†é¢æ¿

        // éªŒè¯å‰20æŒæœ‰è€…èµ„æ ¼
        async function validateTop20Eligibility(walletAddress) {
            try {
                console.log('éªŒè¯å‰20æŒæœ‰è€…èµ„æ ¼:', walletAddress);
                
                // ç›´æ¥è·å–æ•°æ®åº“ä¸­çš„æ‰€æœ‰æŒä»“è½®æ¬¡
                const holderRoundsRef = firebase.database().ref('holderRewardRounds');
                const holderRoundsSnap = await holderRoundsRef.once('value');
                const holderRounds = holderRoundsSnap.val();
                
                if (!holderRounds) {
                    return {
                        eligible: false,
                        reason: 'æ•°æ®åº“ä¸­æ²¡æœ‰æŒä»“è½®æ¬¡æ•°æ®'
                    };
                }
                
                // éå†æ‰€æœ‰è½®æ¬¡ï¼Œæ£€æŸ¥æ˜¯å¦åœ¨ä»»ä½•è½®æ¬¡ä¸­
                const roundIds = Object.keys(holderRounds);
                console.log('æ•°æ®åº“ä¸­çš„è½®æ¬¡IDåˆ—è¡¨:', roundIds);
                
                // æŒ‰æ—¶é—´å€’åºæ’åˆ—è½®æ¬¡ï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
                roundIds.sort((a, b) => {
                    const timeA = parseInt(a.split('_').pop());
                    const timeB = parseInt(b.split('_').pop());
                    return timeB - timeA;
                });
                
                for (const roundId of roundIds) {
                    const roundData = holderRounds[roundId];
                    console.log(`æ£€æŸ¥è½®æ¬¡ ${roundId}:`, roundData);
                    
                    if (roundData && roundData.top20Holders && Array.isArray(roundData.top20Holders)) {
                        // æ£€æŸ¥åœ°å€æ˜¯å¦åœ¨å‰20ä¸­
                        const isTop20 = roundData.top20Holders.some(holder => {
                            const holderAddress = holder.address || holder.wallet || holder.publicKey;
                            console.log(`æ¯”è¾ƒåœ°å€: ${holderAddress} vs ${walletAddress}`);
                            return holderAddress === walletAddress;
                        });
                        
                        console.log(`è½®æ¬¡ ${roundId} ä¸­æ˜¯å¦åœ¨å‰20:`, isTop20);
                        
                        if (isTop20) {
                            // æ£€æŸ¥æ˜¯å¦å·²ç»é¢†å–è¿‡è¿™ä¸ªè½®æ¬¡çš„å¥–åŠ±
                            const claimedRef = firebase.database().ref(`claimedRewards/top20/${roundId}/${walletAddress}`);
                            const claimedSnap = await claimedRef.once('value');
                            const hasClaimed = claimedSnap.exists();
                            
                            console.log(`è½®æ¬¡ ${roundId} æ˜¯å¦å·²é¢†å–:`, hasClaimed);
                            
                            if (!hasClaimed) {
                                // è®¾ç½®å½“å‰è½®æ¬¡IDï¼Œä¾›åç»­ä½¿ç”¨
                                if (!window.solanaTracker) window.solanaTracker = {};
                                window.solanaTracker.currentHolderRewardRoundId = roundId;
                                
                                return { 
                                    eligible: true,
                                    roundId: roundId
                                };
                            }
                        }
                    } else {
                        console.log(`è½®æ¬¡ ${roundId} æ•°æ®æ— æ•ˆ:`, roundData);
                    }
                }
                
                // å¦‚æœæ‰€æœ‰è½®æ¬¡éƒ½æ£€æŸ¥å®Œäº†ï¼Œè¯´æ˜æ²¡æœ‰èµ„æ ¼
                return {
                    eligible: false,
                    reason: `æ‚¨çš„åœ°å€ä¸åœ¨ä»»ä½•æŒä»“å‰20æŒæœ‰è€…ä¸­ï¼Œæˆ–å·²é¢†å–è¿‡æ‰€æœ‰è½®æ¬¡çš„å¥–åŠ±\n\næ£€æŸ¥çš„è½®æ¬¡: ${roundIds.join(', ')}`
                };
                
            } catch (error) {
                console.error('éªŒè¯å‰20æŒæœ‰è€…èµ„æ ¼å¤±è´¥:', error);
                return {
                    eligible: false,
                    reason: 'éªŒè¯è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ' + error.message
                };
            }
        }
        
        // æ£€æŸ¥å‰20æŒæœ‰è€…æ˜¯å¦å·²é¢†å–
        async function checkTop20Claimed(walletAddress) {
            try {
                // æ£€æŸ¥æ‰€æœ‰è½®æ¬¡æ˜¯å¦å·²é¢†å–
                const holderRoundsRef = firebase.database().ref('holderRewardRounds');
                const holderRoundsSnap = await holderRoundsRef.once('value');
                const holderRounds = holderRoundsSnap.val();
                
                if (!holderRounds) return false;
                
                const roundIds = Object.keys(holderRounds);
                
                for (const roundId of roundIds) {
                    const roundData = holderRounds[roundId];
                    if (roundData && roundData.top20Holders && Array.isArray(roundData.top20Holders)) {
                        const isTop20 = roundData.top20Holders.some(holder => {
                            const holderAddress = holder.address || holder.wallet || holder.publicKey;
                            return holderAddress === walletAddress;
                        });
                        
                        if (isTop20) {
                            const claimedRef = firebase.database().ref(`claimedRewards/top20/${roundId}/${walletAddress}`);
                            const claimedSnap = await claimedRef.once('value');
                            if (claimedSnap.exists()) {
                                return true; // å·²é¢†å–è¿‡æŸä¸ªè½®æ¬¡
                            }
                        }
                    }
                }
                
                return false; // æ²¡æœ‰é¢†å–è¿‡ä»»ä½•è½®æ¬¡
                
            } catch (error) {
                console.error('æ£€æŸ¥å‰20æŒæœ‰è€…é¢†å–çŠ¶æ€å¤±è´¥:', error);
                return false;
            }
        }
        
        // è®°å½•å‰20æŒæœ‰è€…é¢†å–
        async function recordTop20Claim(walletAddress) {
            try {
                const roundId = window.solanaTracker?.currentHolderRewardRoundId;
                if (!roundId) {
                    console.error('æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„è½®æ¬¡ID');
                    return;
                }
                
                const claimData = {
                    wallet: walletAddress,
                    roundId: roundId,
                    rewardType: 'top20',
                    amount: 3000,
                    claimedAt: Date.now()
                };
                
                const claimedRef = firebase.database().ref(`claimedRewards/top20/${roundId}/${walletAddress}`);
                await claimedRef.set(claimData);
                
                console.log(`å‰20æŒæœ‰è€…é¢†å–è®°å½•å·²ä¿å­˜ï¼Œè½®æ¬¡: ${roundId}`);
                
            } catch (error) {
                console.error('è®°å½•å‰20æŒæœ‰è€…é¢†å–å¤±è´¥:', error);
            }
        }
        
        // éªŒè¯æœ€åå¤§é¢ä¹°å…¥è€…èµ„æ ¼
        async function validateLastBuyerEligibility(walletAddress) {
            try {
                console.log('éªŒè¯æœ€åå¤§é¢ä¹°å…¥è€…èµ„æ ¼:', walletAddress);
                
                // æ£€æŸ¥æ˜¯å¦æœ‰æ¸¸æˆè½®æ¬¡æ•°æ®
                if (!window.solanaTracker || !window.solanaTracker.currentRoundId) {
                    return {
                        eligible: false,
                        reason: 'æš‚æ— æ¸¸æˆè½®æ¬¡æ•°æ®ï¼Œè¯·ç­‰å¾…æ¸¸æˆå¼€å§‹'
                    };
                }
                
                // è·å–å½“å‰æ¸¸æˆè½®æ¬¡æ•°æ®
                const roundId = window.solanaTracker.currentRoundId;
                const roundRef = firebase.database().ref(`gameRounds/${roundId}`);
                const roundSnap = await roundRef.once('value');
                const roundData = roundSnap.val();
                
                if (!roundData || !roundData.lastBigBuyAddress) {
                    return {
                        eligible: false,
                        reason: 'æ¸¸æˆæ•°æ®ä¸å­˜åœ¨æˆ–æ— æ•ˆ'
                    };
                }
                
                // æ£€æŸ¥æ˜¯å¦æ˜¯æœ€åå¤§é¢ä¹°å…¥åœ°å€
                if (roundData.lastBigBuyAddress !== walletAddress) {
                    return {
                        eligible: false,
                        reason: 'æ‚¨ä¸æ˜¯æœ€åå¤§é¢ä¹°å…¥åœ°å€'
                    };
                }
                
                return { eligible: true };
                
            } catch (error) {
                console.error('éªŒè¯æœ€åå¤§é¢ä¹°å…¥è€…èµ„æ ¼å¤±è´¥:', error);
                return {
                    eligible: false,
                    reason: 'éªŒè¯è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ' + error.message
                };
            }
        }
        
        // æ£€æŸ¥æœ€åå¤§é¢ä¹°å…¥è€…æ˜¯å¦å·²é¢†å–
        async function checkLastBuyerClaimed(walletAddress) {
            try {
                const roundId = window.solanaTracker?.currentRoundId;
                if (!roundId) return false;
                
                const claimedRef = firebase.database().ref(`claimedRewards/countdown/${roundId}/${walletAddress}`);
                const claimedSnap = await claimedRef.once('value');
                return claimedSnap.exists();
                
            } catch (error) {
                console.error('æ£€æŸ¥æœ€åå¤§é¢ä¹°å…¥è€…é¢†å–çŠ¶æ€å¤±è´¥:', error);
                return false;
            }
        }
        
        // è®°å½•æœ€åå¤§é¢ä¹°å…¥è€…é¢†å–
        async function recordLastBuyerClaim(walletAddress) {
            try {
                const roundId = window.solanaTracker?.currentRoundId;
                if (!roundId) return;
                
                const claimData = {
                    wallet: walletAddress,
                    roundId: roundId,
                    rewardType: 'countdown',
                    amount: 10000,
                    claimedAt: Date.now()
                };
                
                const claimedRef = firebase.database().ref(`claimedRewards/countdown/${roundId}/${walletAddress}`);
                await claimedRef.set(claimData);
                
                console.log('æœ€åå¤§é¢ä¹°å…¥è€…é¢†å–è®°å½•å·²ä¿å­˜');
                
            } catch (error) {
                console.error('è®°å½•æœ€åå¤§é¢ä¹°å…¥è€…é¢†å–å¤±è´¥:', error);
            }
        }
        
        // ç§¯åˆ†å…‘æ¢ä»£å¸å‡½æ•°ï¼ˆä½¿ç”¨æˆåŠŸçš„claimTokenï¼‰
        async function claimTokenHandler() {
            console.log('=== å¼€å§‹ç§¯åˆ†å…‘æ¢ä»£å¸ ===');
            
            // æ£€æŸ¥é’±åŒ…è¿æ¥çŠ¶æ€
            if (!window.walletManager || !window.walletManager.isConnected) {
                alert('è¯·å…ˆè¿æ¥é’±åŒ…ï¼');
                return;
            }
            
            // æ­£ç¡®æå–é’±åŒ…åœ°å€
            let walletAddress = '';
            const walletObj = window.walletManager.currentWallet;
            
            if (walletObj && typeof walletObj === 'object') {
                walletAddress = walletObj.address || 
                               walletObj.publicKey || 
                               walletObj.toString() || 
                               (walletObj.toBase58 && walletObj.toBase58()) ||
                               '';
            } else {
                walletAddress = String(walletObj || '');
            }
            
            walletAddress = String(walletAddress).trim();
            console.log('æå–åˆ°çš„é’±åŒ…åœ°å€:', walletAddress);
            
            if (!walletAddress || walletAddress === 'undefined' || walletAddress === 'null' || walletAddress === '[object Object]') {
                alert('é’±åŒ…åœ°å€æå–å¤±è´¥ï¼Œè¯·é‡æ–°è¿æ¥é’±åŒ…ï¼');
                return;
            }
            
            // è·å–æŒ‰é’®å¹¶æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            const claimTokenBtn = document.getElementById('claimTokenBtn');
            const originalContent = claimTokenBtn.innerHTML;
            claimTokenBtn.innerHTML = '<span class="text-white">â³ å…‘æ¢ä¸­...</span>';
            claimTokenBtn.disabled = true;
            
            try {
                console.log('è°ƒç”¨æˆåŠŸçš„claimTokenå‡½æ•°...');
                
                // ä½¿ç”¨å’ŒæˆåŠŸç‰ˆæœ¬å®Œå…¨ä¸€æ ·çš„è°ƒç”¨æ–¹å¼
                const claimToken = firebase.functions().httpsCallable("claimToken");
                const result = await claimToken({ wallet: walletAddress });
                
                console.log('claimTokenè°ƒç”¨æˆåŠŸ:', result);
                
                if (result.data.success) {
                    alert(`ğŸ‰ ç§¯åˆ†å…‘æ¢æˆåŠŸï¼\näº¤æ˜“å“ˆå¸Œï¼š${result.data.tx}\n\næ‚¨çš„ä»£å¸å·²å‘é€åˆ°é’±åŒ…ï¼`);
                    
                    // æ›´æ–°ç§¯åˆ†æ˜¾ç¤º
                    updateScoreDisplay();
                } else {
                    alert('âŒ ç§¯åˆ†å…‘æ¢å¤±è´¥: ' + (result.data.message || 'æœªçŸ¥é”™è¯¯'));
                }
                
            } catch (error) {
                console.error('ç§¯åˆ†å…‘æ¢å¤±è´¥:', error);
                
                if (error.message && error.message.includes('æ²¡æœ‰å¯å…‘æ¢çš„ç§¯åˆ†')) {
                    alert('âŒ æ²¡æœ‰å¯å…‘æ¢çš„ç§¯åˆ†ï¼Œè¯·å…ˆé¢†å–æ¸¸æˆå¥–åŠ±ï¼');
                } else if (error.message && error.message.includes('å‘å¸å¤±è´¥')) {
                    alert('âŒ ä»£å¸å‘é€å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                } else {
                    alert('âŒ ç§¯åˆ†å…‘æ¢å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'));
                }
            } finally {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                claimTokenBtn.innerHTML = originalContent;
                claimTokenBtn.disabled = false;
            }
        }
        
        // æ›´æ–°ç§¯åˆ†æ˜¾ç¤º
        async function updateScoreDisplay() {
            if (!window.walletManager || !window.walletManager.isConnected) return;
            
            try {
                const walletAddress = window.walletManager.currentWallet?.address || 
                                    window.walletManager.currentWallet?.publicKey || 
                                    String(window.walletManager.currentWallet || '');
                
                if (!walletAddress || walletAddress === 'undefined') return;
                
                const userRef = firebase.database().ref(`users/${walletAddress}`);
                const userSnap = await userRef.once('value');
                const userData = userSnap.val() || {};
                const currentScore = parseInt(userData.score || 0);
                
                // æ›´æ–°æ˜¾ç¤º
                const currentScoreElement = document.getElementById('currentScore');
                const exchangeableTokensElement = document.getElementById('exchangeableTokens');
                
                if (currentScoreElement) currentScoreElement.textContent = currentScore;
                if (exchangeableTokensElement) exchangeableTokensElement.textContent = currentScore;
                
                // æ›´æ–°å…‘æ¢æŒ‰é’®çŠ¶æ€
                const claimTokenBtn = document.getElementById('claimTokenBtn');
                if (claimTokenBtn) {
                    claimTokenBtn.disabled = currentScore <= 0;
                }
                
            } catch (error) {
                console.error('æ›´æ–°ç§¯åˆ†æ˜¾ç¤ºå¤±è´¥:', error);
            }
        }
        
        // ç›‘å¬å¥–åŠ±é¡µé¢æŒ‰é’®äº‹ä»¶
        document.addEventListener('DOMContentLoaded', function() {
            // é¢†å–å¥–åŠ±æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.getElementById('claimRewardBtn').addEventListener('click', showRewardPage);
            
            // å‰20%å¥–åŠ±æŒ‰é’®
            document.getElementById('claimTop20Btn').addEventListener('click', claimTop20Reward);
            
            // æœ€åå€’è®¡æ—¶å¥–åŠ±æŒ‰é’®
            document.getElementById('claimLastSuccessBtn').addEventListener('click', claimLastSuccessReward);
            
            // ç§¯åˆ†å…‘æ¢ä»£å¸æŒ‰é’®
            document.getElementById('claimTokenBtn').addEventListener('click', claimTokenHandler);
            
            // è°ƒè¯•æŒ‰é’®
            document.getElementById('debugBtn').addEventListener('click', async function() {
                const debugResult = document.getElementById('debugResult');
                debugResult.innerHTML = '<span class="text-blue-400">â³ è°ƒè¯•ä¸­...</span>';
                
                try {
                    const walletAddress = '6btAW2SbJQKtwKRebjUuXA2fPv7MAVYJD1tgCvBx6GB5';
                    
                    // 1. æ£€æŸ¥æ‰€æœ‰è½®æ¬¡
                    const holderRoundsRef = firebase.database().ref('holderRewardRounds');
                    const holderRoundsSnap = await holderRoundsRef.once('value');
                    const holderRounds = holderRoundsSnap.val();
                    
                    let debugInfo = '<div class="space-y-2">';
                    debugInfo += '<div><strong>ğŸ“Š æ•°æ®åº“è½®æ¬¡åˆ—è¡¨:</strong></div>';
                    
                    if (holderRounds) {
                        const roundIds = Object.keys(holderRounds);
                        debugInfo += `<div>â€¢ æ€»è½®æ¬¡æ•°: ${roundIds.length}</div>`;
                        debugInfo += `<div>â€¢ è½®æ¬¡IDåˆ—è¡¨: ${roundIds.join(', ')}</div>`;
                        
                        // 2. è¯¦ç»†æ£€æŸ¥æ¯ä¸ªè½®æ¬¡
                        debugInfo += '<div><strong>ğŸ” è¯¦ç»†è½®æ¬¡æ£€æŸ¥:</strong></div>';
                        let foundInAnyRound = false;
                        
                        for (const roundId of roundIds) {
                            const roundData = holderRounds[roundId];
                            debugInfo += `<div class="mt-2 p-2 bg-gray-800 rounded">`;
                            debugInfo += `<div><strong>è½®æ¬¡: ${roundId}</strong></div>`;
                            
                            if (roundData && roundData.top20Holders) {
                                debugInfo += `<div>â€¢ å‰20æŒæœ‰è€…æ•°é‡: ${roundData.top20Holders.length}</div>`;
                                
                                // æ£€æŸ¥æ˜¯å¦åŒ…å«ç›®æ ‡åœ°å€
                                const isInTop20 = roundData.top20Holders.some(h => h.address === walletAddress);
                                debugInfo += `<div>â€¢ åŒ…å«ç›®æ ‡åœ°å€: ${isInTop20 ? 'âœ… æ˜¯' : 'âŒ å¦'}</div>`;
                                
                                if (isInTop20) {
                                    foundInAnyRound = true;
                                    const holder = roundData.top20Holders.find(h => h.address === walletAddress);
                                    debugInfo += `<div>â€¢ åœ°å€è¯¦æƒ…: ${JSON.stringify(holder)}</div>`;
                                    
                                    // æ£€æŸ¥æ˜¯å¦å·²é¢†å–
                                    const claimedRef = firebase.database().ref(`claimedRewards/top20/${roundId}/${walletAddress}`);
                                    const claimedSnap = await claimedRef.once('value');
                                    const hasClaimed = claimedSnap.exists();
                                    debugInfo += `<div>â€¢ æ˜¯å¦å·²é¢†å–: ${hasClaimed ? 'âœ… å·²é¢†å–' : 'âŒ æœªé¢†å–'}</div>`;
                                }
                                
                                // æ˜¾ç¤ºå‰3ä¸ªåœ°å€ä½œä¸ºç¤ºä¾‹
                                debugInfo += `<div>â€¢ å‰3ä¸ªåœ°å€ç¤ºä¾‹:</div>`;
                                roundData.top20Holders.slice(0, 3).forEach((holder, index) => {
                                    debugInfo += `<div class="ml-4">${index + 1}. ${holder.address}</div>`;
                                });
                            } else {
                                debugInfo += `<div>âŒ è½®æ¬¡æ•°æ®æ— æ•ˆæˆ–ç¼ºå°‘top20Holders</div>`;
                            }
                            
                            debugInfo += `</div>`;
                        }
                        
                        debugInfo += `<div><strong>ğŸ“‹ æ€»ç»“:</strong></div>`;
                        debugInfo += `<div>â€¢ åœ¨ä»»æ„è½®æ¬¡ä¸­æ‰¾åˆ°åœ°å€: ${foundInAnyRound ? 'âœ… æ˜¯' : 'âŒ å¦'}</div>`;
                        
                        // 3. æ£€æŸ¥å‰ç«¯è½®æ¬¡ID
                        debugInfo += '<div><strong>ğŸ” å‰ç«¯çŠ¶æ€:</strong></div>';
                        debugInfo += `<div>â€¢ solanaTrackerå­˜åœ¨: ${!!window.solanaTracker}</div>`;
                        if (window.solanaTracker) {
                            debugInfo += `<div>â€¢ currentHolderRewardRoundId: ${window.solanaTracker.currentHolderRewardRoundId || 'undefined'}</div>`;
                            debugInfo += `<div>â€¢ currentRoundId: ${window.solanaTracker.currentRoundId || 'undefined'}</div>`;
                        }
                        
                        // 4. æµ‹è¯•éªŒè¯å‡½æ•°
                        debugInfo += '<div><strong>ğŸ§ª éªŒè¯æµ‹è¯•:</strong></div>';
                        const testResult = await validateTop20Eligibility(walletAddress);
                        debugInfo += `<div>â€¢ éªŒè¯ç»“æœ: ${testResult.eligible ? 'âœ… æœ‰èµ„æ ¼' : 'âŒ æ— èµ„æ ¼'}</div>`;
                        if (!testResult.eligible) {
                            debugInfo += `<div>â€¢ åŸå› : ${testResult.reason}</div>`;
                        }
                        
                    } else {
                        debugInfo += '<div>âŒ æ•°æ®åº“ä¸­æ²¡æœ‰æŒä»“è½®æ¬¡æ•°æ®</div>';
                    }
                    
                    debugInfo += '</div>';
                    debugResult.innerHTML = debugInfo;
                    
                } catch (error) {
                    debugResult.innerHTML = `<span class="text-red-400">âŒ è°ƒè¯•å¤±è´¥: ${error.message}</span>`;
                }
            });
            
            // éªŒè¯åœ°å€æŒ‰é’®
            document.getElementById('verifyAddressBtn').addEventListener('click', async function() {
                const address = document.getElementById('verifyAddressInput').value.trim();
                const resultDiv = document.getElementById('verifyResult');
                const verifyBtn = document.getElementById('verifyAddressBtn');
                
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                resultDiv.innerHTML = '<span class="text-blue-400">â³ éªŒè¯ä¸­...</span>';
                verifyBtn.disabled = true;
                verifyBtn.innerHTML = '<span class="text-white">â³ éªŒè¯ä¸­...</span>';
                
                try {
                    const result = await verifyAddress(address);
                    
                    if (result.valid) {
                        if (result.claimed) {
                            resultDiv.innerHTML = `<span class="text-yellow-400">${result.message}</span>`;
                        } else {
                            resultDiv.innerHTML = `<span class="text-green-400">${result.message}</span>`;
                        }
                    } else {
                        resultDiv.innerHTML = `<span class="text-red-400">${result.message}</span>`;
                    }
                } catch (error) {
                    console.error('åœ°å€éªŒè¯å¤±è´¥:', error);
                    resultDiv.innerHTML = '<span class="text-red-400">âŒ éªŒè¯å¤±è´¥ï¼Œè¯·é‡è¯•</span>';
                } finally {
                    // æ¢å¤æŒ‰é’®çŠ¶æ€
                    verifyBtn.disabled = false;
                    verifyBtn.innerHTML = '<span class="text-white">ğŸ” éªŒè¯åœ°å€</span>';
                }
            });
            
            // é¡µé¢åŠ è½½æ—¶æ›´æ–°ç§¯åˆ†æ˜¾ç¤º
            setTimeout(updateScoreDisplay, 1000);
            
            // ç›‘å¬é’±åŒ…è¿æ¥çŠ¶æ€å˜åŒ–ï¼Œè‡ªåŠ¨å¡«å……åœ°å€
            if (window.walletManager) {
                // åˆå§‹å¡«å……
                setTimeout(() => {
                    const walletAddress = window.walletManager.currentWallet?.address || 
                                        window.walletManager.currentWallet?.publicKey || 
                                        String(window.walletManager.currentWallet || '');
                    
                    if (walletAddress && walletAddress !== 'undefined' && walletAddress !== 'null') {
                        const verifyInput = document.getElementById('verifyAddressInput');
                        if (verifyInput) {
                            verifyInput.value = walletAddress;
                        }
                    }
                }, 2000);
            }
        });
    </script>
</body>
</html>
