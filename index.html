<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meme Coin Countdown</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- é…ç½®Tailwindè‡ªå®šä¹‰é¢œè‰²å’Œå­—ä½“ -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        memeYellow: '#FFDD00',
                        memePink: '#FF2E63',
                        memeBlue: '#08D9D6',
                        memePurple: '#9D4EDD',
                        memeGreen: '#4CAF50',
                    },
                    fontFamily: {
                        meme: ['"Comic Sans MS"', '"Comic Neue"', 'cursive'],
                    },
                    animation: {
                        'float': 'float 3s ease-in-out infinite',
                        'pulse-fast': 'pulse 1s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'spin-slow': 'spin 8s linear infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .text-shadow {
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            }
            .text-shadow-meme {
                text-shadow: 3px 3px 0px #000;
            }
            .border-meme {
                border: 4px solid #000;
                border-radius: 12px;
            }
            .rotate-random {
                transform: rotate(-2deg);
            }
            .rotate-random-reverse {
                transform: rotate(2deg);
            }
            .glow {
                box-shadow: 0 0 15px rgba(255, 221, 0, 0.7);
            }
        }
    </style>
</head>
<body class="bg-gray-900 font-meme min-h-screen overflow-x-hidden relative">
    <!-- èƒŒæ™¯è£…é¥°å…ƒç´  -->
    <div class="absolute top-10 left-10 w-20 h-20 bg-memePink rounded-full opacity-50 animate-spin-slow"></div>
    <div class="absolute bottom-20 right-10 w-32 h-32 bg-memeBlue rounded-full opacity-40 animate-spin-slow"></div>
    <div class="absolute top-1/3 right-1/4 w-16 h-16 bg-memeYellow rounded-full opacity-60 animate-spin-slow"></div>
    
    <!-- æ¼‚æµ®çš„MEMEæ–‡å­— -->
    <div class="absolute top-20 right-20 text-5xl font-bold text-memePurple opacity-20 rotate-12 animate-float">MEME</div>
    <div class="absolute bottom-40 left-20 text-6xl font-bold text-memeGreen opacity-20 -rotate-6 animate-float" style="animation-delay: 1s">TO THE MOON</div>
    <div class="absolute top-1/2 left-10 text-4xl font-bold text-memePink opacity-20 rotate-6 animate-float" style="animation-delay: 0.5s">HODL</div>
    
    <!-- ä¸»å®¹å™¨ -->
    <div class="container mx-auto px-4 py-12 relative z-10">
        <!-- é¡¶éƒ¨æ ‡é¢˜ -->
        <header class="text-center mb-8">
            <h1 class="text-[clamp(2.5rem,8vw,5rem)] font-bold text-memeYellow text-shadow-meme mb-4 transform hover:scale-105 transition-transform duration-300">
                MOON LAUNCH
            </h1>
            <p class="text-[clamp(1.2rem,4vw,2rem)] text-white animate-pulse-fast">
                ğŸš€ Countdown to the next big meme coin! ğŸš€
            </p>
        </header>
        
        <!-- å€’è®¡æ—¶ä¸»ä½“ - ä¸­é—´åä¸Šä½ç½® -->
        <div class="max-w-4xl mx-auto my-12 border-meme bg-gradient-to-br from-gray-800 to-gray-900 p-8 md:p-12 relative">
            <!-- è£…é¥°å…ƒç´  -->
            <div class="absolute -top-6 -left-6 bg-memePink p-3 rotate-random border-meme">
                <i class="fa fa-diamond text-white text-2xl"></i>
            </div>
            <div class="absolute -bottom-6 -right-6 bg-memeBlue p-3 rotate-random-reverse border-meme">
                <i class="fa fa-rocket text-white text-2xl"></i>
            </div>
            
            <h2 class="text-center text-[clamp(1.5rem,5vw,2.5rem)] text-memePink mb-8">
                Time Until Launch
            </h2>
            
            <div id="countdown" class="grid grid-cols-2 gap-4 md:gap-8">
                <!-- åˆ† -->
                <div class="bg-memePurple border-meme p-4 text-center transform hover:scale-105 transition-all duration-300 glow">
                    <div id="minutes" class="text-[clamp(2rem,6vw,4rem)] font-bold text-white">00</div>
                    <div class="text-white font-bold">MINUTES</div>
                </div>
                
                <!-- ç§’ -->
                <div class="bg-memeGreen border-meme p-4 text-center transform hover:scale-105 transition-all duration-300 glow">
                    <div id="seconds" class="text-[clamp(2rem,6vw,4rem)] font-bold text-black">00</div>
                    <div class="text-black font-bold">SECONDS</div>
                </div>
            </div>
        </div>
        
        <!-- ä»£å¸äº¤æ˜“æ£€æµ‹åŒºåŸŸ -->
        <div class="max-w-4xl mx-auto my-12 border-meme bg-gradient-to-br from-gray-800 to-gray-900 p-8 md:p-12 relative">
            <!-- è£…é¥°å…ƒç´  -->
            <div class="absolute -top-6 -left-6 bg-memeGreen p-3 rotate-random border-meme">
                <i class="fa fa-bitcoin text-white text-2xl"></i>
            </div>
            <div class="absolute -bottom-6 -right-6 bg-memeYellow p-3 rotate-random-reverse border-meme">
                <i class="fa fa-exchange text-black text-2xl"></i>
            </div>
            
            <h2 class="text-center text-[clamp(1.5rem,5vw,2.5rem)] text-memeGreen mb-8">
                ğŸš€ Solanaå®æ—¶äº¤æ˜“æ£€æµ‹å™¨ ğŸš€
            </h2>
            
            <!-- ä»£å¸åœ°å€æ˜¾ç¤º -->
            <div class="mb-8">
                <div class="bg-gray-700 border-meme p-6">
                    <label class="block text-memeYellow font-bold mb-3">å½“å‰æ£€æµ‹ä»£å¸</label>
                    <div class="flex gap-4 flex-wrap items-center">
                        <input 
                            type="text" 
                            id="tokenAddress" 
                            placeholder="ç­‰å¾…ç®¡ç†é¢æ¿è®¾ç½®ä»£å¸åœ°å€..."
                            class="flex-1 min-w-64 p-3 bg-gray-600 border-2 border-gray-500 rounded-lg text-white placeholder-gray-400 focus:border-memeYellow focus:outline-none"
                            readonly
                        >

                    </div>
                </div>
            </div>
            
            <!-- äº¤æ˜“æ£€æµ‹çŠ¶æ€ -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <!-- æ£€æµ‹çŠ¶æ€ -->
                <div class="bg-memeBlue border-meme p-6 text-center transform hover:scale-105 transition-all duration-300 glow">
                    <div class="text-3xl mb-2">ğŸ“¡</div>
                    <div class="text-xl font-bold text-black mb-2">æ£€æµ‹çŠ¶æ€</div>
                    <div id="detectionStatus" class="text-lg font-bold text-black">ğŸ”´ ç­‰å¾…ç®¡ç†é¢æ¿å¼€å¯</div>
                </div>
                
                <!-- äº¤æ˜“æ¬¡æ•° -->
                <div class="bg-memePurple border-meme p-6 text-center transform hover:scale-105 transition-all duration-300 glow">
                    <div class="text-3xl mb-2">ğŸ“Š</div>
                    <div class="text-xl font-bold text-white mb-2">äº¤æ˜“æ¬¡æ•°</div>
                    <div id="transactionCount" class="text-2xl font-bold text-white">0</div>
                </div>
                
                <!-- å€’è®¡æ—¶è°ƒæ•´ -->
                <div class="bg-memePink border-meme p-6 text-center transform hover:scale-105 transition-all duration-300 glow">
                    <div class="text-3xl mb-2">â°</div>
                    <div class="text-xl font-bold text-black mb-2">å€’è®¡æ—¶è°ƒæ•´</div>
                    <div id="timeAdjustment" class="text-lg font-bold text-black">+0 ç§’</div>
                </div>
                
                <!-- RPCçŠ¶æ€ -->
                <div class="bg-memeYellow border-meme p-6 text-center transform hover:scale-105 transition-all duration-300 glow">
                    <div class="text-3xl mb-2">ğŸŒ</div>
                    <div class="text-xl font-bold text-black mb-2">RPCçŠ¶æ€</div>
                    <div id="rpcStatus" class="text-lg font-bold text-black">æœªé€‰æ‹©</div>
                </div>
            </div>
            

            
            <!-- äº¤æ˜“æ—¥å¿— -->
            <div class="bg-gray-700 border-meme p-4 max-h-60 overflow-y-auto">
                <h3 class="text-memeYellow font-bold mb-3">ğŸ“ äº¤æ˜“æ—¥å¿—</h3>
                <div id="transactionLog" class="text-sm text-gray-300 space-y-2">
                    <div class="text-gray-500 italic">ç­‰å¾…äº¤æ˜“æ£€æµ‹...</div>
                </div>
            </div>
            
            <!-- è¯¦ç»†äº¤æ˜“è®°å½•è¡¨æ ¼ -->
            <div class="bg-gray-700 border-meme p-4 mt-4 max-h-80 overflow-y-auto">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="text-memeYellow font-bold">ğŸ“Š è¯¦ç»†äº¤æ˜“è®°å½•</h3>
                    <div class="flex items-center gap-2">
                        <span id="detailedCount" class="text-xs text-memeYellow font-bold">0 æ¡è®°å½•</span>
                        <div id="syncIndicator" class="w-2 h-2 bg-gray-500 rounded-full"></div>
                        <span id="syncStatus" class="text-xs text-gray-400">ç­‰å¾…åŒæ­¥...</span>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-xs">
                        <thead>
                            <tr class="text-memeBlue border-b border-gray-600">
                                <th class="text-left p-2">æ—¶é—´</th>
                                <th class="text-left p-2">ç±»å‹</th>
                                <th class="text-left p-2">æ•°é‡</th>
                                <th class="text-left p-2">äº¤æ˜“è€…</th>
                                <th class="text-left p-2">äº¤æ˜“å“ˆå¸Œ</th>
                            </tr>
                        </thead>
                        <tbody id="detailedTransactionTable">
                            <tr>
                                <td colspan="6" class="text-center text-gray-500 italic p-4">æš‚æ— äº¤æ˜“è®°å½•</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- å·¦ä¾§æˆåŠŸå¢åŠ å€’è®¡æ—¶åœ°å€åŒºåŸŸ -->
        <div id="successAddressesPanel" class="fixed top-32 left-4 w-80 bg-gray-800 border-meme p-4 rounded-xl shadow-lg z-50 max-h-[70vh] overflow-y-auto">
            <h3 class="text-memeYellow font-bold text-lg mb-3">ğŸ’° æˆåŠŸå¢åŠ å€’è®¡æ—¶åœ°å€</h3>
            <ul id="successAddressesList" class="space-y-2">
                <li class="text-gray-400 text-sm italic">ç­‰å¾…å¤§é¢ä¹°å…¥...</li>
                <li class="text-gray-400 text-sm italic">ç­‰å¾…å¤§é¢ä¹°å…¥...</li>
                <li class="text-gray-400 text-sm italic">ç­‰å¾…å¤§é¢ä¹°å…¥...</li>
                <li class="text-gray-400 text-sm italic">ç­‰å¾…å¤§é¢ä¹°å…¥...</li>
                <li class="text-gray-400 text-sm italic">ç­‰å¾…å¤§é¢ä¹°å…¥...</li>
            </ul>
        </div>
        
        <!-- å³ä¸Šè§’æ–°å¢åŒºåŸŸ -->
        <div id="topRightPanel" class="fixed top-4 right-4 w-80 bg-gray-800 border-meme p-4 rounded-xl shadow-lg z-50 max-h-[40vh] overflow-y-auto">
            <h3 class="text-memeYellow font-bold text-lg mb-3">ğŸ”— é’±åŒ…è¿æ¥</h3>
            
            <!-- é’±åŒ…è¿æ¥æŒ‰é’® -->
            <button id="walletConnectBtn" class="w-full bg-memeBlue hover:bg-blue-600 text-white font-bold py-2 px-4 rounded border-meme transition-all duration-300 mb-3">
                <span class="text-white">ğŸ”— è¿æ¥é’±åŒ…</span>
            </button>
            
            <!-- é’±åŒ…çŠ¶æ€æ˜¾ç¤º -->
            <div id="walletStatus" class="text-gray-400 text-sm mb-3">
                <span class="font-bold">æœªè¿æ¥</span>
            </div>
            
            <!-- æŒä»“å¥–åŠ±å€’è®¡æ—¶æ˜¾ç¤º -->
            <div class="bg-gray-700 border-meme p-3 rounded-lg mb-3">
                <div class="text-center">
                    <div class="text-memeYellow font-bold text-sm mb-1">ğŸ† æŒä»“å¥–åŠ±å€’è®¡æ—¶</div>
                    <div id="holderRewardCountdown" class="text-xl font-bold text-memePink">20:00</div>
                    <div class="text-gray-300 text-xs">æ¯3åˆ†é’Ÿå¿«ç…§ä¸€æ¬¡ï¼ˆæµ‹è¯•ï¼‰</div>
                </div>
            </div>
            
            <!-- åŠŸèƒ½æŒ‰é’®åŒºåŸŸ -->
            <div class="space-y-3">
                <!-- ç™½çš®ä¹¦æŒ‰é’® -->
                <button id="whitepaperBtn" class="w-full bg-memeGreen hover:bg-green-600 text-white font-bold py-2 px-4 rounded border-meme transition-all duration-300">
                    <span class="text-white">ğŸ“„ ç™½çš®ä¹¦</span>
                </button>
                
                <!-- é¢†å–å¥–åŠ±æŒ‰é’® -->
                <button id="claimRewardBtn" class="w-full bg-memePink hover:bg-pink-600 text-white font-bold py-2 px-4 rounded border-meme transition-all duration-300">
                    <span class="text-white">ğŸ é¢†å–å¥–åŠ±</span>
                </button>
            </div>
        </div>
        
        <!-- é¢†å–å¥–åŠ±é¡µé¢ -->
        <div id="rewardPage" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] hidden">
            <div class="bg-gray-800 border-meme p-6 rounded-xl shadow-lg w-[90vw] max-w-4xl max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-memeYellow font-bold text-2xl">ğŸ é¢†å–å¥–åŠ±</h3>
                    <button onclick="hideRewardPage()" class="text-gray-400 hover:text-white text-3xl">&times;</button>
                </div>
                
                <!-- å¥–åŠ±ä¿¡æ¯å±•ç¤ºåŒºåŸŸ -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <!-- æŒä»“å‰20æŒæœ‰è€…å¥–åŠ± -->
                    <div class="bg-gray-700 border-meme p-4 rounded-lg">
                        <div class="flex items-center mb-3">
                            <span class="text-2xl mr-2">ğŸ†</span>
                            <h4 class="text-memeYellow font-bold text-lg">æŒä»“å‰20æŒæœ‰è€…å¥–åŠ±</h4>
                        </div>
                        <div class="text-gray-300 text-sm mb-3">
                            <p>æŒæœ‰ä»£å¸æ•°é‡æ’åå‰20çš„åœ°å€ï¼Œæ¯äººå¯è·å¾—ç‰¹æ®Šå¥–åŠ±ï¼ˆæ¯3åˆ†é’Ÿå¿«ç…§ä¸€æ¬¡ï¼Œå¯éšæ—¶é¢†å–ï¼‰</p>
                        </div>
                        <div class="bg-gray-600 p-3 rounded mb-3">
                            <div class="text-memePink font-bold mb-2">å½“å‰çŠ¶æ€ï¼š</div>
                            <div id="top20Status" class="text-gray-300 text-sm">
                                <span class="text-yellow-400">â³ ç­‰å¾…æŒä»“æ•°æ®...</span>
                            </div>
                        </div>
                        <button id="claimTop20Btn" class="w-full bg-memeGreen hover:bg-green-600 text-white font-bold py-3 px-4 rounded border-meme transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
                            <span class="text-white">ğŸ† é¢†å–å‰20åå¥–åŠ±</span>
                        </button>
                    </div>
                    
                    <!-- æœ€åæˆåŠŸå¢åŠ å€’è®¡æ—¶åœ°å€å¥–åŠ± -->
                    <div class="bg-gray-700 border-meme p-4 rounded-lg">
                        <div class="flex items-center mb-3">
                            <span class="text-2xl mr-2">ğŸ’°</span>
                            <h4 class="text-memeYellow font-bold text-lg">æœ€åå€’è®¡æ—¶å¥–åŠ±</h4>
                        </div>
                        <div class="text-gray-300 text-sm mb-3">
                            <p>æœ€åä¸€ä¸ªæˆåŠŸå¢åŠ å€’è®¡æ—¶æ—¶é—´çš„åœ°å€å¯è·å¾—é¢å¤–å¥–åŠ±ï¼ˆå¯éšæ—¶é¢†å–ï¼‰</p>
                        </div>
                        <div class="bg-gray-600 p-3 rounded mb-3">
                            <div class="text-memePink font-bold mb-2">å½“å‰çŠ¶æ€ï¼š</div>
                            <div id="lastSuccessStatus" class="text-gray-300 text-sm">
                                <span class="text-yellow-400">â³ ç­‰å¾…å¤§é¢ä¹°å…¥æ•°æ®...</span>
                            </div>
                        </div>
                        <button id="claimLastSuccessBtn" class="w-full bg-memePink hover:bg-pink-600 text-white font-bold py-3 px-4 rounded border-meme transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
                            <span class="text-white">ğŸ’° é¢†å–æœ€åå€’è®¡æ—¶å¥–åŠ±</span>
                        </button>
                    </div>
                </div>
                
                <!-- åœ°å€éªŒè¯åŒºåŸŸ -->
                <div class="bg-gray-700 border-meme p-4 rounded-lg mb-6">
                    <div class="flex items-center mb-3">
                        <span class="text-2xl mr-2">ğŸ”</span>
                        <h4 class="text-memeYellow font-bold text-lg">åœ°å€éªŒè¯</h4>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-gray-300 text-sm mb-2">è¾“å…¥é’±åŒ…åœ°å€</label>
                            <input type="text" id="verifyAddressInput" placeholder="è¾“å…¥è¦éªŒè¯çš„é’±åŒ…åœ°å€" class="w-full p-3 bg-gray-600 border-2 border-gray-500 rounded-lg text-white placeholder-gray-400 focus:border-memeYellow focus:outline-none">
                        </div>
                        <div class="flex items-end">
                            <button id="verifyAddressBtn" class="w-full bg-memeBlue hover:bg-blue-600 text-white font-bold py-3 px-4 rounded border-meme transition-all duration-300">
                                <span class="text-white">ğŸ” éªŒè¯åœ°å€</span>
                            </button>
                        </div>
                        <div class="flex items-end">
                            <div id="verifyResult" class="w-full p-3 bg-gray-600 rounded-lg text-sm">
                                <span class="text-gray-400">ç­‰å¾…éªŒè¯...</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- å¥–åŠ±è¯¦æƒ…å±•ç¤º -->
                <div class="bg-gray-700 border-meme p-4 rounded-lg mb-6">
                    <div class="flex items-center mb-3">
                        <span class="text-2xl mr-2">ğŸ“Š</span>
                        <h4 class="text-memeYellow font-bold text-lg">å¥–åŠ±è¯¦æƒ…</h4>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <h5 class="text-memePink font-bold mb-2">æŒä»“å‰20æŒæœ‰è€…</h5>
                            <div id="top20Details" class="text-gray-300 text-sm space-y-1">
                                <div>â€¢ æ€»æŒæœ‰è€…æ•°é‡ï¼š<span id="totalHolders">-</span></div>
                                <div>â€¢ å‰20åæ•°é‡ï¼š<span id="top20Count">20</span></div>
                                <div>â€¢ æ¯äººå¥–åŠ±ä»£å¸æ•°é‡ï¼š<span id="top20Reward">-</span></div>
                            </div>
                        </div>
                        <div>
                            <h5 class="text-memePink font-bold mb-2">æœ€åå€’è®¡æ—¶åœ°å€</h5>
                            <div id="lastSuccessDetails" class="text-gray-300 text-sm space-y-1">
                                <div>â€¢ åœ°å€ï¼š<span id="lastSuccessAddress">-</span></div>
                                <div>â€¢ ä¹°å…¥æ•°é‡ï¼š<span id="lastSuccessAmount">-</span></div>
                                <div>â€¢ å¥–åŠ±ä»£å¸æ•°é‡ï¼š<span id="lastSuccessReward">-</span></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- å†å²è·å¥–è½®æ¬¡åˆ—è¡¨ -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- æŒä»“å¥–åŠ±å†å²è½®æ¬¡ -->
                    <div class="bg-gray-700 border-meme p-4 rounded-lg">
                        <div class="flex items-center mb-3">
                            <span class="text-2xl mr-2">ğŸ†</span>
                            <h4 class="text-memeYellow font-bold text-lg">æŒä»“å¥–åŠ±å†å²</h4>
                        </div>
                        <div class="bg-gray-600 p-4 rounded max-h-60 overflow-y-auto">
                            <div id="holderRewardRoundsList" class="text-sm text-gray-300">
                                <div class="text-center text-gray-400">åŠ è½½æŒä»“å¥–åŠ±å†å²...</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- å€’è®¡æ—¶å¥–åŠ±å†å²è½®æ¬¡ -->
                    <div class="bg-gray-700 border-meme p-4 rounded-lg">
                        <div class="flex items-center mb-3">
                            <span class="text-2xl mr-2">âš¡</span>
                            <h4 class="text-memeYellow font-bold text-lg">å€’è®¡æ—¶å¥–åŠ±å†å²</h4>
                        </div>
                        <div class="bg-gray-600 p-4 rounded max-h-60 overflow-y-auto">
                            <div id="countdownRewardRoundsList" class="text-sm text-gray-300">
                                <div class="text-center text-gray-400">åŠ è½½å€’è®¡æ—¶å¥–åŠ±å†å²...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- é’±åŒ…é€‰æ‹©æ¨¡æ€æ¡† -->
        <div id="walletModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] hidden">
            <div class="bg-gray-800 border-meme p-6 rounded-xl shadow-lg w-96 max-w-[90vw]">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-memeYellow font-bold text-xl">é€‰æ‹©é’±åŒ…</h3>
                    <button onclick="window.walletManager.hideWalletModal()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
                </div>
                
                <div class="space-y-3">
                    <!-- OKXé’±åŒ… -->
                    <button onclick="window.walletManager.connectWallet('okx')" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded border-meme transition-all duration-300 flex items-center justify-between">
                        <div class="flex items-center">
                            <span class="text-2xl mr-3">ğŸ”µ</span>
                            <div class="text-left">
                                <div class="font-bold">OKX Wallet</div>
                                <div class="text-sm opacity-75">OKXäº¤æ˜“æ‰€é’±åŒ…</div>
                            </div>
                        </div>
                        <span class="text-lg">â†’</span>
                    </button>
                    
                    <!-- Phantomé’±åŒ… -->
                    <button onclick="window.walletManager.connectWallet('phantom')" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded border-meme transition-all duration-300 flex items-center justify-between">
                        <div class="flex items-center">
                            <span class="text-2xl mr-3">ğŸ‘»</span>
                            <div class="text-left">
                                <div class="font-bold">Phantom Wallet</div>
                                <div class="text-sm opacity-75">å¹½çµé’±åŒ…</div>
                            </div>
                        </div>
                        <span class="text-lg">â†’</span>
                    </button>
                    
                    <!-- Coinbaseé’±åŒ… -->
                    <button onclick="window.walletManager.connectWallet('coinbase')" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-3 px-4 rounded border-meme transition-all duration-300 flex items-center justify-between">
                        <div class="flex items-center">
                            <span class="text-2xl mr-3">ğŸŸ¡</span>
                            <div class="text-left">
                                <div class="font-bold">Coinbase Wallet</div>
                                <div class="text-sm opacity-75">Coinbaseé’±åŒ…</div>
                            </div>
                        </div>
                        <span class="text-lg">â†’</span>
                    </button>
                </div>
                
                <div class="mt-4 text-center">
                    <p class="text-gray-400 text-sm">
                        è¯·ç¡®ä¿å·²å®‰è£…ç›¸åº”çš„é’±åŒ…æ‰©å±•
                    </p>
                </div>
            </div>
        </div>
        
        <!-- å³ä¾§æŒä»“å‰20æŒæœ‰è€…åŒºåŸŸ -->
        <div id="topHoldersPanel" class="fixed bottom-4 right-4 w-80 bg-gray-800 border-meme p-3 rounded-xl shadow-lg z-50 max-h-[45vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-2">
                <h3 class="text-memeYellow font-bold text-base">ğŸ† æŒä»“å‰20æŒæœ‰è€…</h3>
                <div class="flex items-center gap-1">
                    <div id="holdersRefreshCountdown" class="text-memePink font-bold text-xs">10</div>
                    <span class="text-gray-400 text-xs">ç§’ååˆ·æ–°</span>
                </div>
            </div>
            <ul id="topHoldersList" class="space-y-1 text-xs">
                <li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>
                <li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>
                <li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>
                <li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>
                <li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>
                <li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>
                <li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>
                <li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>
                <li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>
                <li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>
                <li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>
                <li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>
                <li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>
                <li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>
                <li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>
                <li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>
                <li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>
                <li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>
            </ul>
        </div>
        
        <!-- ä¿¡æ¯åŒºåŸŸ -->
        <div class="max-w-3xl mx-auto text-center mt-12">
            <div class="bg-gray-800 border-meme p-6 rotate-random">
                <h3 class="text-2xl md:text-3xl text-memeYellow mb-4">Why This Meme Coin?</h3>
                <p class="text-white text-lg mb-4">Because why not? It's a meme coin, just like all the others, but <span class="text-memePink font-bold">this one is going to the moon!</span></p>
                <button class="bg-memePink hover:bg-pink-600 text-white font-bold py-3 px-8 border-meme transform hover:rotate-1 transition-all duration-300 mt-2">
                    BUY NOW BEFORE IT'S TOO LATE!
                </button>
            </div>
            
            <!-- ç¤¾äº¤åª’ä½“åˆ†äº« -->
            <div class="mt-10">
                <p class="text-white text-xl mb-4">SHARE THE HYPE!</p>
                <div class="flex justify-center gap-4">
                    <a href="#" class="bg-blue-500 hover:bg-blue-600 text-white w-12 h-12 rounded-full flex items-center justify-center border-meme transform hover:scale-110 transition-all">
                        <i class="fa fa-twitter text-2xl"></i>
                    </a>
                    <a href="#" class="bg-blue-700 hover:bg-blue-800 text-white w-12 h-12 rounded-full flex items-center justify-center border-meme transform hover:scale-110 transition-all">
                        <i class="fa fa-facebook text-2xl"></i>
                    </a>
                    <a href="#" class="bg-pink-600 hover:bg-pink-700 text-white w-12 h-12 rounded-full flex items-center justify-center border-meme transform hover:scale-110 transition-all">
                        <i class="fa fa-instagram text-2xl"></i>
                    </a>
                    <a href="#" class="bg-gray-800 hover:bg-gray-700 text-white w-12 h-12 rounded-full flex items-center justify-center border-meme transform hover:scale-110 transition-all">
                        <i class="fa fa-telegram text-2xl"></i>
                    </a>
                </div>
            </div>
        </div>
        
        <!-- é¡µè„š -->
        <footer class="mt-20 text-center text-gray-500 text-sm">
            <p>Disclaimer: This is a meme website. Not financial advice. Don't actually invest your life savings.</p>
            <p class="mt-2">ğŸš€ To the moon and beyond! ğŸš€</p>
        </footer>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-functions-compat.js"></script>
    
    <!-- é’±åŒ…è¿æ¥ç®¡ç†å™¨ -->
    <script src="wallet-connect.js"></script>
    <script>
        // Firebaseé…ç½®
        const firebaseConfig = {
            apiKey: "AIzaSyA5Z5ieEbAcfQX0kxGSn9ldGXhzvAwx_8M",
            authDomain: "chat-294cc.firebaseapp.com",
            databaseURL: "https://chat-294cc-default-rtdb.firebaseio.com",
            projectId: "chat-294cc",
            storageBucket: "chat-294cc.firebasestorage.app",
            messagingSenderId: "913615304269",
            appId: "1:913615304269:web:0274ffaccb8e6b678e4e04",
            measurementId: "G-SJR9NDW86B"
        };

        // åˆå§‹åŒ–Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // Solanaå®æ—¶äº¤æ˜“æ£€æµ‹å™¨ç±»
        class SolanaTransactionTracker {
            constructor() {
                // å€’è®¡æ—¶ç›¸å…³å˜é‡
                this.countdownDate = new Date();
                this.countdownDate.setMinutes(this.countdownDate.getMinutes() + 5);
                this.originalCountdownDate = new Date(this.countdownDate);
                this.totalTimeAdjustment = 0;
                this.transactionCount = 0;
                this.countdownInterval = null;
                
                // æŒä»“å¥–åŠ±å€’è®¡æ—¶ç›¸å…³å˜é‡
                this.holderRewardDate = new Date();
                this.holderRewardDate.setMinutes(this.holderRewardDate.getMinutes() + 3); // æ”¹ä¸º3åˆ†é’Ÿæµ‹è¯•
                this.holderRewardInterval = null;
                
                // äº¤æ˜“æ£€æµ‹ç›¸å…³å˜é‡
                this.isMonitoring = false;
                this.monitoringInterval = null;
                this.lastSignature = null;
                this.transactions = [];
                this.currentEndpointIndex = 0;
                
                // RPCé…ç½®
                this.rpcEndpoints = [
                    'https://small-holy-forest.solana-mainnet.quiknode.pro/b59315ea187b3de1b3542c5c25d7f2d5b5410ff4/',
                    'https://api.mainnet-beta.solana.com',
                    'https://solana-api.projectserum.com'
                ];
                
                // åˆå§‹åŒ–
                this.init();
            }
            
            init() {
                // åˆå§‹æ›´æ–°å€’è®¡æ—¶
                this.updateCountdown();
                this.updateHolderRewardCountdown();
                
                // å¯åŠ¨å€’è®¡æ—¶æ›´æ–°
                this.startCountdownUpdate();
                this.startHolderRewardCountdownUpdate();
                
                // ç»‘å®šäº‹ä»¶
                this.bindEvents();
                
                // ä»FirebaseåŠ è½½æ¸¸æˆæ•°æ®
                this.loadGameDataFromFirebase();
            }
            
            // å¯åŠ¨å€’è®¡æ—¶æ›´æ–°
            startCountdownUpdate() {
                // æ¸…é™¤å¯èƒ½å­˜åœ¨çš„æ—§å®šæ—¶å™¨
                if (this.countdownInterval) {
                    clearInterval(this.countdownInterval);
                }
                
                // å¯åŠ¨æ–°çš„å€’è®¡æ—¶æ›´æ–°
                this.countdownInterval = setInterval(() => {
                    this.updateCountdown();
                }, 1000);
            }
            
            // å¯åŠ¨æŒä»“å¥–åŠ±å€’è®¡æ—¶æ›´æ–°
            startHolderRewardCountdownUpdate() {
                // æ¸…é™¤å¯èƒ½å­˜åœ¨çš„æ—§å®šæ—¶å™¨
                if (this.holderRewardInterval) {
                    clearInterval(this.holderRewardInterval);
                }
                
                // å¯åŠ¨æ–°çš„æŒä»“å¥–åŠ±å€’è®¡æ—¶æ›´æ–°
                this.holderRewardInterval = setInterval(() => {
                    this.updateHolderRewardCountdown();
                }, 1000);
            }
            
            bindEvents() {
                // ç›‘æ§åŠŸèƒ½å·²ç§»è‡³ç®¡ç†é¢æ¿
            }
            
            // æ›´æ–°å€’è®¡æ—¶
            updateCountdown() {
                const now = new Date();
                const timeLeft = this.countdownDate - now;
                
                // è°ƒè¯•ä¿¡æ¯
                console.log('å€’è®¡æ—¶è°ƒè¯•:', {
                    countdownDate: this.countdownDate,
                    now: now,
                    timeLeft: timeLeft,
                    minutes: Math.floor(timeLeft / (1000 * 60)),
                    seconds: Math.floor((timeLeft % (1000 * 60)) / 1000)
                });
                
                // è®¡ç®—å‰©ä½™çš„åˆ†ã€ç§’ï¼Œå¤„ç†è´Ÿæ•°æƒ…å†µ
                const minutes = Math.max(0, Math.floor(timeLeft / (1000 * 60)));
                const seconds = Math.max(0, Math.floor((timeLeft % (1000 * 60)) / 1000));
            
            // æ˜¾ç¤ºå€’è®¡æ—¶ï¼Œç¡®ä¿ä¸¤ä½æ•°æ ¼å¼
            document.getElementById("minutes").innerText = minutes.toString().padStart(2, '0');
            document.getElementById("seconds").innerText = seconds.toString().padStart(2, '0');
            
            // å€’è®¡æ—¶ç»“æŸæ—¶çš„å¤„ç†
            if (timeLeft < 0) {
                console.log('å€’è®¡æ—¶ç»“æŸæ£€æµ‹ï¼štimeLeft =', timeLeft, 'countdownEnded =', gameData.countdownEnded);
                
                // åªåœ¨ç¬¬ä¸€æ¬¡å€’è®¡æ—¶ç»“æŸæ—¶æ˜¾ç¤ºLAUNCHED
                if (!gameData.countdownEnded) {
                    console.log('æ˜¾ç¤ºLAUNCHEDç•Œé¢ï¼Œè°ƒç”¨onCountdownEndedå’ŒpauseGame');
                    
                document.getElementById("countdown").innerHTML = `
                        <div class="col-span-2 text-center">
                        <div class="text-[clamp(2rem,8vw,5rem)] font-bold text-memePink">LAUNCHED!</div>
                        <div class="text-2xl text-white mt-4">TO THE MOON!!! ğŸš€</div>
                    </div>
                `;
                    
                    // å€’è®¡æ—¶ç»“æŸæ—¶è‡ªåŠ¨æ•æ‰æ•°æ®
                    gameData.countdownEnded = true;
                    this.onCountdownEnded();
                    
                    // æ¸¸æˆæš‚åœé€»è¾‘
                    this.pauseGame();
                } else {
                    console.log('å€’è®¡æ—¶å·²ç»“æŸï¼Œä½†countdownEndedä¸ºtrueï¼Œè·³è¿‡å¤„ç†');
                }
            } else {
                // å€’è®¡æ—¶æœªç»“æŸæ—¶ï¼Œç¡®ä¿æ˜¾ç¤ºæ­£å¸¸çš„å€’è®¡æ—¶ç»“æ„
                const countdownElement = document.getElementById("countdown");
                if (countdownElement.innerHTML.includes("LAUNCHED")) {
                    // å¦‚æœå½“å‰æ˜¾ç¤ºçš„æ˜¯LAUNCHEDï¼Œæ¢å¤å€’è®¡æ—¶æ˜¾ç¤ºç»“æ„
                    countdownElement.innerHTML = `
                        <!-- åˆ† -->
                        <div class="bg-memePurple border-meme p-4 text-center transform hover:scale-105 transition-all duration-300 glow">
                            <div id="minutes" class="text-[clamp(2rem,6vw,4rem)] font-bold text-white">00</div>
                            <div class="text-white font-bold">MINUTES</div>
                        </div>
                        
                        <!-- ç§’ -->
                        <div class="bg-memeGreen border-meme p-4 text-center transform hover:scale-105 transition-all duration-300 glow">
                            <div id="seconds" class="text-[clamp(2rem,6vw,4rem)] font-bold text-black">00</div>
                            <div class="text-black font-bold">SECONDS</div>
                        </div>
                    `;
                }
            }
        }
        
        // æ›´æ–°æŒä»“å¥–åŠ±å€’è®¡æ—¶
        updateHolderRewardCountdown() {
            const now = new Date();
            const timeLeft = this.holderRewardDate - now;
            
            // è®¡ç®—å‰©ä½™çš„åˆ†ã€ç§’ï¼Œå¤„ç†è´Ÿæ•°æƒ…å†µ
            const minutes = Math.max(0, Math.floor(timeLeft / (1000 * 60)));
            const seconds = Math.max(0, Math.floor((timeLeft % (1000 * 60)) / 1000));
            
            // æ˜¾ç¤ºæŒä»“å¥–åŠ±å€’è®¡æ—¶
            const holderRewardElement = document.getElementById('holderRewardCountdown');
            if (holderRewardElement) {
                holderRewardElement.innerText = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
            
            // æŒä»“å¥–åŠ±å€’è®¡æ—¶ç»“æŸæ—¶çš„å¤„ç†
            if (timeLeft < 0) {
                if (!gameData.holderRewardEnded) {
                    console.log('æŒä»“å¥–åŠ±å€’è®¡æ—¶ç»“æŸï¼Œå¼€å§‹å¿«ç…§...');
                    gameData.holderRewardEnded = true;
                    this.onHolderRewardEnded();
                    
                    // é‡ç½®æŒä»“å¥–åŠ±å€’è®¡æ—¶ä¸º3åˆ†é’Ÿï¼ˆæµ‹è¯•ç”¨ï¼‰
                    this.holderRewardDate = new Date(Date.now() + 3 * 60 * 1000);
                    gameData.holderRewardEnded = false;
                    console.log('æŒä»“å¥–åŠ±å€’è®¡æ—¶å·²é‡ç½®ä¸º3åˆ†é’Ÿ');
                }
            }
        }
        
            // å¼€å§‹ç›‘æ§
            async startMonitoring() {
                const tokenAddress = document.getElementById('tokenAddress').value.trim();
                
                if (!tokenAddress) {
                    alert('è¯·è¾“å…¥ä»£å¸åœ°å€');
                    return;
                }
                
                if (this.isMonitoring) return;
                
                this.isMonitoring = true;
                document.getElementById('detectionStatus').innerHTML = 'ğŸŸ¢ ç›‘æ§ä¸­...';
                
                this.addLogEntry('ğŸš€ Solanaäº¤æ˜“ç›‘æ§å·²å¯åŠ¨', 'info');
                this.updateSyncStatus('syncing', 'å¯åŠ¨ç›‘æ§...');
                
                // å¯åŠ¨æŒä»“è€…è‡ªåŠ¨åˆ·æ–°
                startTopHoldersAutoRefresh(tokenAddress);
                
                // ç«‹å³è·å–ä¸€æ¬¡äº¤æ˜“è®°å½•
                await this.fetchLatestTransactions(tokenAddress);
                
                // å¼€å§‹å®šæ—¶ç›‘æ§
                this.monitoringInterval = setInterval(async () => {
                    if (this.isMonitoring) {
                        await this.fetchLatestTransactions(tokenAddress);
                    }
                }, 3000); // æ¯3ç§’æ£€æŸ¥ä¸€æ¬¡
            }
            
            // åœæ­¢ç›‘æ§
            stopMonitoring() {
                if (!this.isMonitoring) return;
                
                this.isMonitoring = false;
                document.getElementById('detectionStatus').innerHTML = 'ğŸ”´ å·²åœæ­¢';
                
                if (this.monitoringInterval) {
                    clearInterval(this.monitoringInterval);
                    this.monitoringInterval = null;
                }
                
                // åœæ­¢æŒä»“è€…è‡ªåŠ¨åˆ·æ–°
                stopTopHoldersAutoRefresh();
                
                this.addLogEntry('â¹ï¸ Solanaäº¤æ˜“ç›‘æ§å·²åœæ­¢', 'warning');
                this.updateSyncStatus('default', 'ç›‘æ§å·²åœæ­¢');
            }
            
            // æ¢å¤æ¸¸æˆ
            resumeGame() {
                gameData.isPaused = false;
                gameData.isMonitoring = true;
                this.isMonitoring = true;
                this.startMonitoring();
                this.addLogEntry('â–¶ï¸ æ¸¸æˆå·²æ¢å¤', 'success');
                console.log('æ¸¸æˆå·²æ¢å¤');
            }
            
            // è·å–æœ€æ–°äº¤æ˜“
            async fetchLatestTransactions(tokenAddress) {
                try {
                    this.updateSyncStatus('syncing', 'æ£€æŸ¥æ–°äº¤æ˜“...');
                    
                    const signatures = await this.makeRpcCall('getSignaturesForAddress', [
                        tokenAddress,
                        { limit: 10 }
                    ]);
                    
                    if (!signatures || signatures.length === 0) {
                        this.updateSyncStatus('success', 'æ— æ–°äº¤æ˜“');
                        return;
                    }
                    
                    // æ£€æŸ¥æ˜¯å¦æœ‰æ–°äº¤æ˜“
                    const latestSignature = signatures[0].signature;
                    if (this.lastSignature && this.lastSignature === latestSignature) {
                        this.updateSyncStatus('success', 'æ— æ–°äº¤æ˜“');
                        return; // æ²¡æœ‰æ–°äº¤æ˜“
                    }
                    
                    // è·å–æ–°äº¤æ˜“
                    const newTransactions = [];
                    for (let i = 0; i < signatures.length; i++) {
                        const sig = signatures[i];
                        if (this.lastSignature && sig.signature === this.lastSignature) {
                            break; // å·²ç»å¤„ç†è¿‡çš„äº¤æ˜“
                        }
                        newTransactions.push(sig);
                    }
                    
                    if (newTransactions.length > 0) {
                        console.log(`æ£€æµ‹åˆ° ${newTransactions.length} ç¬”æ–°äº¤æ˜“`);
                        this.addLogEntry(`ğŸ” æ£€æµ‹åˆ° ${newTransactions.length} ç¬”æ–°äº¤æ˜“`, 'info');
                        this.updateSyncStatus('syncing', `å¤„ç† ${newTransactions.length} ç¬”äº¤æ˜“...`);
                        
                        // è·å–æ–°äº¤æ˜“çš„è¯¦ç»†ä¿¡æ¯
                        const transactionDetails = await this.getTransactionDetails(newTransactions, tokenAddress);
                        
                        // æ·»åŠ åˆ°äº¤æ˜“åˆ—è¡¨
                        this.transactions.unshift(...transactionDetails);
                        
                        // ä¿æŒæœ€å¤š100æ¡è®°å½•
                        if (this.transactions.length > 100) {
                            this.transactions = this.transactions.slice(0, 100);
                        }
                        
                        // å¤„ç†æ¯ä¸ªæ–°äº¤æ˜“
                        for (const tx of transactionDetails) {
                            if (tx) {
                                console.log('å¤„ç†äº¤æ˜“:', tx);
                                this.processTransaction(tx);
                            }
                        }
                        
                        this.lastSignature = latestSignature;
                        this.updateTransactionsDisplay();
                        this.updateSyncStatus('success', `å·²åŒæ­¥ ${newTransactions.length} ç¬”äº¤æ˜“`);
                    } else {
                        this.updateSyncStatus('success', 'æ— æ–°äº¤æ˜“');
                    }
                    
                } catch (error) {
                    console.error('è·å–äº¤æ˜“å¤±è´¥:', error);
                    document.getElementById('detectionStatus').innerHTML = 'ğŸ”´ è¿æ¥é”™è¯¯';
                    this.addLogEntry(`âŒ è·å–äº¤æ˜“å¤±è´¥: ${error.message}`, 'error');
                    this.updateSyncStatus('error', 'åŒæ­¥å¤±è´¥');
                }
            }
            
            // è·å–äº¤æ˜“è¯¦æƒ…
            async getTransactionDetails(signatures, tokenAddress) {
                const details = [];
                
                for (const sig of signatures) {
                    try {
                        const txData = await this.makeRpcCall('getTransaction', [
                            sig.signature,
                            {
                                encoding: 'jsonParsed',
                                maxSupportedTransactionVersion: 0
                            }
                        ]);
                        
                        const transaction = this.parseTransaction(txData, sig, tokenAddress);
                        if (transaction) {
                            details.push(transaction);
                        }
                    } catch (error) {
                        console.warn('è·å–äº¤æ˜“è¯¦æƒ…å¤±è´¥:', error);
                    }
                }
                
                return details;
            }
            
            // è§£æäº¤æ˜“
            parseTransaction(tx, sig, tokenAddress) {
                if (!tx || !tx.meta) {
                    return null;
                }
                
                const tokenInstructions = tx.meta.postTokenBalances || [];
                const preTokenBalances = tx.meta.preTokenBalances || [];
                
                const relevantBalances = tokenInstructions.filter(balance => 
                    balance.mint === tokenAddress
                );
                
                if (relevantBalances.length === 0) {
                    return null;
                }
                
                const balanceChanges = relevantBalances.map(balance => {
                    const preBalance = preTokenBalances.find(pre => 
                        pre.accountIndex === balance.accountIndex && pre.mint === tokenAddress
                    );
                    
                    const preAmount = preBalance ? parseInt(preBalance.uiTokenAmount.amount) : 0;
                    const postAmount = parseInt(balance.uiTokenAmount.amount);
                    const change = postAmount - preAmount;
                    
                    return {
                        account: balance.owner,
                        change: change,
                        amount: Math.abs(change)
                    };
                });
                
                // è·å–æ‰€æœ‰ä»£å¸ä½™é¢å˜åŒ–ï¼Œç”¨äºåˆ†æä¹°å…¥/å–å‡º
                const allBalanceChanges = tokenInstructions.map(balance => {
                    const preBalance = preTokenBalances.find(pre => 
                        pre.accountIndex === balance.accountIndex && pre.mint === balance.mint
                    );
                    
                    const preAmount = preBalance ? parseInt(preBalance.uiTokenAmount.amount) : 0;
                    const postAmount = parseInt(balance.uiTokenAmount.amount);
                    const change = postAmount - preAmount;
                    
                    return {
                        account: balance.owner,
                        mint: balance.mint,
                        change: change,
                        amount: Math.abs(change)
                    };
                });
                
                return {
                    signature: sig.signature,
                    blockTime: sig.blockTime,
                    amount: balanceChanges[0]?.amount || 0,
                    type: this.determineTransactionType(balanceChanges),
                    src: balanceChanges.find(b => b.change < 0)?.account || 'N/A',
                    dst: balanceChanges.find(b => b.change > 0)?.account || 'N/A',
                    allBalanceChanges: allBalanceChanges // æ·»åŠ æ‰€æœ‰ä½™é¢å˜åŒ–ä¿¡æ¯
                };
            }
            
            // ç¡®å®šäº¤æ˜“ç±»å‹
            determineTransactionType(balanceChanges) {
                if (balanceChanges.length === 0) return 'è½¬ç§»';
                
                const hasMint = balanceChanges.some(b => b.change > 0 && b.account === '11111111111111111111111111111111');
                const hasBurn = balanceChanges.some(b => b.change < 0 && b.account === '11111111111111111111111111111111');
                
                if (hasMint) return 'é“¸é€ ';
                if (hasBurn) return 'é”€æ¯';
                return 'è½¬ç§»';
            }
            
            // å¤„ç†äº¤æ˜“
            processTransaction(tx) {
                const tradeType = this.determineTradeType(tx);
                const timeToAdd = 60; // æ¯æ¬¡ä¹°å…¥äº¤æ˜“å¢åŠ 60ç§’
                const amount = this.formatNumber(tx.amount, 9);
                this.transactionCount++;

                        // æ¸¸æˆé€»è¾‘ï¼šæ£€æŸ¥æ˜¯å¦è¾¾åˆ°100000æ•°é‡é˜ˆå€¼å¹¶å¢åŠ å€’è®¡æ—¶
        if (tradeType === 'ä¹°å…¥') {
            // æ£€æŸ¥æ˜¯å¦è¾¾åˆ°100000æ•°é‡é˜ˆå€¼
            if (tx.amount >= 100000) {
                // æ£€æŸ¥æ˜¯å¦è¶…è¿‡10åˆ†é’Ÿä¸Šé™
                const currentAdjustment = this.totalTimeAdjustment + gameData.countdownIncrement;
                if (currentAdjustment <= gameData.maxCountdown) {
                    this.totalTimeAdjustment = currentAdjustment;
                    this.countdownDate.setTime(this.countdownDate.getTime() + (gameData.countdownIncrement * 1000));
                    
                    // æ›´æ–°æ˜¾ç¤º
                    document.getElementById('transactionCount').innerText = this.transactionCount;
                    document.getElementById('timeAdjustment').innerText = `+${this.totalTimeAdjustment} ç§’`;
                    this.addLogEntry(`ğŸ’° æ£€æµ‹åˆ°å¤§é¢ä¹°å…¥äº¤æ˜“ #${this.transactionCount}ï¼æ•°é‡: ${amount}ï¼Œå€’è®¡æ—¶ +${gameData.countdownIncrement}ç§’`, 'success');
                    
                    // è®°å½•æˆåŠŸå¢åŠ å€’è®¡æ—¶çš„åœ°å€
                    addSuccessAddress(tx.dst, amount, tx.blockTime);
                    
                    // æ›´æ–°æ¸¸æˆæ•°æ®ä¸­çš„æœ€åå¤§é¢ä¹°å…¥åœ°å€
                    gameData.lastBigBuyAddress = tx.dst;
                    gameData.lastBigBuyAmount = tx.amount;
                    
                    // ä¿å­˜äº¤æ˜“è®°å½•åˆ°Firebase
                    this.saveTransactionToFirebase(tx);
                    
                    // æ·»åŠ è§†è§‰åé¦ˆ
                    document.getElementById('timeAdjustment').classList.add('animate-pulse');
                    setTimeout(() => {
                        document.getElementById('timeAdjustment').classList.remove('animate-pulse');
                    }, 1000);
                } else {
                    this.addLogEntry(`âš ï¸ å¤§é¢ä¹°å…¥äº¤æ˜“ #${this.transactionCount} æ£€æµ‹åˆ°ï¼Œä½†å·²è¾¾åˆ°10åˆ†é’Ÿä¸Šé™ï¼`, 'warning');
                }
            } else {
                // ä¹°å…¥æ•°é‡ä¸è¶³100000ï¼Œåªè®°å½•æ—¥å¿—
                this.addLogEntry(`æ£€æµ‹åˆ°å°é¢ä¹°å…¥äº¤æ˜“ #${this.transactionCount}ï¼Œæ•°é‡: ${amount}ï¼Œæœªè¾¾åˆ°100000é˜ˆå€¼`, 'info');
            }
        } else {
            // éä¹°å…¥äº¤æ˜“åªè®°å½•æ—¥å¿—
            this.addLogEntry(`æ£€æµ‹åˆ°${tradeType}äº¤æ˜“ #${this.transactionCount}ï¼Œæ•°é‡: ${amount}ï¼Œä¸å¢åŠ å€’è®¡æ—¶`, 'info');
        }
            }
            
            // åˆ¤æ–­æ˜¯å¦ä¸ºLPæ± åœ°å€
            isLpAddress(address) {
                if (!address) return false;
                // è¿™é‡Œå¯ä»¥ç»´æŠ¤å¤šä¸ªæ± å­åœ°å€
                const lpAddresses = [
                    'WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh',
                    // æœªæ¥å¯æ‰©å±•æ›´å¤šæ± å­
                ];
                return lpAddresses.includes(address);
            }

            // åªæ ¹æ®LPæ± åˆ¤æ–­ä¹°å…¥/å–å‡º
            determineTradeType(tx) {
                // åªåˆ¤æ–­LPæ± 
                if (tx.type === 'é“¸é€ ') {
                    return 'ä¹°å…¥';
                } else if (tx.type === 'é”€æ¯') {
                    return 'å–å‡º';
                } else if (tx.type === 'è½¬ç§»') {
                    const isSrcLp = this.isLpAddress(tx.src);
                    const isDstLp = this.isLpAddress(tx.dst);
                    if (isSrcLp && !isDstLp) {
                        return 'ä¹°å…¥';
                    } else if (isDstLp && !isSrcLp) {
                        return 'å–å‡º';
                    } else {
                        return 'è½¬ç§»';
                    }
                }
                return 'è½¬ç§»';
            }
            
            // æ›´æ–°äº¤æ˜“æ˜¾ç¤º
            updateTransactionsDisplay() {
                const tbody = document.getElementById('detailedTransactionTable');
                
                if (!tbody) {
                    console.error('æ‰¾ä¸åˆ°è¯¦ç»†äº¤æ˜“è¡¨æ ¼å…ƒç´ ');
                    return;
                }
                
                console.log('æ›´æ–°è¯¦ç»†äº¤æ˜“è¡¨æ ¼ï¼Œè®°å½•æ•°é‡:', this.transactions.length);
                
                // æ›´æ–°è®¡æ•°å™¨
                const detailedCount = document.getElementById('detailedCount');
                if (detailedCount) {
                    detailedCount.textContent = `${this.transactions.length} æ¡è®°å½•`;
                }
                
                if (this.transactions.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" class="text-center text-gray-500 italic p-4">æš‚æ— äº¤æ˜“è®°å½•</td></tr>';
                    return;
                }
                
                tbody.innerHTML = '';
                
                this.transactions.forEach((tx, index) => {
                    const row = document.createElement('tr');
                    // æ–°äº¤æ˜“é«˜äº®æ•ˆæœ
                    if (index < 5) {
                        row.classList.add('bg-green-900', 'bg-opacity-20');
                    }
                    // æ ¹æ®äº¤æ˜“ç±»å‹è®¾ç½®é¢œè‰²
                    let typeClass = 'text-gray-300';
                    const tradeType = this.determineTradeType(tx);
                    if (tradeType === 'ä¹°å…¥') {
                        typeClass = 'text-green-400 font-bold';
                    } else if (tradeType === 'å–å‡º') {
                        typeClass = 'text-red-400 font-bold';
                    } else if (tradeType === 'è½¬ç§»') {
                        typeClass = 'text-blue-400 font-bold';
                    }
                    const timestamp = new Date(tx.blockTime * 1000).toLocaleString('zh-CN');
                    const amount = this.formatNumber(tx.amount, 9);
                    // äº¤æ˜“è€…é€»è¾‘
                    let trader = '';
                    if (tradeType === 'ä¹°å…¥') {
                        trader = tx.dst;
                    } else if (tradeType === 'å–å‡º') {
                        trader = tx.src;
                    } else {
                        trader = tx.src + ' â†’ ' + tx.dst;
                    }
                    row.innerHTML = `
                        <td class="p-2 text-gray-400">${timestamp}</td>
                        <td class="p-2">
                            <span class="${typeClass}">${tradeType}</span>
                        </td>
                        <td class="p-2 text-white font-bold">${amount}</td>
                        <td class="p-2">
                            <span class="text-blue-400 cursor-pointer hover:text-blue-300" onclick="window.open('https://solscan.io/account/${trader}', '_blank')" title="${trader}">
                                ${trader ? trader.substring(0, 6) + '...' + trader.substring(trader.length - 4) : 'N/A'}
                            </span>
                        </td>
                        <td class="p-2">
                            <span class="text-memeYellow cursor-pointer hover:text-yellow-300" onclick="window.open('https://solscan.io/tx/${tx.signature}', '_blank')" title="${tx.signature}">
                                ${tx.signature.substring(0, 6)}...${tx.signature.substring(tx.signature.length - 4)}
                            </span>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
                
                console.log('è¯¦ç»†äº¤æ˜“è¡¨æ ¼æ›´æ–°å®Œæˆ');
            }
            
            // æ ¼å¼åŒ–æ•°å­—
            formatNumber(amount, decimals) {
                if (!amount) return '0';
                const num = parseFloat(amount) / Math.pow(10, decimals || 9);
                return num.toLocaleString('zh-CN', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 6
                });
            }
            
            // RPCè°ƒç”¨
            async makeRpcCall(method, params, endpointIndex = 0) {
                const endpoint = this.rpcEndpoints[endpointIndex];
                
                // æ›´æ–°å½“å‰RPCæ˜¾ç¤º
                this.updateCurrentRpc(endpoint, endpointIndex);
                
                try {
                    const response = await fetch(endpoint, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            jsonrpc: '2.0',
                            id: Math.floor(Math.random() * 1000),
                            method: method,
                            params: params
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const data = await response.json();
                    
                    if (data.error) {
                        throw new Error(`RPC Error: ${data.error.message}`);
                    }
                    
                    // æˆåŠŸä½¿ç”¨å½“å‰RPC
                    this.updateCurrentRpc(endpoint, endpointIndex, true);
                    return data.result;
                } catch (error) {
                    console.warn(`RPCè°ƒç”¨å¤±è´¥ (${endpoint}):`, error);
                    
                    // æ ‡è®°å½“å‰RPCå¤±è´¥
                    this.updateCurrentRpc(endpoint, endpointIndex, false);
                    
                    if (endpointIndex < this.rpcEndpoints.length - 1) {
                        return await this.makeRpcCall(method, params, endpointIndex + 1);
                    }
                    
                    throw error;
                }
            }
            
            // æ›´æ–°RPCçŠ¶æ€
            updateCurrentRpc(endpoint, index, success = null) {
                const rpcNames = ['QuickNode', 'Solanaå®˜æ–¹', 'Project Serum'];
                const rpcName = rpcNames[index] || `RPC ${index + 1}`;
                
                let status = '';
                if (success === true) {
                    status = 'âœ…';
                } else if (success === false) {
                    status = 'âŒ';
                } else {
                    status = 'ğŸ”„';
                }
                
                document.getElementById('rpcStatus').textContent = `${status} ${rpcName}`;
            }
            
            // æ›´æ–°åŒæ­¥çŠ¶æ€
            updateSyncStatus(status, message) {
                const indicator = document.getElementById('syncIndicator');
                const statusText = document.getElementById('syncStatus');
                
                if (!indicator || !statusText) return;
                
                switch (status) {
                    case 'syncing':
                        indicator.className = 'w-2 h-2 bg-yellow-500 rounded-full animate-pulse';
                        statusText.textContent = 'åŒæ­¥ä¸­...';
                        statusText.className = 'text-xs text-yellow-400';
                        break;
                    case 'success':
                        indicator.className = 'w-2 h-2 bg-green-500 rounded-full';
                        statusText.textContent = message || 'åŒæ­¥å®Œæˆ';
                        statusText.className = 'text-xs text-green-400';
                        break;
                    case 'error':
                        indicator.className = 'w-2 h-2 bg-red-500 rounded-full';
                        statusText.textContent = message || 'åŒæ­¥é”™è¯¯';
                        statusText.className = 'text-xs text-red-400';
                        break;
                    default:
                        indicator.className = 'w-2 h-2 bg-gray-500 rounded-full';
                        statusText.textContent = message || 'ç­‰å¾…åŒæ­¥...';
                        statusText.className = 'text-xs text-gray-400';
                }
            }
            
            // æ·»åŠ æ—¥å¿—
            addLogEntry(message, type = 'info') {
                const logContainer = document.getElementById('transactionLog');
                const timestamp = new Date().toLocaleTimeString();
                
                let colorClass = 'text-gray-300';
                if (type === 'success') colorClass = 'text-green-400';
                else if (type === 'warning') colorClass = 'text-yellow-400';
                else if (type === 'error') colorClass = 'text-red-400';
                
                const logEntry = document.createElement('div');
                logEntry.className = colorClass;
                logEntry.innerHTML = `[${timestamp}] ${message}`;
                
                // ç§»é™¤ç­‰å¾…æ¶ˆæ¯
                const waitingMsg = logContainer.querySelector('.text-gray-500');
                if (waitingMsg) {
                    waitingMsg.remove();
                }
                
                logContainer.insertBefore(logEntry, logContainer.firstChild);
                
                // é™åˆ¶æ—¥å¿—æ¡ç›®æ•°é‡ä¸º100æ¡
                while (logContainer.children.length > 100) {
                    logContainer.removeChild(logContainer.lastChild);
                }
            }
            
            // æ¨¡æ‹Ÿäº¤æ˜“åŠŸèƒ½å·²ç§»è‡³ç®¡ç†é¢æ¿
            
            // é‡ç½®å€’è®¡æ—¶åŠŸèƒ½å·²ç§»è‡³ç®¡ç†é¢æ¿
            
            // å€’è®¡æ—¶ç»“æŸæ—¶çš„å¤„ç†
            async onCountdownEnded() {
                this.addLogEntry('ğŸ‰ å€’è®¡æ—¶ç»“æŸï¼å¼€å§‹è‡ªåŠ¨æ•æ‰æ•°æ®...', 'success');
                
                try {
                    // 1. è‡ªåŠ¨è·å–æŒä»“å‰20çš„åœ°å€
                    await this.captureTop20Holders();
                    
                    // 2. è®°å½•æœ€åå¤§é¢ä¹°å…¥åœ°å€
                    this.captureLastBigBuyAddress();
                    
                    // 3. è§¦å‘å¥–åŠ±å‘æ”¾
                    this.triggerRewards();
                    
                    // 4. æ›´æ–°å¥–åŠ±é¡µé¢æ•°æ®
                    this.updateRewardData();
                    
                } catch (error) {
                    this.addLogEntry(`âŒ è‡ªåŠ¨æ•æ‰æ•°æ®å¤±è´¥: ${error.message}`, 'error');
                }
            }
            
            // æŒä»“å¥–åŠ±å€’è®¡æ—¶ç»“æŸæ—¶çš„å¤„ç†
            async onHolderRewardEnded() {
                this.addLogEntry('ğŸ† æŒä»“å¥–åŠ±å¿«ç…§å¼€å§‹ï¼å¼€å§‹æ•æ‰å‰20æŒæœ‰è€…...', 'success');
                
                try {
                    // 1. æ•æ‰å½“å‰æŒä»“å‰20æŒæœ‰è€…
                    await this.captureTop20Holders();
                    
                    // 2. ä¿å­˜æŒä»“å¥–åŠ±è½®æ¬¡
                    this.saveHolderRewardRound();
                    
                    // 3. æ›´æ–°æŒä»“å¥–åŠ±é¡µé¢æ•°æ®
                    this.updateHolderRewardData();
                    
                    // 4. è®°å½•æ—¥å¿—
                    this.addLogEntry('ğŸ† æŒä»“å¥–åŠ±å¿«ç…§å®Œæˆï¼Œå‰20æŒæœ‰è€…å·²è®°å½•ï¼Œå€’è®¡æ—¶å·²é‡ç½®ä¸º3åˆ†é’Ÿ', 'success');
                    
                } catch (error) {
                    this.addLogEntry(`âŒ æŒä»“å¥–åŠ±å¿«ç…§å¤±è´¥: ${error.message}`, 'error');
                }
            }
            
            // è‡ªåŠ¨æ•æ‰æŒä»“å‰20æŒæœ‰è€…
            async captureTop20Holders() {
                const tokenAddress = document.getElementById('tokenAddress').value.trim();
                if (!tokenAddress) {
                    throw new Error('ä»£å¸åœ°å€æœªè®¾ç½®');
                }
                
                try {
                    // ä½¿ç”¨ç°æœ‰çš„fetchTopHoldersé€»è¾‘è·å–å‰20å
                    const data = await this.makeRpcCall('getProgramAccounts', [
                        'TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA',
                        {
                            encoding: 'jsonParsed',
                            filters: [
                                { dataSize: 165 },
                                { memcmp: { offset: 0, bytes: tokenAddress } }
                            ]
                        }
                    ]);
                    
                    if (data && Array.isArray(data) && data.length > 0) {
                        // ç»Ÿè®¡æ‰€æœ‰ownerå’Œä½™é¢ï¼Œæ’é™¤LPæ± å­
                        const holders = {};
                        const lpAddresses = ['WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh'];
                        
                        data.forEach(acc => {
                            const owner = acc.account.data.parsed.info.owner;
                            const amount = parseInt(acc.account.data.parsed.info.tokenAmount.amount);
                            if (lpAddresses.includes(owner)) return;
                            if (!holders[owner]) holders[owner] = 0;
                            holders[owner] += amount;
                        });
                        
                        // æ’åºå–å‰20
                        const sorted = Object.entries(holders)
                            .sort((a, b) => b[1] - a[1])
                            .slice(0, 20);
                        
                        gameData.top20Holders = sorted.map(([address, amount], index) => ({
                            rank: index + 1,
                            address: address,
                            amount: amount
                        }));
                        
                        this.addLogEntry(`ğŸ“Š æˆåŠŸæ•æ‰æŒä»“å‰20æŒæœ‰è€…æ•°æ®ï¼Œå…±${gameData.top20Holders.length}ä¸ªåœ°å€`, 'success');
                        
                        // ä¿å­˜æŒä»“æ•°æ®åˆ°Firebase
                        this.saveHoldersDataToFirebase(gameData.top20Holders);
                    }
                } catch (error) {
                    throw new Error(`è·å–æŒä»“æ•°æ®å¤±è´¥: ${error.message}`);
                }
            }
            
            // æ•æ‰æœ€åå¤§é¢ä¹°å…¥åœ°å€
            captureLastBigBuyAddress() {
                if (gameData.lastBigBuyAddress) {
                    this.addLogEntry(`ğŸ’° æœ€åå¤§é¢ä¹°å…¥åœ°å€: ${gameData.lastBigBuyAddress.substring(0, 6)}...${gameData.lastBigBuyAddress.substring(gameData.lastBigBuyAddress.length - 4)}`, 'success');
                } else {
                    this.addLogEntry('âš ï¸ æœªæ‰¾åˆ°æœ€åå¤§é¢ä¹°å…¥åœ°å€', 'warning');
                }
            }
            
            // è§¦å‘å¥–åŠ±å‘æ”¾
            triggerRewards() {
                const currentTime = Date.now();
                
                // æ£€æŸ¥æ˜¯å¦åˆ°äº†20åˆ†é’Ÿå¥–åŠ±æ—¶é—´
                if (currentTime - gameData.lastRewardTime >= gameData.top20RewardInterval * 1000) {
                    this.distributeTop20Reward();
                    gameData.lastRewardTime = currentTime;
                }
                
                // å‘æ”¾æœ€åå¤§é¢ä¹°å…¥å¥–åŠ±
                this.distributeLastBigBuyReward();
            }
            
            // åˆ†å‘å‰20åå¥–åŠ±
            distributeTop20Reward() {
                if (gameData.top20Holders.length > 0) {
                    const rewardPerHolder = gameData.top20Reward / gameData.top20Holders.length;
                    this.addLogEntry(`ğŸ† å‰20åå¥–åŠ±åˆ†å‘: æ¯äºº${rewardPerHolder.toFixed(3)}%ä»£å¸`, 'success');
                }
            }
            
            // åˆ†å‘æœ€åå¤§é¢ä¹°å…¥å¥–åŠ±
            distributeLastBigBuyReward() {
                if (gameData.lastBigBuyAddress) {
                    this.addLogEntry(`ğŸ’° æœ€åå¤§é¢ä¹°å…¥å¥–åŠ±: ${gameData.lastBigBuyReward}%ä»£å¸å‘æ”¾ç»™${gameData.lastBigBuyAddress.substring(0, 6)}...${gameData.lastBigBuyAddress.substring(gameData.lastBigBuyAddress.length - 4)}`, 'success');
                }
            }
            
            // æ›´æ–°å¥–åŠ±æ•°æ®
            updateRewardData() {
                rewardData.countdownEnded = true;
                rewardData.top20Holders = gameData.top20Holders;
                rewardData.lastSuccessAddress = gameData.lastBigBuyAddress;
                rewardData.lastSuccessAmount = gameData.lastBigBuyAmount;
                
                // ä¿å­˜åˆ°Firebase
                this.saveGameDataToFirebase();
            }
            
            // ä¿å­˜æŒä»“å¥–åŠ±è½®æ¬¡
            saveHolderRewardRound() {
                try {
                    const roundId = `holder_round_${Date.now()}`;
                    const holderRewardData = {
                        roundId: roundId,
                        timestamp: Date.now(),
                        type: 'holder_reward',
                        top20Holders: gameData.top20Holders,
                        tokenAddress: document.getElementById('tokenAddress').value.trim(),
                        isClaimed: false
                    };
                    
                    // ä¿å­˜åˆ°Firebase
                    database.ref('holderRewardRounds').child(roundId).set(holderRewardData)
                        .then(() => {
                            console.log('æŒä»“å¥–åŠ±è½®æ¬¡å·²ä¿å­˜åˆ°Firebaseï¼Œè½®æ¬¡ID:', roundId);
                            this.addLogEntry('ğŸ“Š æŒä»“å¥–åŠ±è½®æ¬¡å·²åŒæ­¥åˆ°äº‘ç«¯', 'success');
                        })
                        .catch((error) => {
                            console.error('ä¿å­˜æŒä»“å¥–åŠ±è½®æ¬¡å¤±è´¥:', error);
                            this.addLogEntry('âŒ æŒä»“å¥–åŠ±è½®æ¬¡åŒæ­¥å¤±è´¥', 'error');
                        });
                } catch (error) {
                    console.error('FirebaseæŒä»“å¥–åŠ±è½®æ¬¡ä¿å­˜é”™è¯¯:', error);
                }
            }
            
            // æ›´æ–°æŒä»“å¥–åŠ±é¡µé¢æ•°æ®
            updateHolderRewardData() {
                // æ›´æ–°æŒä»“å¥–åŠ±ç›¸å…³çš„é¡µé¢æ•°æ®
                if (gameData.top20Holders.length > 0) {
                    // è¿™é‡Œå¯ä»¥æ›´æ–°æŒä»“å¥–åŠ±ç›¸å…³çš„UIå…ƒç´ 
                    console.log('æŒä»“å¥–åŠ±æ•°æ®å·²æ›´æ–°');
                }
            }
            
            // Firebaseæ•°æ®ç®¡ç†
            saveGameDataToFirebase() {
                try {
                    const roundId = `round_${Date.now()}`;
                    const gameDataToSave = {
                        roundId: roundId,
                        timestamp: Date.now(),
                        countdownEnded: gameData.countdownEnded,
                        top20Holders: gameData.top20Holders,
                        lastBigBuyAddress: gameData.lastBigBuyAddress,
                        lastBigBuyAmount: gameData.lastBigBuyAmount,
                        transactionCount: this.transactionCount,
                        totalTimeAdjustment: this.totalTimeAdjustment,
                        successAddresses: successAddresses,
                        tokenAddress: document.getElementById('tokenAddress').value.trim(),
                        isClaimed: false // æ ‡è®°æ˜¯å¦å·²é¢†å–å¥–åŠ±
                    };
                    
                    // ä¿å­˜åˆ°Firebase Realtime Database
                    database.ref('gameRounds').child(roundId).set(gameDataToSave)
                        .then(() => {
                            console.log('æ¸¸æˆæ•°æ®å·²ä¿å­˜åˆ°Firebaseï¼Œè½®æ¬¡ID:', roundId);
                            this.addLogEntry('ğŸ“Š æ¸¸æˆæ•°æ®å·²åŒæ­¥åˆ°äº‘ç«¯', 'success');
                            
                            // ä¿å­˜å½“å‰è½®æ¬¡IDåˆ°æœ¬åœ°
                            this.currentRoundId = roundId;
                        })
                        .catch((error) => {
                            console.error('ä¿å­˜åˆ°Firebaseå¤±è´¥:', error);
                            this.addLogEntry('âŒ äº‘ç«¯åŒæ­¥å¤±è´¥', 'error');
                        });
                } catch (error) {
                    console.error('Firebaseä¿å­˜é”™è¯¯:', error);
                }
            }
            
            // ä»FirebaseåŠ è½½æ¸¸æˆæ•°æ®
            loadGameDataFromFirebase() {
                try {
                    database.ref('gameRounds').orderByChild('timestamp').limitToLast(1).once('value')
                        .then((snapshot) => {
                            if (snapshot.exists()) {
                                const data = Object.values(snapshot.val())[0];
                                this.restoreGameData(data);
                                this.addLogEntry('ğŸ“Š å·²ä»äº‘ç«¯åŠ è½½æ¸¸æˆæ•°æ®', 'success');
                            }
                        })
                        .catch((error) => {
                            console.error('ä»FirebaseåŠ è½½å¤±è´¥:', error);
                            this.addLogEntry('âŒ äº‘ç«¯æ•°æ®åŠ è½½å¤±è´¥', 'error');
                        });
                } catch (error) {
                    console.error('FirebaseåŠ è½½é”™è¯¯:', error);
                }
            }
            
            // è·å–æ‰€æœ‰è·å¥–è½®æ¬¡æ•°æ®
            getAllWinnerRounds() {
                return new Promise((resolve, reject) => {
                    try {
                        database.ref('gameRounds').orderByChild('timestamp').once('value')
                            .then((snapshot) => {
                                if (snapshot.exists()) {
                                    const rounds = [];
                                    snapshot.forEach((childSnapshot) => {
                                        const roundData = childSnapshot.val();
                                        if (roundData.countdownEnded) {
                                            rounds.push(roundData);
                                        }
                                    });
                                    resolve(rounds.reverse()); // æœ€æ–°çš„åœ¨å‰é¢
                                } else {
                                    resolve([]);
                                }
                            })
                            .catch((error) => {
                                console.error('è·å–è·å¥–è½®æ¬¡å¤±è´¥:', error);
                                reject(error);
                            });
                    } catch (error) {
                        console.error('è·å–è·å¥–è½®æ¬¡é”™è¯¯:', error);
                        reject(error);
                    }
                });
            }
            
            // è·å–æ‰€æœ‰æŒä»“å¥–åŠ±è½®æ¬¡æ•°æ®
            getAllHolderRewardRounds() {
                return new Promise((resolve, reject) => {
                    try {
                        database.ref('holderRewardRounds').orderByChild('timestamp').once('value')
                            .then((snapshot) => {
                                if (snapshot.exists()) {
                                    const rounds = [];
                                    snapshot.forEach((childSnapshot) => {
                                        const roundData = childSnapshot.val();
                                        rounds.push(roundData);
                                    });
                                    resolve(rounds.reverse()); // æœ€æ–°çš„åœ¨å‰é¢
                                } else {
                                    resolve([]);
                                }
                            })
                            .catch((error) => {
                                console.error('è·å–æŒä»“å¥–åŠ±è½®æ¬¡å¤±è´¥:', error);
                                reject(error);
                            });
                    } catch (error) {
                        console.error('è·å–æŒä»“å¥–åŠ±è½®æ¬¡é”™è¯¯:', error);
                        reject(error);
                    }
                });
            }
            
            // æ ‡è®°è½®æ¬¡ä¸ºå·²é¢†å–
            markRoundAsClaimed(roundId) {
                try {
                    database.ref('gameRounds').child(roundId).update({
                        isClaimed: true,
                        claimedAt: Date.now()
                    }).then(() => {
                        console.log('è½®æ¬¡å·²æ ‡è®°ä¸ºå·²é¢†å–:', roundId);
                    }).catch((error) => {
                        console.error('æ ‡è®°è½®æ¬¡å¤±è´¥:', error);
                    });
                } catch (error) {
                    console.error('æ ‡è®°è½®æ¬¡é”™è¯¯:', error);
                }
            }
            
            // æ¢å¤æ¸¸æˆæ•°æ®
            restoreGameData(data) {
                if (data) {
                    gameData.countdownEnded = data.countdownEnded || false;
                    gameData.top20Holders = data.top20Holders || [];
                    gameData.lastBigBuyAddress = data.lastBigBuyAddress || null;
                    gameData.lastBigBuyAmount = data.lastBigBuyAmount || 0;
                    
                    this.transactionCount = data.transactionCount || 0;
                    this.totalTimeAdjustment = data.totalTimeAdjustment || 0;
                    
                    if (data.successAddresses) {
                        successAddresses = data.successAddresses;
                        updateSuccessAddressesDisplay();
                    }
                    
                    // æ›´æ–°æ˜¾ç¤º
                    document.getElementById('transactionCount').innerText = this.transactionCount;
                    document.getElementById('timeAdjustment').innerText = `+${this.totalTimeAdjustment} ç§’`;
                }
            }
            
            // ä¿å­˜äº¤æ˜“è®°å½•åˆ°Firebase
            saveTransactionToFirebase(transaction) {
                try {
                    const transactionData = {
                        timestamp: Date.now(),
                        signature: transaction.signature,
                        type: transaction.type,
                        amount: transaction.amount,
                        blockTime: transaction.blockTime,
                        src: transaction.src,
                        dst: transaction.dst,
                        tradeType: this.determineTradeType(transaction)
                    };
                    
                    database.ref('transactions').push(transactionData)
                        .then(() => {
                            console.log('äº¤æ˜“è®°å½•å·²ä¿å­˜åˆ°Firebase');
                        })
                        .catch((error) => {
                            console.error('ä¿å­˜äº¤æ˜“è®°å½•å¤±è´¥:', error);
                        });
                } catch (error) {
                    console.error('Firebaseäº¤æ˜“ä¿å­˜é”™è¯¯:', error);
                }
            }
            
            // ä¿å­˜æŒä»“æ•°æ®åˆ°Firebase
            saveHoldersDataToFirebase(holders) {
                try {
                    const holdersData = {
                        timestamp: Date.now(),
                        tokenAddress: document.getElementById('tokenAddress').value.trim(),
                        holders: holders
                    };
                    
                    database.ref('holdersData').push(holdersData)
                        .then(() => {
                            console.log('æŒä»“æ•°æ®å·²ä¿å­˜åˆ°Firebase');
                        })
                        .catch((error) => {
                            console.error('ä¿å­˜æŒä»“æ•°æ®å¤±è´¥:', error);
                        });
                } catch (error) {
                    console.error('FirebaseæŒä»“æ•°æ®ä¿å­˜é”™è¯¯:', error);
                }
            }
            
            // æ¸¸æˆæš‚åœ
            pauseGame() {
                // åœæ­¢ç›‘æ§
                this.stopMonitoring();
                
                // æ˜¾ç¤ºæ¸¸æˆæš‚åœç•Œé¢
                this.showGamePauseScreen();
                
                // 10ç§’åè‡ªåŠ¨å¼€å§‹ä¸‹ä¸€è½®
                setTimeout(() => {
                    this.startNextRound();
                }, 10000);
            }
            
            // æ˜¾ç¤ºæ¸¸æˆæš‚åœç•Œé¢
            showGamePauseScreen() {
                // åˆ›å»ºæ¸¸æˆæš‚åœé®ç½©
                let pauseOverlay = document.getElementById('gamePauseOverlay');
                if (!pauseOverlay) {
                    pauseOverlay = document.createElement('div');
                    pauseOverlay.id = 'gamePauseOverlay';
                    pauseOverlay.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[70]';
                    document.body.appendChild(pauseOverlay);
                }
                
                pauseOverlay.innerHTML = `
                    <div class="bg-gray-800 border-meme p-8 rounded-xl shadow-lg text-center max-w-md mx-4">
                        <div class="text-6xl mb-4">ğŸ‰</div>
                        <h2 class="text-memeYellow font-bold text-2xl mb-4">æ¸¸æˆç»“æŸï¼</h2>
                        <p class="text-white text-lg mb-6">æœ¬è½®æ¸¸æˆå·²ç»“æŸï¼Œè¯·ç©å®¶é¢†å–å¥–åŠ±</p>
                        
                        <div class="bg-gray-700 border-meme p-4 rounded-lg mb-6">
                            <div class="text-memePink font-bold mb-2">æœ¬è½®æ•°æ®ï¼š</div>
                            <div class="text-gray-300 text-sm space-y-1">
                                <div>â€¢ æ€»äº¤æ˜“æ¬¡æ•°ï¼š${this.transactionCount}</div>
                                <div>â€¢ å€’è®¡æ—¶è°ƒæ•´ï¼š+${this.totalTimeAdjustment} ç§’</div>
                                <div>â€¢ æœ€åå¤§é¢ä¹°å…¥ï¼š${gameData.lastBigBuyAddress ? gameData.lastBigBuyAddress.substring(0, 6) + '...' + gameData.lastBigBuyAddress.substring(gameData.lastBigBuyAddress.length - 4) : 'æ— '}</div>
                            </div>
                        </div>
                        
                        <div class="flex gap-4 mb-6">
                            <button onclick="window.solanaTracker.showRewardPage()" class="flex-1 bg-memeGreen hover:bg-green-600 text-white font-bold py-3 px-4 rounded border-meme transition-all duration-300">
                                ğŸ é¢†å–å¥–åŠ±
                            </button>
                            <button onclick="window.solanaTracker.moveToBottomLeft()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-4 rounded border-meme transition-all duration-300">
                                ğŸ“ ç§»è‡³å·¦ä¸‹è§’
                            </button>
                        </div>
                        
                        <div class="text-memeYellow font-bold text-lg">
                            <span id="nextRoundCountdown">10</span> ç§’åè‡ªåŠ¨å¼€å§‹ä¸‹ä¸€è½®
                        </div>
                    </div>
                `;
                
                pauseOverlay.classList.remove('hidden');
                
                // å¼€å§‹å€’è®¡æ—¶
                this.startNextRoundCountdown();
            }
            
            // éšè—æ¸¸æˆæš‚åœç•Œé¢
            hideGamePauseScreen() {
                const pauseOverlay = document.getElementById('gamePauseOverlay');
                if (pauseOverlay) {
                    pauseOverlay.classList.add('hidden');
                }
            }
            
            // ç§»åŠ¨åˆ°å·¦ä¸‹è§’
            moveToBottomLeft() {
                const pauseOverlay = document.getElementById('gamePauseOverlay');
                if (pauseOverlay) {
                    // ç§»é™¤å…¨å±é®ç½©æ ·å¼
                    pauseOverlay.className = 'fixed bottom-4 left-4 w-80 bg-gray-800 border-meme p-4 rounded-xl shadow-lg z-50';
                    
                    // æ›´æ–°å†…å®¹ä¸ºç´§å‡‘ç‰ˆæœ¬
                    pauseOverlay.innerHTML = `
                        <div class="text-center">
                            <div class="text-2xl mb-2">ğŸ‰</div>
                            <h3 class="text-memeYellow font-bold text-lg mb-2">æ¸¸æˆç»“æŸ</h3>
                            <p class="text-gray-300 text-sm mb-3">è¯·é¢†å–å¥–åŠ±</p>
                            
                            <div class="bg-gray-700 border-meme p-2 rounded mb-3">
                                <div class="text-memePink font-bold text-xs mb-1">æœ¬è½®æ•°æ®ï¼š</div>
                                <div class="text-gray-300 text-xs space-y-1">
                                    <div>äº¤æ˜“ï¼š${this.transactionCount}</div>
                                    <div>è°ƒæ•´ï¼š+${this.totalTimeAdjustment}s</div>
                                    <div>æœ€åï¼š${gameData.lastBigBuyAddress ? gameData.lastBigBuyAddress.substring(0, 4) + '...' + gameData.lastBigBuyAddress.substring(gameData.lastBigBuyAddress.length - 4) : 'æ— '}</div>
                                </div>
                            </div>
                            
                            <div class="flex gap-2 mb-3">
                                <button onclick="window.solanaTracker.showRewardPage()" class="flex-1 bg-memeGreen hover:bg-green-600 text-white font-bold py-2 px-3 rounded border-meme transition-all duration-300 text-xs">
                                    ğŸ é¢†å–
                                </button>
                            </div>
                            
                            <div class="text-memeYellow font-bold text-sm">
                                <span id="nextRoundCountdown">10</span>s åé‡å¯
                            </div>
                        </div>
                    `;
                    
                    // é‡æ–°å¼€å§‹å€’è®¡æ—¶
                    this.startNextRoundCountdown();
                }
            }
            
            // ä¸‹ä¸€è½®å€’è®¡æ—¶
            startNextRoundCountdown() {
                let countdown = 10;
                const countdownElement = document.getElementById('nextRoundCountdown');
                
                const timer = setInterval(() => {
                    countdown--;
                    if (countdownElement) {
                        countdownElement.textContent = countdown;
                    }
                    
                    if (countdown <= 0) {
                        clearInterval(timer);
                        // å€’è®¡æ—¶ç»“æŸåè‡ªåŠ¨å¼€å§‹ä¸‹ä¸€è½®
                        this.startNextRound();
                    }
                }, 1000);
            }
            
            // å¼€å§‹ä¸‹ä¸€è½®æ¸¸æˆ
            startNextRound() {
                // éšè—æš‚åœç•Œé¢
                this.hideGamePauseScreen();
                
                // é‡ç½®å€’è®¡æ—¶åˆ°åˆå§‹çŠ¶æ€ï¼ˆ5åˆ†é’Ÿï¼‰
                this.countdownDate = new Date();
                this.countdownDate.setMinutes(this.countdownDate.getMinutes() + 5);
                this.originalCountdownDate = new Date(this.countdownDate);
                this.totalTimeAdjustment = 0;
                this.transactionCount = 0;
                
                // æ¢å¤å€’è®¡æ—¶æ˜¾ç¤ºç»“æ„
                const countdownElement = document.getElementById("countdown");
                countdownElement.innerHTML = `
                    <!-- åˆ† -->
                    <div class="bg-memePurple border-meme p-4 text-center transform hover:scale-105 transition-all duration-300 glow">
                        <div id="minutes" class="text-[clamp(2rem,6vw,4rem)] font-bold text-white">05</div>
                        <div class="text-white font-bold">MINUTES</div>
                    </div>
                    
                    <!-- ç§’ -->
                    <div class="bg-memeGreen border-meme p-4 text-center transform hover:scale-105 transition-all duration-300 glow">
                        <div id="seconds" class="text-[clamp(2rem,6vw,4rem)] font-bold text-black">00</div>
                        <div class="text-black font-bold">SECONDS</div>
                    </div>
                `;
                
                // æ›´æ–°æ˜¾ç¤º
                document.getElementById('transactionCount').innerText = '0';
                document.getElementById('timeAdjustment').innerText = '+0 ç§’';
                
                // æ¸…ç©ºè¯¦ç»†äº¤æ˜“è¡¨æ ¼
                this.updateTransactionsDisplay();
                
                // æ›´æ–°è®¡æ•°å™¨
                const detailedCount = document.getElementById('detailedCount');
                if (detailedCount) {
                    detailedCount.textContent = '0 æ¡è®°å½•';
                }
                
                // é‡ç½®æ¸¸æˆçŠ¶æ€ï¼ˆä¿ç•™æ•°æ®ï¼‰
                this.resetGameState();
                
                // é‡æ–°å¯åŠ¨å€’è®¡æ—¶æ›´æ–°
                this.startCountdownUpdate();
                
                // æ·»åŠ æ—¥å¿—
                this.addLogEntry('ğŸ”„ æ–°ä¸€è½®æ¸¸æˆå¼€å§‹ï¼å€’è®¡æ—¶å·²é‡ç½®ä¸º5åˆ†é’Ÿ', 'success');
                
                // ä¸è‡ªåŠ¨å¼€å§‹ç›‘æ§ï¼Œç­‰å¾…ç®¡ç†é¢æ¿æŒ‡ä»¤
            }
            

            
            // é‡ç½®æ¸¸æˆçŠ¶æ€ï¼ˆä¿ç•™æ•°æ®ï¼‰
            resetGameState() {
                // åªé‡ç½®æ¸¸æˆçŠ¶æ€ï¼Œä¿ç•™æ•°æ®
                gameData.countdownEnded = false;
                gameData.lastRewardTime = 0;
                
                rewardData.countdownEnded = false;
                
                // ä¿ç•™ä»¥ä¸‹æ•°æ®ï¼š
                // - gameData.top20Holders (æŒä»“å‰20æ•°æ®)
                // - gameData.lastBigBuyAddress (æœ€åå¤§é¢ä¹°å…¥åœ°å€)
                // - gameData.lastBigBuyAmount (æœ€åå¤§é¢ä¹°å…¥æ•°é‡)
                // - rewardData.top20Holders (å¥–åŠ±é¡µé¢æ•°æ®)
                // - rewardData.lastSuccessAddress (å¥–åŠ±é¡µé¢æœ€ååœ°å€)
                // - rewardData.lastSuccessAmount (å¥–åŠ±é¡µé¢æœ€åæ•°é‡)
                // - successAddresses (æˆåŠŸåœ°å€åˆ—è¡¨)
            }
            
            // æ˜¾ç¤ºå¥–åŠ±é¡µé¢
            showRewardPage() {
                const rewardPage = document.getElementById('rewardPage');
                if (rewardPage) {
                    rewardPage.classList.remove('hidden');
                    updateRewardPageData();
                }
            }
        }
        
        // åˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', async () => {
            // ä»FirebaseåŠ è½½ä»£å¸åœ°å€
            await loadTokenAddressFromFirebase();
            
            // å¯åŠ¨ç›‘å¬å™¨ç›‘å¬åœ°å€å˜åŒ–
            listenToTokenAddressChanges();
            
            // å¯åŠ¨ç›‘å¬å™¨ç›‘å¬ç®¡ç†é¢æ¿æ§åˆ¶æŒ‡ä»¤
            listenToAdminControl();
            
            // åˆå§‹åŒ–Solanaäº¤æ˜“è¿½è¸ªå™¨
            window.solanaTracker = new SolanaTransactionTracker();
            
            // åˆå§‹åŒ–é’±åŒ…ç®¡ç†å™¨
            window.walletManager = new WalletManager();
            window.walletManager.init();
            
            // ä¸è‡ªåŠ¨å¯åŠ¨æŒä»“è€…åˆ·æ–°ï¼Œç­‰å¾…ç®¡ç†é¢æ¿æŒ‡ä»¤
        });
        
        // æ·»åŠ ä¸€äº›äº’åŠ¨æ•ˆæœ
        document.querySelectorAll('button, a').forEach(el => {
            el.addEventListener('click', function(e) {
                // é˜²æ­¢é“¾æ¥é»˜è®¤è¡Œä¸º
                if (el.tagName === 'A') e.preventDefault();
                
                // æ·»åŠ ç‚¹å‡»åŠ¨ç”»
                this.classList.add('scale-90');
                setTimeout(() => {
                    this.classList.remove('scale-90');
                }, 150);
            });
        });

        // é“¾ä¸Šå®æ—¶è·å–æŒä»“å‰20æŒæœ‰è€…
        async function fetchTopHolders(tokenMint) {
            const holdersList = document.getElementById('topHoldersList');
            holdersList.innerHTML = '<li class="text-gray-400 italic">é“¾ä¸Šå®æ—¶æŸ¥è¯¢ä¸­...</li>';
            try {
                console.log('å¼€å§‹æŸ¥è¯¢æŒä»“æ¦œï¼Œä»£å¸åœ°å€:', tokenMint);
                if (!window.solanaTracker) {
                    throw new Error('ç›‘æ§å™¨æœªåˆå§‹åŒ–');
                }
                // LPæ± å­åœ°å€åˆ—è¡¨
                const lpAddresses = [
                    'WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh',
                    // æœªæ¥å¯æ‰©å±•æ›´å¤šæ± å­
                ];
                // 1. æŸ¥æ‰¾æ‰€æœ‰Token Account
                const data = await window.solanaTracker.makeRpcCall('getProgramAccounts', [
                    'TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA',
                    {
                        encoding: 'jsonParsed',
                        filters: [
                            { dataSize: 165 },
                            { memcmp: { offset: 0, bytes: tokenMint } }
                        ]
                    }
                ]);
                console.log('RPCå“åº”æ•°æ®:', data);
                if (!data || !Array.isArray(data) || data.length === 0) {
                    holdersList.innerHTML = '<li class="text-yellow-400 text-xs">é“¾ä¸Šæš‚æ— æŒä»“æ•°æ®</li>';
                    return;
                }
                // 2. ç»Ÿè®¡æ‰€æœ‰ownerå’Œä½™é¢ï¼Œæ’é™¤LPæ± å­
                const holders = {};
                data.forEach(acc => {
                    const owner = acc.account.data.parsed.info.owner;
                    const amount = parseInt(acc.account.data.parsed.info.tokenAmount.amount);
                    if (lpAddresses.includes(owner)) return; // è·³è¿‡æ± å­
                    if (!holders[owner]) holders[owner] = 0;
                    holders[owner] += amount;
                });
                console.log('ç»Ÿè®¡åˆ°çš„æŒæœ‰äºº:', holders);
                // 3. æ’åºå–å‰20
                const sorted = Object.entries(holders)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 20);
                console.log('æ’åºåçš„å‰20:', sorted);
                holdersList.innerHTML = '';
                sorted.forEach(([owner, amount], idx) => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <span class="text-memePink font-bold text-xs">#${idx + 1}</span>
                        <a href="https://solscan.io/account/${owner}" target="_blank" class="text-blue-400 hover:underline mx-1">
                            ${owner.substring(0, 6)}...${owner.substring(owner.length - 4)}
                        </a>
                        <span class="text-gray-400 text-xs">(${amount})</span>
                    `;
                    holdersList.appendChild(li);
                });
            } catch (e) {
                console.error('é“¾ä¸ŠæŸ¥è¯¢å¤±è´¥ï¼Œè¯¦ç»†é”™è¯¯:', e);
                holdersList.innerHTML = `<li class="text-red-400 text-xs">é“¾ä¸ŠæŸ¥è¯¢å¤±è´¥: ${e.message}</li>`;
            }
        }

        // æˆåŠŸå¢åŠ å€’è®¡æ—¶çš„åœ°å€åˆ—è¡¨
        let successAddresses = [];
        const maxSuccessAddresses = 5; // æœ€å¤šæ˜¾ç¤º5ä¸ªåœ°å€

        // æ·»åŠ æˆåŠŸå¢åŠ å€’è®¡æ—¶çš„åœ°å€
        function addSuccessAddress(address, amount, timestamp) {
            const addressInfo = {
                address: address,
                amount: amount,
                timestamp: timestamp,
                time: new Date().toLocaleTimeString()
            };
            
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨è¯¥åœ°å€
            const existingIndex = successAddresses.findIndex(item => item.address === address);
            if (existingIndex !== -1) {
                // å¦‚æœå·²å­˜åœ¨ï¼Œæ›´æ–°ä¿¡æ¯
                successAddresses[existingIndex] = addressInfo;
            } else {
                // å¦‚æœä¸å­˜åœ¨ï¼Œæ·»åŠ åˆ°å¼€å¤´
                successAddresses.unshift(addressInfo);
                // ä¿æŒæœ€å¤š20ä¸ª
                if (successAddresses.length > maxSuccessAddresses) {
                    successAddresses = successAddresses.slice(0, maxSuccessAddresses);
                }
            }
            
            updateSuccessAddressesDisplay();
        }

        // æ›´æ–°æˆåŠŸåœ°å€æ˜¾ç¤º
        function updateSuccessAddressesDisplay() {
            const addressesList = document.getElementById('successAddressesList');
            if (successAddresses.length === 0) {
                addressesList.innerHTML = '<li class="text-gray-400 text-sm italic">ç­‰å¾…å¤§é¢ä¹°å…¥...</li>';
                return;
            }
            
            addressesList.innerHTML = '';
            successAddresses.forEach((item, idx) => {
                const li = document.createElement('li');
                li.className = 'text-sm border-b border-gray-700 pb-2';
                li.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <span class="text-memePink font-bold">#${idx + 1}</span>
                            <a href="https://solscan.io/account/${item.address}" target="_blank" class="text-blue-400 hover:underline mx-2">
                                ${item.address.substring(0, 6)}...${item.address.substring(item.address.length - 4)}
                            </a>
                        </div>
                        <div class="text-right text-xs text-gray-400">
                            <div>${item.amount}</div>
                            <div>${item.time}</div>
                        </div>
                    </div>
                `;
                addressesList.appendChild(li);
            });
        }

        // è‡ªåŠ¨åˆ·æ–°æŒä»“å‰20æŒæœ‰è€…
        let topHoldersInterval = null;
        let topHoldersCountdown = 10;
        let topHoldersCurrentMint = '';

        // åˆ·æ–°å€’è®¡æ—¶æ˜¾ç¤º
        function updateTopHoldersCountdown() {
            const timer = document.getElementById('holdersRefreshCountdown');
            if (timer) {
                timer.textContent = topHoldersCountdown;
            }
        }

        async function startTopHoldersAutoRefresh(tokenMint) {
            console.log('å¯åŠ¨æŒä»“è€…è‡ªåŠ¨åˆ·æ–°ï¼Œä»£å¸åœ°å€:', tokenMint);
            topHoldersCurrentMint = tokenMint;
            topHoldersCountdown = 10;
            updateTopHoldersCountdown();
            if (topHoldersInterval) clearInterval(topHoldersInterval);
            // ç«‹å³æ‹‰å–ä¸€æ¬¡
            fetchTopHolders(tokenMint);
            topHoldersInterval = setInterval(() => {
                topHoldersCountdown--;
                updateTopHoldersCountdown();
                if (topHoldersCountdown <= 0) {
                    fetchTopHolders(topHoldersCurrentMint);
                    topHoldersCountdown = 10;
                }
            }, 1000);
        }

        function stopTopHoldersAutoRefresh() {
            console.log('åœæ­¢æŒä»“è€…è‡ªåŠ¨åˆ·æ–°');
            if (topHoldersInterval) clearInterval(topHoldersInterval);
            topHoldersInterval = null;
        }

        // ç›‘æ§åŠŸèƒ½å·²ç§»è‡³ç®¡ç†é¢æ¿
        // æ¸¸æˆé€»è¾‘ç›¸å…³å˜é‡
        let gameData = {
            devHoldings: 3, // DEVæŒæœ‰3%ç­¹ç 
            triggerThreshold: 100000, // è§¦å‘é˜ˆå€¼100000æ•°é‡
            countdownIncrement: 60, // æ¯æ¬¡å¢åŠ 60ç§’
            maxCountdown: 600, // æœ€å¤§10åˆ†é’Ÿ
            lastBigBuyReward: 0.2, // æœ€åå¤§é¢ä¹°å…¥å¥–åŠ±0.2%
            top20Reward: 0.5, // å‰20åå¹³åˆ†å¥–åŠ±0.5%
            top20RewardInterval: 1200, // 20åˆ†é’Ÿ = 1200ç§’
            
            // è‡ªåŠ¨æ•æ‰æ•°æ®
            top20Holders: [],
            lastBigBuyAddress: null,
            lastBigBuyAmount: 0,
            countdownEnded: false,
            lastRewardTime: 0,
            
            // æŒä»“å¥–åŠ±ç‹¬ç«‹å€’è®¡æ—¶
            holderRewardCountdown: 180, // æŒä»“å¥–åŠ±å€’è®¡æ—¶ï¼š3åˆ†é’Ÿï¼ˆæµ‹è¯•ç”¨ï¼‰
            holderRewardEnded: false, // æŒä»“å¥–åŠ±å€’è®¡æ—¶æ˜¯å¦ç»“æŸ
            holderRewardRounds: [] // æŒä»“å¥–åŠ±è½®æ¬¡å†å²
        };
        
        // å¥–åŠ±é¡µé¢ç›¸å…³å˜é‡
        let rewardData = {
            top20Holders: [],
            lastSuccessAddress: null,
            lastSuccessAmount: 0,
            countdownEnded: false
        };
        
        // ä»FirebaseåŠ è½½å½“å‰ä»£å¸åœ°å€
        async function loadTokenAddressFromFirebase() {
            try {
                const snapshot = await database.ref('currentTokenAddress').once('value');
                if (snapshot.exists()) {
                    const address = snapshot.val();
                    // æ›´æ–°ä»£å¸åœ°å€è¾“å…¥æ¡†
                    const tokenAddressInput = document.getElementById('tokenAddress');
                    if (tokenAddressInput) {
                        tokenAddressInput.value = address;
                        // å¦‚æœæ¸¸æˆå·²ç»åˆå§‹åŒ–ï¼Œåªæ›´æ–°ä»£å¸åœ°å€ï¼Œä¸è‡ªåŠ¨å¯åŠ¨ç›‘æ§
                        if (window.solanaTracker) {
                            window.solanaTracker.tokenAddress = address;
                        }
                        // ä¸è‡ªåŠ¨å¯åŠ¨æŒä»“è€…åˆ·æ–°ï¼Œç­‰å¾…ç®¡ç†é¢æ¿æŒ‡ä»¤
                    }
                    console.log('ä»FirebaseåŠ è½½ä»£å¸åœ°å€:', address);
                }
            } catch (error) {
                console.error('åŠ è½½ä»£å¸åœ°å€å¤±è´¥:', error);
            }
        }
        
        // ç›‘å¬Firebaseä¸­ä»£å¸åœ°å€çš„å˜åŒ–
        function listenToTokenAddressChanges() {
            database.ref('currentTokenAddress').on('value', (snapshot) => {
                if (snapshot.exists()) {
                    const address = snapshot.val();
                    // æ›´æ–°ä»£å¸åœ°å€è¾“å…¥æ¡†
                    const tokenAddressInput = document.getElementById('tokenAddress');
                    if (tokenAddressInput) {
                        tokenAddressInput.value = address;
                        // å¦‚æœæ¸¸æˆå·²ç»åˆå§‹åŒ–ï¼Œåªæ›´æ–°ä»£å¸åœ°å€ï¼Œä¸è‡ªåŠ¨å¯åŠ¨ç›‘æ§
                        if (window.solanaTracker) {
                            window.solanaTracker.tokenAddress = address;
                        }
                        // ä¸è‡ªåŠ¨å¯åŠ¨æŒä»“è€…åˆ·æ–°ï¼Œç­‰å¾…ç®¡ç†é¢æ¿æŒ‡ä»¤
                    }
                    console.log('Firebaseä»£å¸åœ°å€å·²æ›´æ–°:', address);
                }
            });
        }
        
        // ç›‘å¬ç®¡ç†é¢æ¿çš„æ§åˆ¶æŒ‡ä»¤
        function listenToAdminControl() {
            // ç›‘å¬ç›‘æ§æ§åˆ¶
            database.ref('gameControl/monitoring').on('value', (snapshot) => {
                if (snapshot.exists()) {
                    const shouldMonitor = snapshot.val();
                    if (window.solanaTracker) {
                        if (shouldMonitor) {
                            window.solanaTracker.startMonitoring();
                            // è·å–å½“å‰ä»£å¸åœ°å€å¹¶å¯åŠ¨æŒä»“è€…åˆ·æ–°
                            const currentAddress = document.getElementById('tokenAddress').value.trim();
                            if (currentAddress) {
                                startTopHoldersAutoRefresh(currentAddress);
                            }
                            console.log('ç®¡ç†é¢æ¿æŒ‡ä»¤ï¼šå¼€å§‹ç›‘æ§');
                        } else {
                            window.solanaTracker.stopMonitoring();
                            // åœæ­¢æŒä»“è€…åˆ·æ–°
                            stopTopHoldersAutoRefresh();
                            console.log('ç®¡ç†é¢æ¿æŒ‡ä»¤ï¼šåœæ­¢ç›‘æ§');
                        }
                    }
                }
            });
            
            // ç›‘å¬æ¸¸æˆæš‚åœæ§åˆ¶
            database.ref('gameControl/paused').on('value', (snapshot) => {
                if (snapshot.exists()) {
                    const isPaused = snapshot.val();
                    if (window.solanaTracker) {
                        if (isPaused) {
                            window.solanaTracker.pauseGame();
                            console.log('ç®¡ç†é¢æ¿æŒ‡ä»¤ï¼šæš‚åœæ¸¸æˆ');
                        } else {
                            window.solanaTracker.resumeGame();
                            console.log('ç®¡ç†é¢æ¿æŒ‡ä»¤ï¼šæ¢å¤æ¸¸æˆ');
                        }
                    }
                }
            });
            
            // ç›‘å¬å€’è®¡æ—¶é‡ç½®
            database.ref('gameControl/resetCountdown').on('value', (snapshot) => {
                if (snapshot.exists()) {
                    const timestamp = snapshot.val();
                    if (window.solanaTracker) {
                        // é‡ç½®å€’è®¡æ—¶åˆ°5åˆ†é’Ÿ
                        window.solanaTracker.countdownDate = new Date();
                        window.solanaTracker.countdownDate.setMinutes(window.solanaTracker.countdownDate.getMinutes() + 5);
                        window.solanaTracker.originalCountdownDate = new Date(window.solanaTracker.countdownDate);
                        window.solanaTracker.totalTimeAdjustment = 0;
                        window.solanaTracker.transactionCount = 0;
                        window.solanaTracker.updateCountdown();
                        console.log('ç®¡ç†é¢æ¿æŒ‡ä»¤ï¼šé‡ç½®å€’è®¡æ—¶');
                    }
                }
            });
            
            // ç›‘å¬å¼ºåˆ¶å¿«ç…§
            database.ref('gameControl/forceSnapshot').on('value', (snapshot) => {
                if (snapshot.exists()) {
                    const timestamp = snapshot.val();
                    if (window.solanaTracker) {
                        // å¼ºåˆ¶æ‰§è¡ŒæŒä»“å¿«ç…§
                        window.solanaTracker.onHolderRewardEnded();
                        console.log('ç®¡ç†é¢æ¿æŒ‡ä»¤ï¼šå¼ºåˆ¶å¿«ç…§');
                    }
                }
            });
            
            // ç›‘å¬æ¨¡æ‹Ÿäº¤æ˜“
            database.ref('gameControl/simulateTransaction').on('value', (snapshot) => {
                if (snapshot.exists()) {
                    const mockTx = snapshot.val();
                    if (window.solanaTracker) {
                        // å¤„ç†æ¨¡æ‹Ÿäº¤æ˜“
                        window.solanaTracker.processTransaction(mockTx);
                        console.log('ç®¡ç†é¢æ¿æŒ‡ä»¤ï¼šæ¨¡æ‹Ÿäº¤æ˜“', mockTx);
                    }
                }
            });
            
            // ç›‘å¬å€’è®¡æ—¶å½’é›¶
            database.ref('gameControl/endCountdown').on('value', (snapshot) => {
                if (snapshot.exists()) {
                    const timestamp = snapshot.val();
                    if (window.solanaTracker) {
                        // ç«‹å³å°†å€’è®¡æ—¶è®¾ç½®ä¸º0ï¼ˆç”¨äºæµ‹è¯•ï¼‰
                        window.solanaTracker.countdownDate = new Date();
                        gameData.countdownEnded = false;
                        window.solanaTracker.updateCountdown();
                        console.log('ç®¡ç†é¢æ¿æŒ‡ä»¤ï¼šå€’è®¡æ—¶å½’é›¶');
                    }
                }
            });
        }

        // æ˜¾ç¤ºå¥–åŠ±é¡µé¢
        async function showRewardPage() {
            const rewardPage = document.getElementById('rewardPage');
            if (rewardPage) {
                rewardPage.classList.remove('hidden');
                await updateRewardPageData(); // æ›´æ–°å¥–åŠ±æ•°æ®
                loadHolderRewardRoundsList(); // åŠ è½½æŒä»“å¥–åŠ±å†å²
                loadCountdownRewardRoundsList(); // åŠ è½½å€’è®¡æ—¶å¥–åŠ±å†å²
            }
        }

        // éšè—å¥–åŠ±é¡µé¢
        function hideRewardPage() {
            const rewardPage = document.getElementById('rewardPage');
            if (rewardPage) {
                rewardPage.classList.add('hidden');
            }
        }

        // æ›´æ–°å¥–åŠ±é¡µé¢æ•°æ®
        async function updateRewardPageData() {
            // æ£€æŸ¥é’±åŒ…è¿æ¥çŠ¶æ€
            if (!window.walletManager || !window.walletManager.isConnected) {
                document.getElementById('top20Status').innerHTML = '<span class="text-red-400">âŒ è¯·å…ˆè¿æ¥é’±åŒ…</span>';
                document.getElementById('lastSuccessStatus').innerHTML = '<span class="text-red-400">âŒ è¯·å…ˆè¿æ¥é’±åŒ…</span>';
                document.getElementById('claimTop20Btn').disabled = true;
                document.getElementById('claimLastSuccessBtn').disabled = true;
                return;
            }
            
            // ç›´æ¥å¯ç”¨æŒ‰é’®ï¼Œè®©ç”¨æˆ·å°è¯•é¢†å–
            document.getElementById('claimTop20Btn').disabled = false;
            document.getElementById('claimLastSuccessBtn').disabled = false;
            
            // è®¾ç½®é»˜è®¤æ˜¾ç¤ºä¿¡æ¯
            document.getElementById('top20Status').innerHTML = '<span class="text-blue-400">ğŸ’¡ ç‚¹å‡»æŒ‰é’®å°è¯•é¢†å–å¥–åŠ±</span>';
            document.getElementById('lastSuccessStatus').innerHTML = '<span class="text-blue-400">ğŸ’¡ ç‚¹å‡»æŒ‰é’®å°è¯•é¢†å–å¥–åŠ±</span>';
            
            // è®¾ç½®é»˜è®¤å¥–åŠ±æ•°é‡æ˜¾ç¤º
            document.getElementById('top20Reward').textContent = '30000 TOKENS';
            document.getElementById('lastSuccessReward').textContent = '100000 TOKENS';
        }

        // éªŒè¯åœ°å€åŠŸèƒ½
        function verifyAddress(address) {
            if (!address || address.trim() === '') {
                return { valid: false, message: 'è¯·è¾“å…¥æœ‰æ•ˆçš„é’±åŒ…åœ°å€' };
            }
            
            // ç®€å•çš„Solanaåœ°å€æ ¼å¼éªŒè¯
            const solanaAddressRegex = /^[1-9A-HJ-NP-Za-km-z]{32,44}$/;
            if (!solanaAddressRegex.test(address.trim())) {
                return { valid: false, message: 'åœ°å€æ ¼å¼ä¸æ­£ç¡®' };
            }
            
            // æ£€æŸ¥æ˜¯å¦åœ¨æŒä»“å‰20æŒæœ‰è€…ä¸­
            const isTop20 = rewardData.top20Holders.some(holder => holder.address === address.trim());
            if (isTop20) {
                return { valid: true, message: 'âœ… è¯¥åœ°å€åœ¨æŒä»“å‰20æŒæœ‰è€…ä¸­ï¼Œå¯é¢†å–å¥–åŠ±ï¼', type: 'top20' };
            }
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯æœ€åæˆåŠŸåœ°å€
            if (rewardData.lastSuccessAddress === address.trim()) {
                return { valid: true, message: 'âœ… è¯¥åœ°å€æ˜¯æœ€åå€’è®¡æ—¶åœ°å€ï¼Œå¯é¢†å–å¥–åŠ±ï¼', type: 'lastSuccess' };
            }
            
            return { valid: false, message: 'âŒ è¯¥åœ°å€ä¸ç¬¦åˆé¢†å–æ¡ä»¶' };
        }

        // é¢†å–å‰20åå¥–åŠ±
        async function claimTop20Reward() {
            if (!window.walletManager || !window.walletManager.isConnected) {
                alert('è¯·å…ˆè¿æ¥é’±åŒ…');
                return;
            }
            
            const walletAddress = window.walletManager.currentWallet;
            if (!walletAddress) {
                alert('é’±åŒ…åœ°å€æ— æ•ˆ');
                return;
            }
            
            try {
                // è·å–å½“å‰è½®æ¬¡IDï¼ˆä½¿ç”¨æœ€æ–°çš„æŒä»“å¥–åŠ±è½®æ¬¡ï¼‰
                const currentRoundId = window.solanaTracker ? window.solanaTracker.currentHolderRewardRoundId : null;
                if (!currentRoundId) {
                    alert('æ— æ³•è·å–å½“å‰è½®æ¬¡ä¿¡æ¯');
                    return;
                }
                
                // è°ƒç”¨Firebaseå‡½æ•°é¢†å–å¥–åŠ±
                const functions = firebase.functions();
                const claimGameReward = functions.httpsCallable('claimGameReward');
                
                const result = await claimGameReward({
                    wallet: walletAddress,
                    rewardType: 'top20',
                    roundId: currentRoundId
                });
                
                if (result.data.success) {
                    alert(`ğŸ† æŒä»“å‰20æŒæœ‰è€…å¥–åŠ±é¢†å–æˆåŠŸï¼\nè·å¾— ${result.data.amount} TOKENS\näº¤æ˜“å“ˆå¸Œ: ${result.data.txHash}`);
                    
                    // ç¦ç”¨æŒ‰é’®å¹¶æ›´æ–°çŠ¶æ€
                    document.getElementById('claimTop20Btn').disabled = true;
                    document.getElementById('claimTop20Btn').innerHTML = '<span class="text-white">âœ… å·²é¢†å–</span>';
                    
                    // åˆ·æ–°å†å²è·å¥–è½®æ¬¡åˆ—è¡¨
                    loadHolderRewardRoundsList();
                } else {
                    alert('å¥–åŠ±é¢†å–å¤±è´¥: ' + result.data.message);
                }
            } catch (error) {
                console.error('é¢†å–å¥–åŠ±å¤±è´¥:', error);
                // æ ¹æ®é”™è¯¯ä¿¡æ¯æ˜¾ç¤ºä¸åŒçš„æç¤º
                if (error.message && error.message.includes('ä¸åœ¨æŒä»“å‰20æŒæœ‰è€…ä¸­')) {
                    alert('âŒ æ‚¨çš„åœ°å€ä¸åœ¨æŒä»“å‰20æŒæœ‰è€…ä¸­ï¼Œæ— æ³•é¢†å–æ­¤å¥–åŠ±');
                } else if (error.message && error.message.includes('å·²é¢†å–')) {
                    alert('âŒ è¯¥è½®æ¬¡å¥–åŠ±å·²é¢†å–ï¼Œæ— æ³•é‡å¤é¢†å–');
                } else if (error.message && error.message.includes('è½®æ¬¡æ•°æ®ä¸å­˜åœ¨')) {
                    alert('âŒ è½®æ¬¡æ•°æ®ä¸å­˜åœ¨ï¼Œè¯·ç­‰å¾…æ¸¸æˆæ•°æ®æ›´æ–°');
                } else {
                    alert('âŒ å¥–åŠ±é¢†å–å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'));
                }
            }
        }

        // é¢†å–æœ€åå€’è®¡æ—¶å¥–åŠ±
        async function claimLastSuccessReward() {
            if (!window.walletManager || !window.walletManager.isConnected) {
                alert('è¯·å…ˆè¿æ¥é’±åŒ…');
                return;
            }
            
            const walletAddress = window.walletManager.currentWallet;
            if (!walletAddress) {
                alert('é’±åŒ…åœ°å€æ— æ•ˆ');
                return;
            }
            
            try {
                // è·å–å½“å‰è½®æ¬¡IDï¼ˆä½¿ç”¨æœ€æ–°çš„å€’è®¡æ—¶å¥–åŠ±è½®æ¬¡ï¼‰
                const currentRoundId = window.solanaTracker ? window.solanaTracker.currentRoundId : null;
                if (!currentRoundId) {
                    alert('æ— æ³•è·å–å½“å‰è½®æ¬¡ä¿¡æ¯');
                    return;
                }
                
                // è°ƒç”¨Firebaseå‡½æ•°é¢†å–å¥–åŠ±
                const functions = firebase.functions();
                const claimGameReward = functions.httpsCallable('claimGameReward');
                
                const result = await claimGameReward({
                    wallet: walletAddress,
                    rewardType: 'countdown',
                    roundId: currentRoundId
                });
                
                if (result.data.success) {
                    alert(`ğŸ’° æœ€åå€’è®¡æ—¶å¥–åŠ±é¢†å–æˆåŠŸï¼\nè·å¾— ${result.data.amount} TOKENS\näº¤æ˜“å“ˆå¸Œ: ${result.data.txHash}`);
                    
                    // ç¦ç”¨æŒ‰é’®å¹¶æ›´æ–°çŠ¶æ€
                    document.getElementById('claimLastSuccessBtn').disabled = true;
                    document.getElementById('claimLastSuccessBtn').innerHTML = '<span class="text-white">âœ… å·²é¢†å–</span>';
                    
                    // åˆ·æ–°å†å²è·å¥–è½®æ¬¡åˆ—è¡¨
                    loadCountdownRewardRoundsList();
                } else {
                    alert('å¥–åŠ±é¢†å–å¤±è´¥: ' + result.data.message);
                }
            } catch (error) {
                console.error('é¢†å–å¥–åŠ±å¤±è´¥:', error);
                // æ ¹æ®é”™è¯¯ä¿¡æ¯æ˜¾ç¤ºä¸åŒçš„æç¤º
                if (error.message && error.message.includes('ä¸æ˜¯æœ€åå€’è®¡æ—¶åœ°å€')) {
                    alert('âŒ æ‚¨çš„åœ°å€ä¸æ˜¯æœ€åå€’è®¡æ—¶åœ°å€ï¼Œæ— æ³•é¢†å–æ­¤å¥–åŠ±');
                } else if (error.message && error.message.includes('å·²é¢†å–')) {
                    alert('âŒ è¯¥è½®æ¬¡å¥–åŠ±å·²é¢†å–ï¼Œæ— æ³•é‡å¤é¢†å–');
                } else if (error.message && error.message.includes('è½®æ¬¡æ•°æ®ä¸å­˜åœ¨')) {
                    alert('âŒ è½®æ¬¡æ•°æ®ä¸å­˜åœ¨ï¼Œè¯·ç­‰å¾…æ¸¸æˆæ•°æ®æ›´æ–°');
                } else {
                    alert('âŒ å¥–åŠ±é¢†å–å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'));
                }
            }
        }
        
        // åŠ è½½æŒä»“å¥–åŠ±å†å²è½®æ¬¡åˆ—è¡¨
        function loadHolderRewardRoundsList() {
            const holderRewardRoundsList = document.getElementById('holderRewardRoundsList');
            if (!holderRewardRoundsList) return;
            
            holderRewardRoundsList.innerHTML = '<div class="text-center text-gray-400">åŠ è½½ä¸­...</div>';
            
            if (window.solanaTracker) {
                window.solanaTracker.getAllHolderRewardRounds()
                    .then((rounds) => {
                        if (rounds.length === 0) {
                            holderRewardRoundsList.innerHTML = '<div class="text-center text-gray-400">æš‚æ— æŒä»“å¥–åŠ±å†å²</div>';
                            return;
                        }
                        
                        let html = '';
                        rounds.forEach((round, index) => {
                            const roundDate = new Date(round.timestamp).toLocaleString('zh-CN');
                            const isClaimed = round.isClaimed ? 'âœ… å·²é¢†å–' : 'â³ å¾…é¢†å–';
                            const claimedDate = round.claimedAt ? new Date(round.claimedAt).toLocaleString('zh-CN') : '';
                            
                            html += `
                                <div class="border-b border-gray-500 pb-3 mb-3 ${index === 0 ? 'border-t border-gray-500 pt-3' : ''}">
                                    <div class="flex justify-between items-start mb-2">
                                        <div class="font-bold text-memeYellow">æŒä»“è½®æ¬¡ ${round.roundId}</div>
                                        <div class="text-xs text-gray-400">${roundDate}</div>
                                    </div>
                                    
                                    <div class="text-xs text-gray-300 space-y-1 mb-2">
                                        <div>â€¢ å‰20æŒæœ‰è€…æ•°é‡ï¼š${round.top20Holders ? round.top20Holders.length : 0} ä¸ªåœ°å€</div>
                                        <div>â€¢ é¢†å–çŠ¶æ€ï¼š${isClaimed}</div>
                                        ${claimedDate ? `<div>â€¢ é¢†å–æ—¶é—´ï¼š${claimedDate}</div>` : ''}
                                    </div>
                                    
                                    <div class="text-xs text-gray-400">
                                        <div>â€¢ ä»£å¸åœ°å€ï¼š${round.tokenAddress ? round.tokenAddress.substring(0, 6) + '...' + round.tokenAddress.substring(round.tokenAddress.length - 4) : 'æœªçŸ¥'}</div>
                                        <div>â€¢ å¥–åŠ±ç±»å‹ï¼šæŒä»“å‰20æŒæœ‰è€…å¥–åŠ±</div>
                                    </div>
                                </div>
                            `;
                        });
                        
                        holderRewardRoundsList.innerHTML = html;
                    })
                    .catch((error) => {
                        console.error('åŠ è½½æŒä»“å¥–åŠ±å†å²å¤±è´¥:', error);
                        holderRewardRoundsList.innerHTML = '<div class="text-center text-red-400">åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•</div>';
                    });
            } else {
                holderRewardRoundsList.innerHTML = '<div class="text-center text-red-400">ç³»ç»Ÿæœªåˆå§‹åŒ–</div>';
            }
        }
        
        // åŠ è½½å€’è®¡æ—¶å¥–åŠ±å†å²è½®æ¬¡åˆ—è¡¨
        function loadCountdownRewardRoundsList() {
            const countdownRewardRoundsList = document.getElementById('countdownRewardRoundsList');
            if (!countdownRewardRoundsList) return;
            
            countdownRewardRoundsList.innerHTML = '<div class="text-center text-gray-400">åŠ è½½ä¸­...</div>';
            
            if (window.solanaTracker) {
                window.solanaTracker.getAllWinnerRounds()
                    .then((rounds) => {
                        if (rounds.length === 0) {
                            countdownRewardRoundsList.innerHTML = '<div class="text-center text-gray-400">æš‚æ— å€’è®¡æ—¶å¥–åŠ±å†å²</div>';
                            return;
                        }
                        
                        let html = '';
                        rounds.forEach((round, index) => {
                            const roundDate = new Date(round.timestamp).toLocaleString('zh-CN');
                            const isClaimed = round.isClaimed ? 'âœ… å·²é¢†å–' : 'â³ å¾…é¢†å–';
                            const claimedDate = round.claimedAt ? new Date(round.claimedAt).toLocaleString('zh-CN') : '';
                            
                            html += `
                                <div class="border-b border-gray-500 pb-3 mb-3 ${index === 0 ? 'border-t border-gray-500 pt-3' : ''}">
                                    <div class="flex justify-between items-start mb-2">
                                        <div class="font-bold text-memeYellow">å€’è®¡æ—¶è½®æ¬¡ ${round.roundId}</div>
                                        <div class="text-xs text-gray-400">${roundDate}</div>
                                    </div>
                                    
                                    <div class="text-xs text-gray-300 space-y-1 mb-2">
                                        <div>â€¢ æœ€åå¤§é¢ä¹°å…¥åœ°å€ï¼š${round.lastBigBuyAddress ? round.lastBigBuyAddress.substring(0, 6) + '...' + round.lastBigBuyAddress.substring(round.lastBigBuyAddress.length - 4) : 'æ— '}</div>
                                        <div>â€¢ ä¹°å…¥æ•°é‡ï¼š${round.lastBigBuyAmount ? round.lastBigBuyAmount.toLocaleString() : '0'}</div>
                                        <div>â€¢ é¢†å–çŠ¶æ€ï¼š${isClaimed}</div>
                                        ${claimedDate ? `<div>â€¢ é¢†å–æ—¶é—´ï¼š${claimedDate}</div>` : ''}
                                    </div>
                                    
                                    <div class="text-xs text-gray-400">
                                        <div>â€¢ ä»£å¸åœ°å€ï¼š${round.tokenAddress ? round.tokenAddress.substring(0, 6) + '...' + round.tokenAddress.substring(round.tokenAddress.length - 4) : 'æœªçŸ¥'}</div>
                                        <div>â€¢ æ€»äº¤æ˜“æ¬¡æ•°ï¼š${round.transactionCount || 0}</div>
                                        <div>â€¢ å€’è®¡æ—¶è°ƒæ•´ï¼š+${round.totalTimeAdjustment || 0} ç§’</div>
                                        <div>â€¢ å¥–åŠ±ç±»å‹ï¼šæœ€åå€’è®¡æ—¶å¥–åŠ±</div>
                                    </div>
                                </div>
                            `;
                        });
                        
                        countdownRewardRoundsList.innerHTML = html;
                    })
                    .catch((error) => {
                        console.error('åŠ è½½å€’è®¡æ—¶å¥–åŠ±å†å²å¤±è´¥:', error);
                        countdownRewardRoundsList.innerHTML = '<div class="text-center text-red-400">åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•</div>';
                    });
            } else {
                countdownRewardRoundsList.innerHTML = '<div class="text-center text-red-400">ç³»ç»Ÿæœªåˆå§‹åŒ–</div>';
            }
        }

        // ç›‘æ§åŠŸèƒ½å·²ç§»è‡³ç®¡ç†é¢æ¿

        // ç›‘å¬å¥–åŠ±é¡µé¢æŒ‰é’®äº‹ä»¶
        document.addEventListener('DOMContentLoaded', function() {
            // é¢†å–å¥–åŠ±æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.getElementById('claimRewardBtn').addEventListener('click', showRewardPage);
            
            // å‰20%å¥–åŠ±æŒ‰é’®
            document.getElementById('claimTop20Btn').addEventListener('click', claimTop20Reward);
            
            // æœ€åå€’è®¡æ—¶å¥–åŠ±æŒ‰é’®
            document.getElementById('claimLastSuccessBtn').addEventListener('click', claimLastSuccessReward);
            
            // éªŒè¯åœ°å€æŒ‰é’®
            document.getElementById('verifyAddressBtn').addEventListener('click', function() {
                const address = document.getElementById('verifyAddressInput').value.trim();
                const result = verifyAddress(address);
                const resultDiv = document.getElementById('verifyResult');
                
                if (result.valid) {
                    resultDiv.innerHTML = `<span class="text-green-400">${result.message}</span>`;
                } else {
                    resultDiv.innerHTML = `<span class="text-red-400">${result.message}</span>`;
                }
            });
        });
    </script>
</body>
</html>
